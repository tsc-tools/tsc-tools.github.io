<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>API - Zizou</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "API";
        var mkdocs_page_input_path = "api.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Zizou
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../user_guide/">User Guide</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">API</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#zizou.data">data</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.data.FDSNWaveforms">FDSNWaveforms</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.data.FDSNWaveforms.__init__">__init__</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.data.MockSDSWaveforms">MockSDSWaveforms</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.data.MockSDSWaveforms.__init__">__init__</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.data.MockSDSWaveforms.generate_dataset">generate_dataset</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#zizou.data.MockSDSWaveforms.generate_dataset--parameters">Parameters</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.data.MockSDSWaveforms.get_waveforms">get_waveforms</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.data.MockSDSWaveforms.save2sds">save2sds</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#zizou.data.MockSDSWaveforms.save2sds--parameters">Parameters</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.data.PostProcess">PostProcess</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.data.PostProcess.check_case_incomplete_station_metadata">check_case_incomplete_station_metadata</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.data.PostProcess.check_case_multiple_channel_periods">check_case_multiple_channel_periods</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.data.PostProcess.check_case_no_data">check_case_no_data</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.data.PostProcess.output_case_multiple_channel_periods">output_case_multiple_channel_periods</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.data.S3Waveforms">S3Waveforms</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.data.S3Waveforms.get_waveforms">get_waveforms</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.data.SDSWaveforms">SDSWaveforms</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.data.SDSWaveforms.__init__">__init__</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.data.SDSWaveforms.get_waveforms">get_waveforms</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.data.VolcanoMetadata">VolcanoMetadata</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.data.VolcanoMetadata.get_available_streams">get_available_streams</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#zizou.data.VolcanoMetadata.get_available_streams--parameters">Parameters</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#zizou.data.VolcanoMetadata.get_available_streams--returns">Returns</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.data.VolcanoMetadata.get_eruption_dates">get_eruption_dates</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#zizou.data.VolcanoMetadata.get_eruption_dates--parameters">Parameters</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#zizou.data.VolcanoMetadata.get_eruption_dates--returns">Returns</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.data.VolcanoMetadata.get_site_information">get_site_information</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#zizou.data.VolcanoMetadata.get_site_information--parameters">Parameters</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#zizou.data.VolcanoMetadata.get_site_information--returns">Returns</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.data.VolcanoMetadata.get_unrest_periods">get_unrest_periods</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#zizou.data.VolcanoMetadata.get_unrest_periods--parameters">Parameters</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#zizou.data.VolcanoMetadata.get_unrest_periods--returns">Returns</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.data.get_instrument_response">get_instrument_response</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.rsam">rsam</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.rsam.EnergyExplainedByRSAM">EnergyExplainedByRSAM</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.rsam.EnergyExplainedByRSAM.compute">compute</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.rsam.RSAM">RSAM</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.rsam.RSAM.compute">compute</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.ssam">ssam</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.ssam.SSAM">SSAM</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.ssam.SSAM.compute">compute</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.ssam.SSAM.filterbank">filterbank</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.ssam.SSAM.sonogram">sonogram</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.dsar">dsar</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.dsar.DSAR">DSAR</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.dsar.DSAR.compute">compute</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#zizou.dsar.DSAR.compute--todo">TODO:</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.spectral_features">spectral_features</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.spectral_features.SpectralFeatures">SpectralFeatures</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.spectral_features.SpectralFeatures.bandwidth">bandwidth</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.spectral_features.SpectralFeatures.centralFrequency">centralFrequency</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.spectral_features.SpectralFeatures.compute">compute</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.spectral_features.SpectralFeatures.predominantFrequency">predominantFrequency</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.pca">pca</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.pca.PCA">PCA</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.pca.PCA.infer">infer</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.autoencoder">autoencoder</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.autoencoder.TiedAutoEncoder">TiedAutoEncoder</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.autoencoder.TiedAutoEncoder.__init__">__init__</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.autoencoder.TiedAutoEncoder.decode">decode</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.autoencoder.TiedAutoEncoder.encode">encode</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.autoencoder.TiedAutoEncoder.forward">forward</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.autoencoder.TiedAutoEncoder.reset_parameters">reset_parameters</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.visualise">visualise</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.visualise.get_trace">get_trace</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.visualise.multi_feature_plot">multi_feature_plot</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.visualise.plot_ssam_mpl">plot_ssam_mpl</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.visualise.plot_ssam_plotly">plot_ssam_plotly</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.feature_base">feature_base</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.anomaly_base">anomaly_base</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.anomaly_base.AnomalyDetectionBaseClass">AnomalyDetectionBaseClass</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.anomaly_base.AnomalyDetectionBaseClass.compute_anomaly_index">compute_anomaly_index</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.anomaly_base.AnomalyDetectionBaseClass.fit">fit</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.anomaly_base.AnomalyDetectionBaseClass.infer">infer</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.anomaly_base.AnomalyDetectionBaseClass.read_model_parameters">read_model_parameters</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.anomaly_base.AnomalyDetectionBaseClass.write_hyperparameters">write_hyperparameters</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#zizou.anomaly_base.AnomalyDetectionBaseClass.write_model_parameters">write_model_parameters</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.util">util</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.util.apply_freq_filter">apply_freq_filter</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.util.apply_hanning">apply_hanning</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.util.demean">demean</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.util.generate_test_data">generate_test_data</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.util.round_time">round_time</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.util.stride_windows">stride_windows</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.util.test_signal">test_signal</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.util.trace_window_data">trace_window_data</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.util.trace_window_times">trace_window_times</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.util.window_array">window_array</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#zizou.util.xarray2hdf5">xarray2hdf5</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../about/">About</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Zizou</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">API</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="api-documentation">API Documentation</h2>


<div class="doc doc-object doc-module">



<a id="zizou.data"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="zizou.data.FDSNWaveforms" class="doc doc-heading">
            <code>FDSNWaveforms</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="zizou.data.WaveformBaseclass">WaveformBaseclass</span></code></p>


              <details class="quote">
                <summary>Source code in <code>src/zizou/data.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FDSNWaveforms</span><span class="p">(</span><span class="n">WaveformBaseclass</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get seismic waveforms from FDSN web service.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">FDSN_Client</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span> <span class="o">=</span> <span class="n">fill_value</span>

    <span class="k">def</span> <span class="nf">get_waveforms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">):</span>
        <span class="n">st</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get_waveforms</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span>
                                       <span class="n">enddate</span><span class="p">,</span> <span class="n">attach_response</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Prepare seismic time series</span>
        <span class="n">st</span><span class="o">.</span><span class="n">remove_sensitivity</span><span class="p">()</span>
        <span class="c1"># in case stream has more than one trace</span>
        <span class="n">st</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span> <span class="o">!=</span> <span class="s1">&#39;interpolate&#39;</span><span class="p">:</span>
            <span class="n">st</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span><span class="p">,</span>
                    <span class="n">nearest_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">st</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="zizou.data.FDSNWaveforms.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Get seismic waveforms from FDSN web service.</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/data.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get seismic waveforms from FDSN web service.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">FDSN_Client</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span> <span class="o">=</span> <span class="n">fill_value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="zizou.data.MockSDSWaveforms" class="doc doc-heading">
            <code>MockSDSWaveforms</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="zizou.data.WaveformBaseclass">WaveformBaseclass</span></code></p>


      <p>Mock SDSWaveforms class for testing by creating
synthetic data for the requested streams.</p>

              <details class="quote">
                <summary>Source code in <code>src/zizou/data.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MockSDSWaveforms</span><span class="p">(</span><span class="n">WaveformBaseclass</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Mock SDSWaveforms class for testing by creating</span>
<span class="sd">    synthetic data for the requested streams.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sds_dir</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get seismic waveforms from a local SDS archive.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">sds_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">SDS_Client</span><span class="p">(</span><span class="n">sds_dir</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save2sds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span><span class="p">:</span> <span class="n">Trace</span><span class="p">,</span> <span class="n">rootdir</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save a trace to a SDS directory structure.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        trace : `obspy.Trace` </span>
<span class="sd">            Seismic/acoustic trace to be written to disk. </span>
<span class="sd">        rootdir : str </span>
<span class="sd">            Root directory for the SDS directory structure. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sds_fmtstr</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{year}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{network}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{station}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{channel}</span><span class="s2">.</span><span class="si">{sds_type}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="si">{network}</span><span class="s2">.</span><span class="si">{station}</span><span class="s2">.</span><span class="si">{location}</span><span class="s2">.</span><span class="si">{channel}</span><span class="s2">.</span><span class="si">{sds_type}</span><span class="s2">.</span><span class="si">{year}</span><span class="s2">.</span><span class="si">{doy:03d}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">fullpath</span> <span class="o">=</span> <span class="n">sds_fmtstr</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
                                    <span class="n">doy</span><span class="o">=</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span><span class="o">.</span><span class="n">julday</span><span class="p">,</span>
                                    <span class="n">sds_type</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="p">)</span>
        <span class="n">fullpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rootdir</span><span class="p">,</span> <span class="n">fullpath</span><span class="p">)</span>
        <span class="n">dirname</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">fullpath</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;writing&quot;</span><span class="p">,</span> <span class="n">fullpath</span><span class="p">)</span>
        <span class="n">trace</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fullpath</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;mseed&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">generate_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rootdir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">net</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">site</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                         <span class="n">loc</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">comp</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Generate a test dataset for the integration tests.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rootdir : str</span>
<span class="sd">            Parent directory for the test dataset.</span>
<span class="sd">        start : str</span>
<span class="sd">            Start time for the test dataset in ISO 8601 format.</span>
<span class="sd">        end : str</span>
<span class="sd">            End time for the test dataset in ISO 8601 format.</span>
<span class="sd">        &quot;&quot;&quot;</span> 
        <span class="n">tstart</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="c1"># Always generate whole day files</span>
        <span class="n">_tstart</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">tstart</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">julday</span><span class="o">=</span><span class="n">tstart</span><span class="o">.</span><span class="n">julday</span><span class="p">)</span>
        <span class="n">tend</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="n">test_signal</span><span class="p">(</span><span class="n">starttime</span><span class="o">=</span><span class="n">_tstart</span><span class="p">,</span>
                        <span class="n">sampling_rate</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                        <span class="n">nsec</span><span class="o">=</span><span class="mi">86400</span><span class="p">,</span> <span class="n">gaps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">network</span><span class="o">=</span><span class="n">net</span><span class="p">,</span> <span class="n">station</span><span class="o">=</span><span class="n">site</span><span class="p">,</span>  
                        <span class="n">location</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="n">comp</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">_tstart</span> <span class="o">&lt;</span> <span class="n">tend</span><span class="p">:</span>
            <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span> <span class="o">=</span> <span class="n">_tstart</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save2sds</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">rootdir</span><span class="p">)</span>
            <span class="n">_tstart</span> <span class="o">+=</span> <span class="mi">86400</span>


    <span class="k">def</span> <span class="nf">get_waveforms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate synthetic daily files that start at midnight on the</span>
<span class="sd">        startdate and end at midnight on the enddate. The return the requested</span>
<span class="sd">        timespan from these files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">sds_root</span><span class="p">,</span> <span class="n">net</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span>
                              <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
        <span class="n">st</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get_waveforms</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span>
                                       <span class="n">enddate</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">st</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="zizou.data.MockSDSWaveforms.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">sds_dir</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Get seismic waveforms from a local SDS archive.</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/data.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sds_dir</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get seismic waveforms from a local SDS archive.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">sds_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">SDS_Client</span><span class="p">(</span><span class="n">sds_dir</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zizou.data.MockSDSWaveforms.generate_dataset" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_dataset</span><span class="p">(</span><span class="n">rootdir</span><span class="p">,</span> <span class="n">net</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Generate a test dataset for the integration tests.</p>
<h6 id="zizou.data.MockSDSWaveforms.generate_dataset--parameters">Parameters</h6>
<p>rootdir : str
    Parent directory for the test dataset.
start : str
    Start time for the test dataset in ISO 8601 format.
end : str
    End time for the test dataset in ISO 8601 format.</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/data.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rootdir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">net</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">site</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                     <span class="n">loc</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">comp</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Generate a test dataset for the integration tests.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rootdir : str</span>
<span class="sd">        Parent directory for the test dataset.</span>
<span class="sd">    start : str</span>
<span class="sd">        Start time for the test dataset in ISO 8601 format.</span>
<span class="sd">    end : str</span>
<span class="sd">        End time for the test dataset in ISO 8601 format.</span>
<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="n">tstart</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
    <span class="c1"># Always generate whole day files</span>
    <span class="n">_tstart</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">tstart</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">julday</span><span class="o">=</span><span class="n">tstart</span><span class="o">.</span><span class="n">julday</span><span class="p">)</span>
    <span class="n">tend</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
    <span class="n">tr</span> <span class="o">=</span> <span class="n">test_signal</span><span class="p">(</span><span class="n">starttime</span><span class="o">=</span><span class="n">_tstart</span><span class="p">,</span>
                    <span class="n">sampling_rate</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                    <span class="n">nsec</span><span class="o">=</span><span class="mi">86400</span><span class="p">,</span> <span class="n">gaps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">network</span><span class="o">=</span><span class="n">net</span><span class="p">,</span> <span class="n">station</span><span class="o">=</span><span class="n">site</span><span class="p">,</span>  
                    <span class="n">location</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="n">comp</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">_tstart</span> <span class="o">&lt;</span> <span class="n">tend</span><span class="p">:</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span> <span class="o">=</span> <span class="n">_tstart</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save2sds</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">rootdir</span><span class="p">)</span>
        <span class="n">_tstart</span> <span class="o">+=</span> <span class="mi">86400</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zizou.data.MockSDSWaveforms.get_waveforms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_waveforms</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Generate synthetic daily files that start at midnight on the
startdate and end at midnight on the enddate. The return the requested
timespan from these files.</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/data.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_waveforms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate synthetic daily files that start at midnight on the</span>
<span class="sd">    startdate and end at midnight on the enddate. The return the requested</span>
<span class="sd">    timespan from these files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">generate_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">sds_root</span><span class="p">,</span> <span class="n">net</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span>
                          <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="n">st</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get_waveforms</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span>
                                   <span class="n">enddate</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">st</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zizou.data.MockSDSWaveforms.save2sds" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save2sds</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">rootdir</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Save a trace to a SDS directory structure.</p>
<h6 id="zizou.data.MockSDSWaveforms.save2sds--parameters">Parameters</h6>
<p>trace : <code>obspy.Trace</code> 
    Seismic/acoustic trace to be written to disk. 
rootdir : str 
    Root directory for the SDS directory structure.</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/data.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save2sds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span><span class="p">:</span> <span class="n">Trace</span><span class="p">,</span> <span class="n">rootdir</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save a trace to a SDS directory structure.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    trace : `obspy.Trace` </span>
<span class="sd">        Seismic/acoustic trace to be written to disk. </span>
<span class="sd">    rootdir : str </span>
<span class="sd">        Root directory for the SDS directory structure. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sds_fmtstr</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">{year}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{network}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{station}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{channel}</span><span class="s2">.</span><span class="si">{sds_type}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="si">{network}</span><span class="s2">.</span><span class="si">{station}</span><span class="s2">.</span><span class="si">{location}</span><span class="s2">.</span><span class="si">{channel}</span><span class="s2">.</span><span class="si">{sds_type}</span><span class="s2">.</span><span class="si">{year}</span><span class="s2">.</span><span class="si">{doy:03d}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">fullpath</span> <span class="o">=</span> <span class="n">sds_fmtstr</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
                                <span class="n">doy</span><span class="o">=</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span><span class="o">.</span><span class="n">julday</span><span class="p">,</span>
                                <span class="n">sds_type</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="p">)</span>
    <span class="n">fullpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rootdir</span><span class="p">,</span> <span class="n">fullpath</span><span class="p">)</span>
    <span class="n">dirname</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">fullpath</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;writing&quot;</span><span class="p">,</span> <span class="n">fullpath</span><span class="p">)</span>
    <span class="n">trace</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fullpath</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;mseed&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="zizou.data.PostProcess" class="doc doc-heading">
            <code>PostProcess</code>


</h3>


    <div class="doc doc-contents ">


      <p>Class for checking waveforms and station metadata for valid values,
filling waveform data gaps and removing instrument sensitivity</p>

              <details class="quote">
                <summary>Source code in <code>src/zizou/data.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PostProcess</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for checking waveforms and station metadata for valid values,</span>
<span class="sd">    filling waveform data gaps and removing instrument sensitivity</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">st</span><span class="o">=</span><span class="n">Stream</span><span class="p">(),</span> <span class="n">inv</span><span class="o">=</span><span class="n">Inventory</span><span class="p">(),</span> <span class="n">inv_dt</span><span class="o">=</span><span class="n">Inventory</span><span class="p">(),</span>
                 <span class="n">startdate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">enddate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="s1">&#39;*Z&#39;</span><span class="p">,</span>
                 <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">st</span> <span class="o">=</span> <span class="n">st</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inv</span> <span class="o">=</span> <span class="n">inv</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span> <span class="o">=</span> <span class="n">inv_dt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startdate</span> <span class="o">=</span> <span class="n">startdate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enddate</span> <span class="o">=</span> <span class="n">enddate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc</span> <span class="o">=</span> <span class="n">loc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp</span> <span class="o">=</span> <span class="n">comp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span> <span class="o">=</span> <span class="n">fill_value</span>

        <span class="c1"># Get check registry</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checklist</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">ismethod</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;check&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="c1"># Get matching post-processing functions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pp_functions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">check</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">checklist</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pp_functions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                 <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">check</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;check&quot;</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">)</span>
                 <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># Run checks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">run_post_processing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_checks</span><span class="p">()</span>
        <span class="n">func</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pp_functions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">res</span><span class="p">)</span> <span class="k">if</span> <span class="n">b</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="n">func</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">trace</span>

    <span class="k">def</span> <span class="nf">run_checks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="n">check</span><span class="p">[</span><span class="mi">1</span><span class="p">]()</span> <span class="k">for</span> <span class="n">check</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">checklist</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s1">&#39;No post processing not set up for this case:</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;More than one check is true: </span><span class="si">{}</span><span class="s1">. Processing workflow &#39;</span> \
                  <span class="s1">&#39;is unclear.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checklist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">res</span><span class="p">)</span> <span class="k">if</span> <span class="n">b</span><span class="p">])</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">PostProcessException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">res</span>

    <span class="k">def</span> <span class="nf">check_case_no_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if either no stream, or no station metadata exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start_date</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">enddate</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">end_date</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">startdate</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">output_case_no_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span>  <span class="n">PostProcessException</span>

    <span class="k">def</span> <span class="nf">check_case_multiple_channel_periods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if there are multiple channel operation periods in a given</span>
<span class="sd">        time period. If so, different response removal is required.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">output_case_multiple_channel_periods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stitches two response periods together to make a single merged</span>
<span class="sd">        trace.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s1">&#39;Current post processing function only valid for a &#39;</span>
                <span class="s1">&#39;maximum of two response periods.&#39;</span>
            <span class="p">)</span>
        <span class="n">st1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">st1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span><span class="p">)</span>
        <span class="n">st2</span> <span class="o">=</span> <span class="n">st1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">st1</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">starttime</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">startdate</span><span class="p">,</span> <span class="n">endtime</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span>
                 <span class="n">nearest_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">st2</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">starttime</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">start_date</span><span class="p">,</span> <span class="n">endtime</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">enddate</span><span class="p">,</span>
                 <span class="n">nearest_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">st1</span><span class="o">.</span><span class="n">attach_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">)</span>
        <span class="n">st1</span><span class="o">.</span><span class="n">remove_sensitivity</span><span class="p">()</span>
        <span class="n">st2</span><span class="o">.</span><span class="n">attach_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">)</span>
        <span class="n">st2</span><span class="o">.</span><span class="n">remove_sensitivity</span><span class="p">()</span>
        <span class="n">st1</span> <span class="o">+=</span> <span class="n">st2</span>
        <span class="n">st1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span><span class="p">)</span>
        <span class="n">st1</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">startdate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">enddate</span><span class="p">,</span> <span class="n">nearest_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">pad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">st1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">check_case_incomplete_station_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The case where a a channel period start/stops during the</span>
<span class="sd">        selected time window. Some parts of the trace in the stream</span>
<span class="sd">        might not correspond to a valid period according to station</span>
<span class="sd">        metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">startdate</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start_date</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">enddate</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startdate</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">end_date</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">enddate</span><span class="p">)):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">output_case_incomplete_station_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start_date</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">startdate</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start_date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">enddate</span><span class="p">,</span>
                         <span class="n">nearest_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="o">.</span><span class="n">attach_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="o">.</span><span class="n">remove_sensitivity</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">startdate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">enddate</span><span class="p">,</span> <span class="n">nearest_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">pad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">end_date</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">enddate</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startdate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span>
                         <span class="n">nearest_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="o">.</span><span class="n">attach_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="o">.</span><span class="n">remove_sensitivity</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">startdate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">enddate</span><span class="p">,</span> <span class="n">nearest_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">pad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PostProcessException</span><span class="p">(</span><span class="s1">&#39;Post-procesing function not equipped to&#39;</span>
                            <span class="s1">&#39;handle:</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="p">)</span>
                            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_case_no_station_issues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">end_date</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">startdate</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start_date</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">enddate</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startdate</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start_date</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">enddate</span><span class="p">)</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startdate</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">end_date</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">enddate</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">output_case_no_station_issues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span>
            <span class="n">starttime</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">startdate</span><span class="p">,</span> <span class="n">endtime</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">enddate</span><span class="p">,</span>
            <span class="n">nearest_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="o">.</span><span class="n">attach_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="o">.</span><span class="n">remove_sensitivity</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="zizou.data.PostProcess.check_case_incomplete_station_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_case_incomplete_station_metadata</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>The case where a a channel period start/stops during the
selected time window. Some parts of the trace in the stream
might not correspond to a valid period according to station
metadata.</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/data.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check_case_incomplete_station_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The case where a a channel period start/stops during the</span>
<span class="sd">    selected time window. Some parts of the trace in the stream</span>
<span class="sd">    might not correspond to a valid period according to station</span>
<span class="sd">    metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">startdate</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start_date</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">enddate</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startdate</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">end_date</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">enddate</span><span class="p">)):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zizou.data.PostProcess.check_case_multiple_channel_periods" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_case_multiple_channel_periods</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Checks if there are multiple channel operation periods in a given
time period. If so, different response removal is required.</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/data.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check_case_multiple_channel_periods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if there are multiple channel operation periods in a given</span>
<span class="sd">    time period. If so, different response removal is required.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zizou.data.PostProcess.check_case_no_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_case_no_data</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Checks if either no stream, or no station metadata exist.</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/data.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check_case_no_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if either no stream, or no station metadata exist.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start_date</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">enddate</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">end_date</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">startdate</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zizou.data.PostProcess.output_case_multiple_channel_periods" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">output_case_multiple_channel_periods</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Stitches two response periods together to make a single merged
trace.</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/data.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">output_case_multiple_channel_periods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stitches two response periods together to make a single merged</span>
<span class="sd">    trace.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s1">&#39;Current post processing function only valid for a &#39;</span>
            <span class="s1">&#39;maximum of two response periods.&#39;</span>
        <span class="p">)</span>
    <span class="n">st1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">st1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span><span class="p">)</span>
    <span class="n">st2</span> <span class="o">=</span> <span class="n">st1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">st1</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">starttime</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">startdate</span><span class="p">,</span> <span class="n">endtime</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span>
             <span class="n">nearest_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">st2</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">starttime</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">start_date</span><span class="p">,</span> <span class="n">endtime</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">enddate</span><span class="p">,</span>
             <span class="n">nearest_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">st1</span><span class="o">.</span><span class="n">attach_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">)</span>
    <span class="n">st1</span><span class="o">.</span><span class="n">remove_sensitivity</span><span class="p">()</span>
    <span class="n">st2</span><span class="o">.</span><span class="n">attach_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_dt</span><span class="p">)</span>
    <span class="n">st2</span><span class="o">.</span><span class="n">remove_sensitivity</span><span class="p">()</span>
    <span class="n">st1</span> <span class="o">+=</span> <span class="n">st2</span>
    <span class="n">st1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span><span class="p">)</span>
    <span class="n">st1</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startdate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">enddate</span><span class="p">,</span> <span class="n">nearest_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">pad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">st1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="zizou.data.S3Waveforms" class="doc doc-heading">
            <code>S3Waveforms</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="zizou.data.WaveformBaseclass">WaveformBaseclass</span></code></p>


              <details class="quote">
                <summary>Source code in <code>src/zizou/data.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">S3Waveforms</span><span class="p">(</span><span class="n">WaveformBaseclass</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s3bucket</span><span class="p">,</span> <span class="n">fdsn_urls</span><span class="p">,</span> <span class="n">staxml_dir</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">):</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">signature_version</span><span class="o">=</span><span class="n">UNSIGNED</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s3_bucket</span> <span class="o">=</span> <span class="n">s3bucket</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">fdsn_urls</span> <span class="o">=</span> <span class="n">fdsn_urls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">staxml_dir</span> <span class="o">=</span> <span class="n">staxml_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span> <span class="o">=</span> <span class="n">fill_value</span>


    <span class="k">def</span> <span class="nf">get_waveforms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get seismic waveforms from GeoNet&#39;s open data archive on AWS S3.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">PATH_FORMAT</span> <span class="o">=</span> <span class="s2">&quot;waveforms/miniseed/</span><span class="si">{year}</span><span class="s2">/</span><span class="si">{year}</span><span class="s2">.</span><span class="si">{julday:03d}</span><span class="s2">/</span><span class="si">{station}</span><span class="s2">.&quot;</span>
        <span class="n">PATH_FORMAT</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{network}</span><span class="s2">/</span><span class="si">{year}</span><span class="s2">.</span><span class="si">{julday:03d}</span><span class="s2">.</span><span class="si">{station}</span><span class="s2">.&quot;</span>
        <span class="n">PATH_FORMAT</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{location}</span><span class="s2">-</span><span class="si">{channel}</span><span class="s2">.</span><span class="si">{network}</span><span class="s2">.D&quot;</span>
        <span class="n">t_start</span> <span class="o">=</span> <span class="n">start</span>
        <span class="n">t_end</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">t_start</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
                            <span class="n">julday</span><span class="o">=</span><span class="n">t_start</span><span class="o">.</span><span class="n">julday</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="n">hour</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                            <span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">microsecond</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">t_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">t_end</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">t_start</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">:</span>
            <span class="n">s3_file_path</span> <span class="o">=</span> <span class="n">PATH_FORMAT</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">t_start</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
                                              <span class="n">julday</span><span class="o">=</span><span class="n">t_start</span><span class="o">.</span><span class="n">julday</span><span class="p">,</span>
                                              <span class="n">station</span><span class="o">=</span><span class="n">site</span><span class="p">,</span>
                                              <span class="n">network</span><span class="o">=</span><span class="n">net</span><span class="p">,</span>
                                              <span class="n">location</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span>
                                              <span class="n">channel</span><span class="o">=</span><span class="n">comp</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Requesting </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s3_file_path</span><span class="p">))</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">download_fileobj</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">s3_bucket</span><span class="p">,</span>
                                             <span class="n">Key</span><span class="o">=</span><span class="n">s3_file_path</span><span class="p">,</span>
                                             <span class="n">Fileobj</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">_st</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">_st</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">,</span> <span class="n">nearest_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">st</span> <span class="o">+=</span> <span class="n">_st</span>
            <span class="n">t_start</span> <span class="o">=</span> <span class="n">t_end</span>
            <span class="n">t_end</span> <span class="o">=</span> <span class="n">t_start</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">t_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">t_end</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

        <span class="n">st</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span><span class="p">)</span>
        <span class="n">inv</span> <span class="o">=</span> <span class="n">get_instrument_response</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span>
                                      <span class="n">staxml_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">staxml_dir</span><span class="p">,</span>
                                      <span class="n">fdsn_urls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fdsn_urls</span><span class="p">)</span>
        <span class="n">inv_dt</span> <span class="o">=</span> <span class="n">inv</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="n">comp</span><span class="p">,</span>
                            <span class="n">starttime</span><span class="o">=</span><span class="n">t_start</span><span class="p">,</span>
                            <span class="n">endtime</span><span class="o">=</span><span class="n">t_end</span><span class="p">)</span>

        <span class="c1"># Post-process to remove sensitivity and account for gaps</span>
        <span class="n">pp</span> <span class="o">=</span> <span class="n">PostProcess</span><span class="p">(</span><span class="n">st</span><span class="o">=</span><span class="n">st</span><span class="p">,</span> <span class="n">inv</span><span class="o">=</span><span class="n">inv</span><span class="p">,</span> <span class="n">inv_dt</span><span class="o">=</span><span class="n">inv_dt</span><span class="p">,</span>
                         <span class="n">startdate</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">enddate</span><span class="o">=</span><span class="n">end</span><span class="p">,</span>
                         <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="n">comp</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span><span class="p">)</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">run_post_processing</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">tr</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="zizou.data.S3Waveforms.get_waveforms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_waveforms</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Get seismic waveforms from GeoNet's open data archive on AWS S3.</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/data.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_waveforms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get seismic waveforms from GeoNet&#39;s open data archive on AWS S3.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">PATH_FORMAT</span> <span class="o">=</span> <span class="s2">&quot;waveforms/miniseed/</span><span class="si">{year}</span><span class="s2">/</span><span class="si">{year}</span><span class="s2">.</span><span class="si">{julday:03d}</span><span class="s2">/</span><span class="si">{station}</span><span class="s2">.&quot;</span>
    <span class="n">PATH_FORMAT</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{network}</span><span class="s2">/</span><span class="si">{year}</span><span class="s2">.</span><span class="si">{julday:03d}</span><span class="s2">.</span><span class="si">{station}</span><span class="s2">.&quot;</span>
    <span class="n">PATH_FORMAT</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{location}</span><span class="s2">-</span><span class="si">{channel}</span><span class="s2">.</span><span class="si">{network}</span><span class="s2">.D&quot;</span>
    <span class="n">t_start</span> <span class="o">=</span> <span class="n">start</span>
    <span class="n">t_end</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">t_start</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
                        <span class="n">julday</span><span class="o">=</span><span class="n">t_start</span><span class="o">.</span><span class="n">julday</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">hour</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">microsecond</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">t_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">t_end</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
    <span class="n">st</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">()</span>
    <span class="k">while</span> <span class="n">t_start</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">:</span>
        <span class="n">s3_file_path</span> <span class="o">=</span> <span class="n">PATH_FORMAT</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">t_start</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
                                          <span class="n">julday</span><span class="o">=</span><span class="n">t_start</span><span class="o">.</span><span class="n">julday</span><span class="p">,</span>
                                          <span class="n">station</span><span class="o">=</span><span class="n">site</span><span class="p">,</span>
                                          <span class="n">network</span><span class="o">=</span><span class="n">net</span><span class="p">,</span>
                                          <span class="n">location</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span>
                                          <span class="n">channel</span><span class="o">=</span><span class="n">comp</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Requesting </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s3_file_path</span><span class="p">))</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">download_fileobj</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">s3_bucket</span><span class="p">,</span>
                                         <span class="n">Key</span><span class="o">=</span><span class="n">s3_file_path</span><span class="p">,</span>
                                         <span class="n">Fileobj</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">_st</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">_st</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">,</span> <span class="n">nearest_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">st</span> <span class="o">+=</span> <span class="n">_st</span>
        <span class="n">t_start</span> <span class="o">=</span> <span class="n">t_end</span>
        <span class="n">t_end</span> <span class="o">=</span> <span class="n">t_start</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">t_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">t_end</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

    <span class="n">st</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span><span class="p">)</span>
    <span class="n">inv</span> <span class="o">=</span> <span class="n">get_instrument_response</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span>
                                  <span class="n">staxml_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">staxml_dir</span><span class="p">,</span>
                                  <span class="n">fdsn_urls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fdsn_urls</span><span class="p">)</span>
    <span class="n">inv_dt</span> <span class="o">=</span> <span class="n">inv</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="n">comp</span><span class="p">,</span>
                        <span class="n">starttime</span><span class="o">=</span><span class="n">t_start</span><span class="p">,</span>
                        <span class="n">endtime</span><span class="o">=</span><span class="n">t_end</span><span class="p">)</span>

    <span class="c1"># Post-process to remove sensitivity and account for gaps</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="n">PostProcess</span><span class="p">(</span><span class="n">st</span><span class="o">=</span><span class="n">st</span><span class="p">,</span> <span class="n">inv</span><span class="o">=</span><span class="n">inv</span><span class="p">,</span> <span class="n">inv_dt</span><span class="o">=</span><span class="n">inv_dt</span><span class="p">,</span>
                     <span class="n">startdate</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">enddate</span><span class="o">=</span><span class="n">end</span><span class="p">,</span>
                     <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="n">comp</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span><span class="p">)</span>
    <span class="n">tr</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">run_post_processing</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">tr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="zizou.data.SDSWaveforms" class="doc doc-heading">
            <code>SDSWaveforms</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="zizou.data.WaveformBaseclass">WaveformBaseclass</span></code></p>


              <details class="quote">
                <summary>Source code in <code>src/zizou/data.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SDSWaveforms</span><span class="p">(</span><span class="n">WaveformBaseclass</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sds_dir</span><span class="p">,</span> <span class="n">fdsn_urls</span><span class="p">,</span> <span class="n">staxml_dir</span><span class="p">,</span>
                 <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get seismic waveforms from a local SDS archive.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">SDS_Client</span><span class="p">(</span><span class="n">sds_dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fdsn_urls</span> <span class="o">=</span> <span class="n">fdsn_urls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">staxml_dir</span> <span class="o">=</span> <span class="n">staxml_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span> <span class="o">=</span> <span class="n">fill_value</span>

    <span class="k">def</span> <span class="nf">get_waveforms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param fill_value: Default value used to fill gaps and pad traces to</span>
<span class="sd">                           cover the whole time period defined by `startdate`</span>
<span class="sd">                           and `enddate`. If &#39;interpolate&#39; is chosen, the</span>
<span class="sd">                           traces will not be padded.</span>
<span class="sd">        :type fill_value: int, float, &#39;interpolate&#39;, np.nan, or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inv</span> <span class="o">=</span> <span class="n">get_instrument_response</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span>
                                      <span class="n">staxml_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">staxml_dir</span><span class="p">,</span>
                                      <span class="n">fdsn_urls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fdsn_urls</span><span class="p">)</span>

        <span class="n">st</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get_waveforms</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span>
                                       <span class="n">enddate</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>

        <span class="n">inv_dt</span> <span class="o">=</span> <span class="n">inv</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="n">comp</span><span class="p">,</span>
                            <span class="n">starttime</span><span class="o">=</span><span class="n">startdate</span><span class="p">,</span>
                            <span class="n">endtime</span><span class="o">=</span><span class="n">enddate</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Post-process to remove sensitivity and account for gaps</span>
        <span class="n">pp</span> <span class="o">=</span> <span class="n">PostProcess</span><span class="p">(</span><span class="n">st</span><span class="o">=</span><span class="n">st</span><span class="p">,</span> <span class="n">inv</span><span class="o">=</span><span class="n">inv</span><span class="p">,</span> <span class="n">inv_dt</span><span class="o">=</span><span class="n">inv_dt</span><span class="p">,</span>
                         <span class="n">startdate</span><span class="o">=</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="o">=</span><span class="n">enddate</span><span class="p">,</span>
                         <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="n">comp</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span><span class="p">)</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">run_post_processing</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">tr</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="zizou.data.SDSWaveforms.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">sds_dir</span><span class="p">,</span> <span class="n">fdsn_urls</span><span class="p">,</span> <span class="n">staxml_dir</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Get seismic waveforms from a local SDS archive.</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/data.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sds_dir</span><span class="p">,</span> <span class="n">fdsn_urls</span><span class="p">,</span> <span class="n">staxml_dir</span><span class="p">,</span>
             <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get seismic waveforms from a local SDS archive.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">SDS_Client</span><span class="p">(</span><span class="n">sds_dir</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fdsn_urls</span> <span class="o">=</span> <span class="n">fdsn_urls</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">staxml_dir</span> <span class="o">=</span> <span class="n">staxml_dir</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span> <span class="o">=</span> <span class="n">fill_value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zizou.data.SDSWaveforms.get_waveforms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_waveforms</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>fill_value</code></b>
                  (<code>int, float, &#39;interpolate&#39;, np.nan, | None</code>)
              –
              <div class="doc-md-description">
                <p>Default value used to fill gaps and pad traces to cover the whole time period defined by <code>startdate</code> and <code>enddate</code>. If 'interpolate' is chosen, the traces will not be padded.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>src/zizou/data.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_waveforms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param fill_value: Default value used to fill gaps and pad traces to</span>
<span class="sd">                       cover the whole time period defined by `startdate`</span>
<span class="sd">                       and `enddate`. If &#39;interpolate&#39; is chosen, the</span>
<span class="sd">                       traces will not be padded.</span>
<span class="sd">    :type fill_value: int, float, &#39;interpolate&#39;, np.nan, or None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">inv</span> <span class="o">=</span> <span class="n">get_instrument_response</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span>
                                  <span class="n">staxml_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">staxml_dir</span><span class="p">,</span>
                                  <span class="n">fdsn_urls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fdsn_urls</span><span class="p">)</span>

    <span class="n">st</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get_waveforms</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span>
                                   <span class="n">enddate</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>

    <span class="n">inv_dt</span> <span class="o">=</span> <span class="n">inv</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="n">comp</span><span class="p">,</span>
                        <span class="n">starttime</span><span class="o">=</span><span class="n">startdate</span><span class="p">,</span>
                        <span class="n">endtime</span><span class="o">=</span><span class="n">enddate</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Post-process to remove sensitivity and account for gaps</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="n">PostProcess</span><span class="p">(</span><span class="n">st</span><span class="o">=</span><span class="n">st</span><span class="p">,</span> <span class="n">inv</span><span class="o">=</span><span class="n">inv</span><span class="p">,</span> <span class="n">inv_dt</span><span class="o">=</span><span class="n">inv_dt</span><span class="p">,</span>
                     <span class="n">startdate</span><span class="o">=</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="o">=</span><span class="n">enddate</span><span class="p">,</span>
                     <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="n">comp</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span><span class="p">)</span>
    <span class="n">tr</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">run_post_processing</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">tr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="zizou.data.VolcanoMetadata" class="doc doc-heading">
            <code>VolcanoMetadata</code>


</h3>


    <div class="doc doc-contents ">


      <p>Read volcano/station/channel metadata</p>

              <details class="quote">
                <summary>Source code in <code>src/zizou/data.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">VolcanoMetadata</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read volcano/station/channel metadata</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configfile</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">configfile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
                <span class="n">cfg</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">configfile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_available_volcanoes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">vol</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">vol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;volcano&#39;</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">get_available_streams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volcano</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get available sensor streams for a given volcano.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        volcano : str</span>
<span class="sd">            Volcano name </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list </span>
<span class="sd">            List of streams in the format &#39;NET.STA.LOC.CHAN&#39; </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_streams</span> <span class="o">=</span> <span class="p">[]</span> 
        <span class="k">for</span> <span class="n">_v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;volcano&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">_v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">volcano</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">_n</span> <span class="ow">in</span> <span class="n">_v</span><span class="p">[</span><span class="s1">&#39;network&#39;</span><span class="p">]:</span>
                    <span class="n">net_code</span> <span class="o">=</span> <span class="n">_n</span><span class="p">[</span><span class="s1">&#39;net_code&#39;</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">_s</span> <span class="ow">in</span> <span class="n">_n</span><span class="p">[</span><span class="s1">&#39;stations&#39;</span><span class="p">]:</span>
                        <span class="n">sta_code</span> <span class="o">=</span> <span class="n">_s</span><span class="p">[</span><span class="s1">&#39;sta_code&#39;</span><span class="p">]</span>
                        <span class="n">location</span> <span class="o">=</span> <span class="n">_s</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">_c</span> <span class="ow">in</span> <span class="n">_s</span><span class="p">[</span><span class="s1">&#39;channel&#39;</span><span class="p">]:</span>
                            <span class="n">chan_code</span> <span class="o">=</span> <span class="n">_c</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span>
                            <span class="n">_stream</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">net_code</span><span class="p">,</span> <span class="n">sta_code</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">chan_code</span><span class="p">))</span>
                            <span class="n">_streams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_stream</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_streams</span>

    <span class="k">def</span> <span class="nf">get_site_information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sitename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get site information for a given site. Note </span>
<span class="sd">        that if the same site name exists at multiple</span>
<span class="sd">        volcanoes, the first match will be returned.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sitename : str </span>
<span class="sd">            Three-letter site code. </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict </span>
<span class="sd">            Dictionary with site information as follows:</span>
<span class="sd">            {&#39;volcano&#39;: str, &#39;site&#39;: str, &#39;channels&#39;: list, </span>
<span class="sd">             &#39;latitude&#39;: float, &#39;longitude&#39;: float, &#39;starttime&#39;: datetime}            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">_v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;volcano&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">_n</span> <span class="ow">in</span> <span class="n">_v</span><span class="p">[</span><span class="s1">&#39;network&#39;</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">_s</span> <span class="ow">in</span> <span class="n">_n</span><span class="p">[</span><span class="s1">&#39;stations&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">_s</span><span class="p">[</span><span class="s1">&#39;sta_code&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sitename</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">starttime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">_s</span><span class="p">[</span><span class="s1">&#39;starttime&#39;</span><span class="p">],</span>
                                                        <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%SZ&quot;</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                            <span class="n">starttime</span> <span class="o">=</span> <span class="kc">None</span>

                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">channels</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">_s</span><span class="p">[</span><span class="s1">&#39;channel&#39;</span><span class="p">]]</span>
                        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                            <span class="n">channels</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">volcano</span><span class="o">=</span><span class="n">_v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                                    <span class="n">site</span><span class="o">=</span><span class="n">_s</span><span class="p">[</span><span class="s1">&#39;sta_code&#39;</span><span class="p">],</span>
                                    <span class="n">channels</span><span class="o">=</span><span class="n">channels</span><span class="p">,</span>
                                    <span class="n">latitude</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">_s</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]),</span>
                                    <span class="n">longitude</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">_s</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span>
                                    <span class="n">starttime</span><span class="o">=</span><span class="n">starttime</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">get_eruption_dates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volcano</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get eruption dates for a given volcano.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        volcano : str </span>
<span class="sd">            Volcano name. </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list </span>
<span class="sd">            List of datetime.date objects representing eruption dates. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">eruption_dates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;volcano&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">volcano</span><span class="p">]</span>
        <span class="n">er</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;eruptions&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">er</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">er</span><span class="p">:</span>
                <span class="n">d</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
                <span class="n">eruption_dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">eruption_dates</span>

    <span class="k">def</span> <span class="nf">get_unrest_periods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volcano</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get unrest periods for a given volcano.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        volcano : str </span>
<span class="sd">            Volcano name. </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list </span>
<span class="sd">            List of datetime.date objects representing start and end dates. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">unrest_dates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;volcano&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">volcano</span><span class="p">]</span>
        <span class="n">ur</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;unrest periods&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ur</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">ur</span><span class="p">:</span>
                <span class="n">ds</span><span class="p">,</span> <span class="n">ms</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="s1">&#39;starttime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
                <span class="n">de</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">ye</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="s1">&#39;endtime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
                <span class="n">unrest_dates</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">date</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ys</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">ms</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">ds</span><span class="p">)),</span>
                                     <span class="n">date</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ye</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">me</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">de</span><span class="p">))])</span>
        <span class="k">return</span> <span class="n">unrest_dates</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="zizou.data.VolcanoMetadata.get_available_streams" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_available_streams</span><span class="p">(</span><span class="n">volcano</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Get available sensor streams for a given volcano.</p>
<h6 id="zizou.data.VolcanoMetadata.get_available_streams--parameters">Parameters</h6>
<p>volcano : str
    Volcano name </p>
<h6 id="zizou.data.VolcanoMetadata.get_available_streams--returns">Returns</h6>
<p>list 
    List of streams in the format 'NET.STA.LOC.CHAN'</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/data.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_available_streams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volcano</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get available sensor streams for a given volcano.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    volcano : str</span>
<span class="sd">        Volcano name </span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list </span>
<span class="sd">        List of streams in the format &#39;NET.STA.LOC.CHAN&#39; </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_streams</span> <span class="o">=</span> <span class="p">[]</span> 
    <span class="k">for</span> <span class="n">_v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;volcano&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">_v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">volcano</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">_n</span> <span class="ow">in</span> <span class="n">_v</span><span class="p">[</span><span class="s1">&#39;network&#39;</span><span class="p">]:</span>
                <span class="n">net_code</span> <span class="o">=</span> <span class="n">_n</span><span class="p">[</span><span class="s1">&#39;net_code&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">_s</span> <span class="ow">in</span> <span class="n">_n</span><span class="p">[</span><span class="s1">&#39;stations&#39;</span><span class="p">]:</span>
                    <span class="n">sta_code</span> <span class="o">=</span> <span class="n">_s</span><span class="p">[</span><span class="s1">&#39;sta_code&#39;</span><span class="p">]</span>
                    <span class="n">location</span> <span class="o">=</span> <span class="n">_s</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">_c</span> <span class="ow">in</span> <span class="n">_s</span><span class="p">[</span><span class="s1">&#39;channel&#39;</span><span class="p">]:</span>
                        <span class="n">chan_code</span> <span class="o">=</span> <span class="n">_c</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span>
                        <span class="n">_stream</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">net_code</span><span class="p">,</span> <span class="n">sta_code</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">chan_code</span><span class="p">))</span>
                        <span class="n">_streams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_stream</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_streams</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zizou.data.VolcanoMetadata.get_eruption_dates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_eruption_dates</span><span class="p">(</span><span class="n">volcano</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Get eruption dates for a given volcano.</p>
<h6 id="zizou.data.VolcanoMetadata.get_eruption_dates--parameters">Parameters</h6>
<p>volcano : str 
    Volcano name. </p>
<h6 id="zizou.data.VolcanoMetadata.get_eruption_dates--returns">Returns</h6>
<p>list 
    List of datetime.date objects representing eruption dates.</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/data.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_eruption_dates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volcano</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get eruption dates for a given volcano.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    volcano : str </span>
<span class="sd">        Volcano name. </span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list </span>
<span class="sd">        List of datetime.date objects representing eruption dates. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">eruption_dates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;volcano&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">volcano</span><span class="p">]</span>
    <span class="n">er</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;eruptions&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">er</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">er</span><span class="p">:</span>
            <span class="n">d</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
            <span class="n">eruption_dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">eruption_dates</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zizou.data.VolcanoMetadata.get_site_information" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_site_information</span><span class="p">(</span><span class="n">sitename</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Get site information for a given site. Note 
that if the same site name exists at multiple
volcanoes, the first match will be returned.</p>
<h6 id="zizou.data.VolcanoMetadata.get_site_information--parameters">Parameters</h6>
<p>sitename : str 
    Three-letter site code. </p>
<h6 id="zizou.data.VolcanoMetadata.get_site_information--returns">Returns</h6>
<p>dict 
    Dictionary with site information as follows:
    {'volcano': str, 'site': str, 'channels': list, 
     'latitude': float, 'longitude': float, 'starttime': datetime}</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/data.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_site_information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sitename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get site information for a given site. Note </span>
<span class="sd">    that if the same site name exists at multiple</span>
<span class="sd">    volcanoes, the first match will be returned.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sitename : str </span>
<span class="sd">        Three-letter site code. </span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict </span>
<span class="sd">        Dictionary with site information as follows:</span>
<span class="sd">        {&#39;volcano&#39;: str, &#39;site&#39;: str, &#39;channels&#39;: list, </span>
<span class="sd">         &#39;latitude&#39;: float, &#39;longitude&#39;: float, &#39;starttime&#39;: datetime}            </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">_v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;volcano&#39;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">_n</span> <span class="ow">in</span> <span class="n">_v</span><span class="p">[</span><span class="s1">&#39;network&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">_s</span> <span class="ow">in</span> <span class="n">_n</span><span class="p">[</span><span class="s1">&#39;stations&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">_s</span><span class="p">[</span><span class="s1">&#39;sta_code&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sitename</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">starttime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">_s</span><span class="p">[</span><span class="s1">&#39;starttime&#39;</span><span class="p">],</span>
                                                    <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%SZ&quot;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="n">starttime</span> <span class="o">=</span> <span class="kc">None</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">channels</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">_s</span><span class="p">[</span><span class="s1">&#39;channel&#39;</span><span class="p">]]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="n">channels</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">volcano</span><span class="o">=</span><span class="n">_v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                                <span class="n">site</span><span class="o">=</span><span class="n">_s</span><span class="p">[</span><span class="s1">&#39;sta_code&#39;</span><span class="p">],</span>
                                <span class="n">channels</span><span class="o">=</span><span class="n">channels</span><span class="p">,</span>
                                <span class="n">latitude</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">_s</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]),</span>
                                <span class="n">longitude</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">_s</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span>
                                <span class="n">starttime</span><span class="o">=</span><span class="n">starttime</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zizou.data.VolcanoMetadata.get_unrest_periods" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_unrest_periods</span><span class="p">(</span><span class="n">volcano</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Get unrest periods for a given volcano.</p>
<h6 id="zizou.data.VolcanoMetadata.get_unrest_periods--parameters">Parameters</h6>
<p>volcano : str 
    Volcano name. </p>
<h6 id="zizou.data.VolcanoMetadata.get_unrest_periods--returns">Returns</h6>
<p>list 
    List of datetime.date objects representing start and end dates.</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/data.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_unrest_periods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volcano</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get unrest periods for a given volcano.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    volcano : str </span>
<span class="sd">        Volcano name. </span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list </span>
<span class="sd">        List of datetime.date objects representing start and end dates. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unrest_dates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;volcano&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">volcano</span><span class="p">]</span>
    <span class="n">ur</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;unrest periods&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">ur</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">ur</span><span class="p">:</span>
            <span class="n">ds</span><span class="p">,</span> <span class="n">ms</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="s1">&#39;starttime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
            <span class="n">de</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">ye</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="s1">&#39;endtime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
            <span class="n">unrest_dates</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">date</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ys</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">ms</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">ds</span><span class="p">)),</span>
                                 <span class="n">date</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ye</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">me</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">de</span><span class="p">))])</span>
    <span class="k">return</span> <span class="n">unrest_dates</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="zizou.data.get_instrument_response" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_instrument_response</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">staxml_dir</span><span class="o">=</span><span class="s1">&#39;./instrument_response&#39;</span><span class="p">,</span> <span class="n">fdsn_urls</span><span class="o">=</span><span class="s1">&#39;https://service.geonet.org.nz&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Retrieve instrument response file in STATIONXML format.</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/data.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_instrument_response</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span>
                            <span class="n">staxml_dir</span><span class="o">=</span><span class="s1">&#39;./instrument_response&#39;</span><span class="p">,</span>
                            <span class="n">fdsn_urls</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;https://service.geonet.org.nz&#39;</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve instrument response file in STATIONXML format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">.xml&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">staxml_dir</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">inv</span> <span class="o">=</span> <span class="n">read_inventory</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;STATIONXML&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">staxml_dir</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">fdsn_urls</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">client</span> <span class="o">=</span> <span class="n">FDSN_Client</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
                <span class="n">inv</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_stations</span><span class="p">(</span><span class="n">network</span><span class="o">=</span><span class="n">net</span><span class="p">,</span>
                                          <span class="n">location</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span>
                                          <span class="n">station</span><span class="o">=</span><span class="n">site</span><span class="p">,</span>
                                          <span class="n">channel</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span>
                                          <span class="n">level</span><span class="o">=</span><span class="s1">&#39;response&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="n">inv</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;STATIONXML&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">inv</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="zizou.rsam"></a>
    <div class="doc doc-contents first">

      <p>Compute the Real-time Seismic-Amplitude Measurement (RSAM).</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="zizou.rsam.EnergyExplainedByRSAM" class="doc doc-heading">
            <code>EnergyExplainedByRSAM</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="zizou.rsam.RSAM" href="#zizou.rsam.RSAM">RSAM</a></code></p>


      <p>The proportion of signal energy in the RSAM
bandwidth, relative to a 0.5-10 Hz bandwidth.</p>

              <details class="quote">
                <summary>Source code in <code>src/zizou/rsam.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">EnergyExplainedByRSAM</span><span class="p">(</span><span class="n">RSAM</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The proportion of signal energy in the RSAM</span>
<span class="sd">    bandwidth, relative to a 0.5-10 Hz bandwidth.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;rsam_energy_prop&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">interval</span><span class="o">=</span><span class="mf">600.</span><span class="p">,</span>
        <span class="n">filtertype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">filterfreq</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="n">filtertype_wb</span><span class="o">=</span><span class="s2">&quot;bandpass&quot;</span><span class="p">,</span>
        <span class="n">filterfreq_wb</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">10.</span><span class="p">),</span>
        <span class="n">configfile</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">EnergyExplainedByRSAM</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">interval</span><span class="o">=</span><span class="n">interval</span><span class="p">,</span>
            <span class="n">filtertype</span><span class="o">=</span><span class="n">filtertype</span><span class="p">,</span>
            <span class="n">filterfreq</span><span class="o">=</span><span class="n">filterfreq</span><span class="p">,</span>
            <span class="n">configfile</span><span class="o">=</span><span class="n">configfile</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filtertype_wb</span> <span class="o">=</span> <span class="n">filtertype_wb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filterfreq_wb</span> <span class="o">=</span> <span class="n">filterfreq_wb</span>

        <span class="c1"># base params already read from configfile during superclass init</span>
        <span class="c1"># reopen and extract wideband filter params if any</span>
        <span class="k">if</span> <span class="n">configfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">configfile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">configfile</span><span class="p">)</span>
            <span class="n">cr</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rsam&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filtertype_wb</span> <span class="o">=</span> <span class="n">cr</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filtertype_wb&#39;</span><span class="p">,</span> <span class="n">filtertype_wb</span><span class="p">)</span>
                <span class="n">freq</span> <span class="o">=</span> <span class="n">cr</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filterfreq_wb&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">freq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">filterfreq_wb</span> <span class="o">=</span> <span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">],</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;high&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param trace: The seismic waveform data</span>
<span class="sd">        :type trace: :class:`obspy.Trace`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Trace is empty.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">starttime</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span>
        <span class="n">endtime</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">endtime</span>

        <span class="c1"># handle gaps (i.e. NaNs)</span>
        <span class="n">mdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">mdata</span>

        <span class="n">st_rsam</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">st_wb</span> <span class="o">=</span> <span class="n">st_rsam</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">apply_freq_filter</span><span class="p">(</span><span class="n">st_rsam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filtertype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filterfreq</span><span class="p">)</span>
        <span class="n">st_rsam</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">st_rsam</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">starttime</span><span class="p">,</span> <span class="n">endtime</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">tr_rsam</span> <span class="o">=</span> <span class="n">st_rsam</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Get trace in wide bandwidth</span>
        <span class="n">apply_freq_filter</span><span class="p">(</span><span class="n">st_wb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filtertype_wb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filterfreq_wb</span><span class="p">)</span>
        <span class="n">st_wb</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">st_wb</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">starttime</span><span class="p">,</span> <span class="n">endtime</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">tr_wb</span> <span class="o">=</span> <span class="n">st_wb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># initialise dataframe</span>
        <span class="n">feature_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">feature_idx</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># loop through data in interval blocks</span>
        <span class="k">for</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span> <span class="ow">in</span> <span class="n">trace_window_times</span><span class="p">(</span>
            <span class="n">tr_rsam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">,</span> <span class="n">min_len</span><span class="o">=</span><span class="mf">0.8</span>
        <span class="p">):</span>
            <span class="n">energy_ratio</span> <span class="o">=</span> <span class="n">rsam_wideband_energy_ratio</span><span class="p">(</span>
                <span class="n">tr_rsam</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">nearest_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                <span class="n">tr_wb</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">nearest_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
            <span class="p">)</span>
            <span class="n">feature_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">energy_ratio</span><span class="p">)</span>
            <span class="n">feature_idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t0</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S&#39;</span><span class="p">))</span>

        <span class="n">xdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">feature_data</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">feature_idx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;datetime&quot;</span><span class="p">),</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;rsam_energy_prop&#39;</span><span class="p">],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">()</span>

        <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;starttime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;endtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">endtime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">station</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">feature</span> <span class="o">=</span> <span class="n">xdf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="o">=</span> <span class="n">tr</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="zizou.rsam.EnergyExplainedByRSAM.compute" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>trace</code></b>
                  (<code>:class:`obspy.Trace`</code>)
              –
              <div class="doc-md-description">
                <p>The seismic waveform data</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>src/zizou/rsam.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param trace: The seismic waveform data</span>
<span class="sd">    :type trace: :class:`obspy.Trace`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Trace is empty.&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">tr</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">starttime</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span>
    <span class="n">endtime</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">endtime</span>

    <span class="c1"># handle gaps (i.e. NaNs)</span>
    <span class="n">mdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">tr</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">mdata</span>

    <span class="n">st_rsam</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">st_wb</span> <span class="o">=</span> <span class="n">st_rsam</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">apply_freq_filter</span><span class="p">(</span><span class="n">st_rsam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filtertype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filterfreq</span><span class="p">)</span>
    <span class="n">st_rsam</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">st_rsam</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">starttime</span><span class="p">,</span> <span class="n">endtime</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">tr_rsam</span> <span class="o">=</span> <span class="n">st_rsam</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Get trace in wide bandwidth</span>
    <span class="n">apply_freq_filter</span><span class="p">(</span><span class="n">st_wb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filtertype_wb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filterfreq_wb</span><span class="p">)</span>
    <span class="n">st_wb</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">st_wb</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">starttime</span><span class="p">,</span> <span class="n">endtime</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">tr_wb</span> <span class="o">=</span> <span class="n">st_wb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># initialise dataframe</span>
    <span class="n">feature_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">feature_idx</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># loop through data in interval blocks</span>
    <span class="k">for</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span> <span class="ow">in</span> <span class="n">trace_window_times</span><span class="p">(</span>
        <span class="n">tr_rsam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">,</span> <span class="n">min_len</span><span class="o">=</span><span class="mf">0.8</span>
    <span class="p">):</span>
        <span class="n">energy_ratio</span> <span class="o">=</span> <span class="n">rsam_wideband_energy_ratio</span><span class="p">(</span>
            <span class="n">tr_rsam</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">nearest_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
            <span class="n">tr_wb</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">nearest_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
        <span class="p">)</span>
        <span class="n">feature_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">energy_ratio</span><span class="p">)</span>
        <span class="n">feature_idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t0</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S&#39;</span><span class="p">))</span>

    <span class="n">xdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">feature_data</span><span class="p">,</span>
        <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">feature_idx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;datetime&quot;</span><span class="p">),</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;rsam_energy_prop&#39;</span><span class="p">],</span>
        <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">()</span>

    <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;starttime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
    <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;endtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">endtime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
    <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">station</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">feature</span> <span class="o">=</span> <span class="n">xdf</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="o">=</span> <span class="n">tr</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="zizou.rsam.RSAM" class="doc doc-heading">
            <code>RSAM</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="zizou.FeatureBaseClass">FeatureBaseClass</span></code></p>


      <p>RSAM is the mean of the absolute value of a signal filtered
between 2 and 5 Hz.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>interval</code></b>
                  (<code>int, optional</code>, default:
                      <code>600.0</code>
)
              –
              <div class="doc-md-description">
                <p>Length of the time interval in seconds over which to compute RSAM.</p>
              </div>
            </li>
            <li>
              <b><code>filtertype</code></b>
                  (<code>str, optional</code>, default:
                      <code>&#39;bandpass&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>The type of filtering that is applied before computing RSAM. Can be either band-pass ('bp'), high-pass ('hp'), or low-pass ('lp').</p>
              </div>
            </li>
            <li>
              <b><code>filterfreq</code></b>
                  (<code>tuple, optional</code>, default:
                      <code>(2, 5)</code>
)
              –
              <div class="doc-md-description">
                <p>The low and high cutoff frequency. If filtertype is  highpass or lowpass, only the first or last value is used, respectively.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
              <details class="quote">
                <summary>Source code in <code>src/zizou/rsam.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">RSAM</span><span class="p">(</span><span class="n">FeatureBaseClass</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    RSAM is the mean of the absolute value of a signal filtered</span>
<span class="sd">    between 2 and 5 Hz.</span>

<span class="sd">    :param interval: Length of the time interval in seconds over</span>
<span class="sd">                     which to compute RSAM.</span>
<span class="sd">    :type interval: int, optional</span>
<span class="sd">    :param filtertype: The type of filtering that is applied before</span>
<span class="sd">                       computing RSAM. Can be either band-pass (&#39;bp&#39;),</span>
<span class="sd">                       high-pass (&#39;hp&#39;), or low-pass (&#39;lp&#39;).</span>
<span class="sd">    :type filtertype: str, optional</span>
<span class="sd">    :param filterfreq: The low and high cutoff frequency. If filtertype is </span>
<span class="sd">                       highpass or lowpass, only the first or last value is</span>
<span class="sd">                       used, respectively.</span>

<span class="sd">    :type filterfreq: tuple, optional</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;rsam&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mf">600.</span><span class="p">,</span> <span class="n">filtertype</span><span class="o">=</span><span class="s1">&#39;bandpass&#39;</span><span class="p">,</span>
                 <span class="n">filterfreq</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">configfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">reindex</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RSAM</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="n">interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filtertype</span> <span class="o">=</span> <span class="n">filtertype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filterfreq</span> <span class="o">=</span> <span class="n">filterfreq</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reindex</span> <span class="o">=</span> <span class="n">reindex</span>

        <span class="k">if</span> <span class="n">configfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">configfile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">configfile</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;interval&#39;</span><span class="p">,</span> <span class="n">interval</span><span class="p">)</span>
            <span class="n">cr</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rsam&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filtertype</span> <span class="o">=</span> <span class="n">cr</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filtertype&#39;</span><span class="p">,</span> <span class="n">filtertype</span><span class="p">)</span>
                <span class="n">freq</span> <span class="o">=</span> <span class="n">cr</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filterfreq&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">freq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">filterfreq</span> <span class="o">=</span> <span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">],</span> <span class="n">freq</span><span class="p">[</span><span class="s1">&#39;high&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reindex</span> <span class="o">=</span> <span class="n">cr</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reindex&#39;</span><span class="p">,</span> <span class="n">reindex</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param trace: The seismic waveform data</span>
<span class="sd">        :type trace: :class:`obspy.Trace`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Trace is empty.&quot;</span><span class="p">)</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">starttime</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span>
        <span class="n">endtime</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">endtime</span>

        <span class="c1"># handle gaps (i.e. NaNs)</span>
        <span class="n">mdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">mdata</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

        <span class="n">apply_freq_filter</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filtertype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filterfreq</span><span class="p">)</span>
        <span class="n">st</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">st</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">starttime</span><span class="p">,</span> <span class="n">endtime</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="n">st</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># initialise dataframe</span>
        <span class="n">feature_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">feature_idx</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># loop through data in interval blocks</span>
        <span class="k">for</span> <span class="n">trint</span> <span class="ow">in</span> <span class="n">trace_window_data</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">,</span> <span class="n">min_len</span><span class="o">=</span><span class="mf">0.8</span><span class="p">):</span>
            <span class="n">absolute</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">trint</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># absolute value</span>
            <span class="n">trint</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">absolute</span>  <span class="c1"># assign back to trace</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="n">trint</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="c1"># convert to nanometres so dealing with whole numbers</span>
            <span class="n">feature_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean</span> <span class="o">/</span> <span class="mf">1e-9</span><span class="p">)</span>
            <span class="n">feature_idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">trint</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S&#39;</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">xda</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">feature_data</span><span class="p">,</span>
                           <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">feature_idx</span><span class="p">)],</span>
                           <span class="n">dims</span><span class="o">=</span><span class="s1">&#39;datetime&#39;</span><span class="p">)</span>
        <span class="n">xdf</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">({</span><span class="s1">&#39;rsam&#39;</span><span class="p">:</span> <span class="n">xda</span><span class="p">})</span>
        <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;starttime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;endtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">endtime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">station</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reindex</span><span class="p">:</span>
            <span class="n">starttime</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">xda</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">starttime</span> <span class="o">=</span> <span class="n">round_time</span><span class="p">(</span><span class="n">starttime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">)</span>
            <span class="n">endtime</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">xda</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">endtime</span> <span class="o">=</span> <span class="n">round_time</span><span class="p">(</span><span class="n">endtime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">)</span>
            <span class="n">new_index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">starttime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">endtime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
                                      <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">S&quot;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">))</span>
            <span class="n">xdf</span> <span class="o">=</span> <span class="n">xdf</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">datetime</span><span class="o">=</span><span class="n">new_index</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature</span> <span class="o">=</span> <span class="n">xdf</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="zizou.rsam.RSAM.compute" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>trace</code></b>
                  (<code>:class:`obspy.Trace`</code>)
              –
              <div class="doc-md-description">
                <p>The seismic waveform data</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>src/zizou/rsam.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param trace: The seismic waveform data</span>
<span class="sd">    :type trace: :class:`obspy.Trace`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Trace is empty.&quot;</span><span class="p">)</span>
    <span class="n">tr</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">starttime</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span>
    <span class="n">endtime</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">endtime</span>

    <span class="c1"># handle gaps (i.e. NaNs)</span>
    <span class="n">mdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">tr</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">mdata</span>
    <span class="n">st</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

    <span class="n">apply_freq_filter</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filtertype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filterfreq</span><span class="p">)</span>
    <span class="n">st</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">st</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">starttime</span><span class="p">,</span> <span class="n">endtime</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">tr</span> <span class="o">=</span> <span class="n">st</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># initialise dataframe</span>
    <span class="n">feature_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">feature_idx</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># loop through data in interval blocks</span>
    <span class="k">for</span> <span class="n">trint</span> <span class="ow">in</span> <span class="n">trace_window_data</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">,</span> <span class="n">min_len</span><span class="o">=</span><span class="mf">0.8</span><span class="p">):</span>
        <span class="n">absolute</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">trint</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># absolute value</span>
        <span class="n">trint</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">absolute</span>  <span class="c1"># assign back to trace</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">trint</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="c1"># convert to nanometres so dealing with whole numbers</span>
        <span class="n">feature_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean</span> <span class="o">/</span> <span class="mf">1e-9</span><span class="p">)</span>
        <span class="n">feature_idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">trint</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S&#39;</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="n">xda</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">feature_data</span><span class="p">,</span>
                       <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">feature_idx</span><span class="p">)],</span>
                       <span class="n">dims</span><span class="o">=</span><span class="s1">&#39;datetime&#39;</span><span class="p">)</span>
    <span class="n">xdf</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">({</span><span class="s1">&#39;rsam&#39;</span><span class="p">:</span> <span class="n">xda</span><span class="p">})</span>
    <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;starttime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
    <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;endtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">endtime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
    <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">station</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reindex</span><span class="p">:</span>
        <span class="n">starttime</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">xda</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">starttime</span> <span class="o">=</span> <span class="n">round_time</span><span class="p">(</span><span class="n">starttime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">)</span>
        <span class="n">endtime</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">xda</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">endtime</span> <span class="o">=</span> <span class="n">round_time</span><span class="p">(</span><span class="n">endtime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">)</span>
        <span class="n">new_index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">starttime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">endtime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
                                  <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">S&quot;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">))</span>
        <span class="n">xdf</span> <span class="o">=</span> <span class="n">xdf</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">datetime</span><span class="o">=</span><span class="n">new_index</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">feature</span> <span class="o">=</span> <span class="n">xdf</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="zizou.ssam"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="zizou.ssam.SSAM" class="doc doc-heading">
            <code>SSAM</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="zizou.FeatureBaseClass">FeatureBaseClass</span></code></p>


      <p>SSAM is basically the same as computing a spectrogram. Data are split into
interval length segments and the spectrum of each section is
computed. Before computing the spectrum, the mean is removed and
a hanning window is applied to each segment. The percentage of
overlap of each segment can be specified with per_lap and Welch-type
smoothing can be applied.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>interval</code></b>
                  (<code>int</code>, default:
                      <code>10</code>
)
              –
              <div class="doc-md-description">
                <p>Segment length in seconds.</p>
              </div>
            </li>
            <li>
              <b><code>per_lap</code></b>
                  (<code>float | int</code>, default:
                      <code>0</code>
)
              –
              <div class="doc-md-description">
                <p>If the value is less than 1 it is treated as the percentage of segment overlap; else it is the step size in sample points</p>
              </div>
            </li>
            <li>
              <b><code>scale_by_freq</code></b>
                  (<code>boolean</code>, default:
                      <code>True</code>
)
              –
              <div class="doc-md-description">
                <p>Divide by the sampling frequency so that density function has units of dB/Hz and can be integrated by the frequency values.</p>
              </div>
            </li>
            <li>
              <b><code>smooth</code></b>
                  (<code>int</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The number of windows over which to average the spectrogram.</p>
              </div>
            </li>
            <li>
              <b><code>frequencies</code></b>
                  (<code>:class:`numpy.ndarray`</code>, default:
                      <code><span title="numpy.linspace">linspace</span>(0, 25, 251)</code>
)
              –
              <div class="doc-md-description">
                <p>Frequencies at which to return the spectrogram. This uses linear interpolation to compute the spectrogram at the given frequencies from the original spectrogram.</p>
              </div>
            </li>
            <li>
              <b><code>timestamp</code></b>
                  (<code>str</code>, default:
                      <code>&#39;center&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>Can be either 'center' or 'start'. If 'center', the timestamp of each spectrum is the center of the windows from which the spectrum was computed. If 'start' it is the timestamp of the first sample of the first window.</p>
              </div>
            </li>
            <li>
              <b><code>resample_int</code></b>
                  (<code>(str, str)</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Interval to upsample the dataset using linear interpolation over the first interval and then downsample using the mean over the second interval.</p>
              </div>
            </li>
            <li>
              <b><code>configfile</code></b>
                  (<code>str | dict  &gt;&gt;&gt; from zizou.ssam import SSAM, test_signal &gt;&gt;&gt; import numpy as np &gt;&gt;&gt; tr = test_signal(gaps=True) &gt;&gt;&gt; s = SSAM(interval=60, per_lap=.9, smooth=10, frequencies=np.arange(0, 25.1, .1))</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Configuration as an .ini file or a dictionary.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
              <details class="quote">
                <summary>Source code in <code>src/zizou/ssam.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SSAM</span><span class="p">(</span><span class="n">FeatureBaseClass</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    SSAM is basically the same as computing a spectrogram. Data are split into</span>
<span class="sd">    interval length segments and the spectrum of each section is</span>
<span class="sd">    computed. Before computing the spectrum, the mean is removed and</span>
<span class="sd">    a hanning window is applied to each segment. The percentage of</span>
<span class="sd">    overlap of each segment can be specified with per_lap and Welch-type</span>
<span class="sd">    smoothing can be applied.</span>

<span class="sd">    :param interval: Segment length in seconds.</span>
<span class="sd">    :type interval: int</span>
<span class="sd">    :param per_lap: If the value is less than 1 it is treated as the percentage</span>
<span class="sd">                    of segment overlap; else it is the step size in sample points</span>
<span class="sd">    :type per_lap: float or int</span>
<span class="sd">    :param scale_by_freq: Divide by the sampling frequency so that density</span>
<span class="sd">                          function has units of dB/Hz and can be integrated</span>
<span class="sd">                          by the frequency values.</span>
<span class="sd">    :type scale_by_freq: boolean</span>
<span class="sd">    :param smooth: The number of windows over which to</span>
<span class="sd">                   average the spectrogram.</span>
<span class="sd">    :type smooth: int</span>
<span class="sd">    :param frequencies: Frequencies at which to return the spectrogram. This</span>
<span class="sd">                        uses linear interpolation to compute the spectrogram</span>
<span class="sd">                        at the given frequencies from the original spectrogram.</span>
<span class="sd">    :type frequencies: :class:`numpy.ndarray`</span>
<span class="sd">    :param timestamp: Can be either &#39;center&#39; or &#39;start&#39;. If &#39;center&#39;, the</span>
<span class="sd">                      timestamp of each spectrum is the center of the windows</span>
<span class="sd">                      from which the spectrum was computed. If &#39;start&#39; it is</span>
<span class="sd">                      the timestamp of the first sample of the first window.</span>
<span class="sd">    :type timestamp: str</span>
<span class="sd">    :param resample_int: Interval to upsample the dataset using linear</span>
<span class="sd">                         interpolation over the first interval and then</span>
<span class="sd">                         downsample using the mean over the second interval.</span>
<span class="sd">    :type resample_int: (str, str)</span>
<span class="sd">    :param configfile: Configuration as an .ini file or a dictionary.</span>
<span class="sd">    :type configfile: str or dict</span>

<span class="sd">    &gt;&gt;&gt; from zizou.ssam import SSAM, test_signal</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; tr = test_signal(gaps=True)</span>
<span class="sd">    &gt;&gt;&gt; s = SSAM(interval=60, per_lap=.9, smooth=10,</span>
<span class="sd">                 frequencies=np.arange(0, 25.1, .1))</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ssam&#39;</span><span class="p">,</span> <span class="s1">&#39;filterbank&#39;</span><span class="p">,</span> <span class="s1">&#39;sonogram&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">per_lap</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale_by_freq</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">smooth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">frequencies</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">251</span><span class="p">),</span>
                 <span class="n">fbfilters</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">nhob</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">timestamp</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                 <span class="n">resample_int</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">configfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SSAM</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="n">interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">per_lap</span> <span class="o">=</span> <span class="n">per_lap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_by_freq</span> <span class="o">=</span> <span class="n">scale_by_freq</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smooth</span> <span class="o">=</span> <span class="n">smooth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span> <span class="o">=</span> <span class="n">frequencies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="n">timestamp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resample_int</span> <span class="o">=</span> <span class="n">resample_int</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fbfilters</span> <span class="o">=</span> <span class="n">fbfilters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nhob</span> <span class="o">=</span> <span class="n">nhob</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">feature</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">configfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">configfile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">configfile</span><span class="p">)</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ssam&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;interval&#39;</span><span class="p">,</span> <span class="n">interval</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">per_lap</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;per_lap&#39;</span><span class="p">,</span><span class="n">per_lap</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scale_by_freq</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;scale_by_freq&#39;</span><span class="p">,</span> <span class="n">scale_by_freq</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">smooth</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;smooth&#39;</span><span class="p">,</span> <span class="n">smooth</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nhob</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nhob&#39;</span><span class="p">,</span> <span class="n">nhob</span><span class="p">)</span>
                <span class="n">freqs</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;frequencies&#39;</span><span class="p">,</span> <span class="n">frequencies</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">freqs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">freqs</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">],</span>
                                                 <span class="n">freqs</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">],</span>
                                                 <span class="n">freqs</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">])</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">fbfilters</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fbfilters&#39;</span><span class="p">,</span> <span class="n">fbfilters</span><span class="p">)</span>
                <span class="n">ri</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;resample_int&#39;</span><span class="p">,</span> <span class="n">resample_int</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ri</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">resample_int</span> <span class="o">=</span> <span class="p">(</span><span class="n">ri</span><span class="p">[</span><span class="s1">&#39;upsample&#39;</span><span class="p">],</span> <span class="n">ri</span><span class="p">[</span><span class="s1">&#39;downsample&#39;</span><span class="p">])</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_nearest_pow_2</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find power of two nearest to x</span>

<span class="sd">        &gt;&gt;&gt; _nearest_pow_2(3)</span>
<span class="sd">        2.0</span>
<span class="sd">        &gt;&gt;&gt; _nearest_pow_2(15)</span>
<span class="sd">        16.0</span>

<span class="sd">        :param x: Number</span>
<span class="sd">        :type x: float</span>
<span class="sd">        :return: Nearest power of 2 to x</span>
<span class="sd">        :rtype: Int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">M</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">M</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">a</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">b</span>

    <span class="k">def</span> <span class="nf">_average</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Average spectrogram over nwin windows to produce a smoother</span>
<span class="sd">        spectrogram. If used with overlapping windows it is known</span>
<span class="sd">        as the Welch algorithm</span>

<span class="sd">        :param spec: Input spectrogram</span>
<span class="sd">        :type spec: :class:`numpy.ndarray`</span>
<span class="sd">        :param t: Time axis of spectrogram.</span>
<span class="sd">        :type t: :class:`numpy.ndarray`</span>
<span class="sd">        :param nwin: Number of windows over which to average</span>
<span class="sd">        :type nwin: int</span>
<span class="sd">        :return: smoothed_spec, new-time</span>
<span class="sd">        :rtype: tuple of :class:`~numpy.ndarray`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">end</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ntimes</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">av_mat</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nt</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">end</span> <span class="o">&lt;</span> <span class="n">ntimes</span><span class="p">:</span>
            <span class="n">av_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth</span>
            <span class="k">if</span> <span class="n">end</span> <span class="o">&gt;</span> <span class="n">ntimes</span><span class="p">:</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">ntimes</span>
            <span class="n">av_arr</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="n">av_mat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">av_arr</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">==</span> <span class="s1">&#39;center&#39;</span><span class="p">:</span>
                <span class="n">nt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">smooth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">==</span> <span class="s1">&#39;start&#39;</span><span class="p">:</span>
                <span class="n">nt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">start</span><span class="p">])</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">end</span>

        <span class="n">av_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">av_mat</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">nt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
        <span class="c1"># find all columns with NaNs</span>
        <span class="n">colidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">spec</span><span class="p">))[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># set corresponding rows in averaging matrix to NaN</span>
        <span class="n">av_mat</span><span class="p">[</span><span class="n">colidx</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">av_mat</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">av_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">av_mat</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">av_mat</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">mspec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="n">mav_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">av_mat</span><span class="p">)</span>
        <span class="n">nspec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mspec</span><span class="p">,</span> <span class="n">mav_mat</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nspec</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">nt</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_resample</span><span class="p">(</span><span class="n">xdf</span><span class="p">,</span> <span class="n">resample_int</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;1min&#39;</span><span class="p">,</span> <span class="s1">&#39;10min&#39;</span><span class="p">)):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resample spectrograms to the desired sampling interval using xarray</span>
<span class="sd">        functionality.</span>

<span class="sd">        :param xdf: An xarray dataset as returned by :class:`zizou.ssam.SSAM`</span>
<span class="sd">        :type xdf: :class:`xarray.Dataset`</span>
<span class="sd">        :param resample_int: Intervals to upsample the dataset using linear</span>
<span class="sd">                             interpolation over the first interval and then</span>
<span class="sd">                             downsample using the mean over the second</span>
<span class="sd">                             interval.</span>
<span class="sd">        :type resample_int: (str, str)</span>
<span class="sd">        :return: Stacked dataset.</span>
<span class="sd">        :rtype: :class:`~xarray.Dataset`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">upsample_int</span><span class="p">,</span> <span class="n">downsample_int</span> <span class="o">=</span> <span class="n">resample_int</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span>
        <span class="k">if</span> <span class="n">upsample_int</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xdf</span> <span class="o">=</span> <span class="n">xdf</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">datetime</span><span class="o">=</span><span class="n">upsample_int</span><span class="p">)</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">downsample_int</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xdf</span> <span class="o">=</span> <span class="n">xdf</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">datetime</span><span class="o">=</span><span class="n">downsample_int</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="c1"># Resample transposes the dimensions so we need to revert this</span>
        <span class="n">xdf</span><span class="p">[</span><span class="s1">&#39;ssam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xdf</span><span class="o">.</span><span class="n">ssam</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">,</span> <span class="s1">&#39;datetime&#39;</span><span class="p">)</span>
        <span class="n">xdf</span><span class="p">[</span><span class="s1">&#39;filterbank&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xdf</span><span class="o">.</span><span class="n">filterbank</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="s1">&#39;fbfrequency&#39;</span><span class="p">,</span> <span class="s1">&#39;datetime&#39;</span><span class="p">)</span>
        <span class="n">xdf</span><span class="p">[</span><span class="s1">&#39;sonogram&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xdf</span><span class="o">.</span><span class="n">sonogram</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="s1">&#39;sonofrequency&#39;</span><span class="p">,</span> <span class="s1">&#39;datetime&#39;</span><span class="p">)</span>
        <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">attrs</span>
        <span class="k">return</span> <span class="n">xdf</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">filterbank</span><span class="p">(</span><span class="n">nfilters</span><span class="p">,</span> <span class="n">nfft</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the integral in an array of bandpass filters that</span>
<span class="sd">        separates the input signal into multiple components.</span>
<span class="sd">        Each component consists of a single frequency sub-band</span>
<span class="sd">        of the original signal.</span>

<span class="sd">        :param nfilters: Number of filters in the filter bank.</span>
<span class="sd">        :type nfitlers: int</span>
<span class="sd">        :param nfft: Number of samples</span>
<span class="sd">        :type nfft: int</span>
<span class="sd">        :param fs: Sampling frquency</span>
<span class="sd">        :type fs: float</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">nfft</span><span class="p">)</span>
        <span class="n">fh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">fs</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">fl</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">fh</span><span class="p">),</span> <span class="n">nfilters</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="p">)</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">nfft</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">freqs</span> <span class="o">/</span> <span class="n">fs</span><span class="p">)</span>
        <span class="n">fbank</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nfilters</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">nfft</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))))</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nfilters</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">f_m_minus</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>   <span class="c1"># left</span>
            <span class="n">f_m</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="n">m</span><span class="p">])</span>             <span class="c1"># center</span>
            <span class="n">f_m_plus</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>    <span class="c1"># right</span>

            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">f_m_minus</span><span class="p">,</span> <span class="n">f_m</span><span class="p">):</span>
                <span class="n">fbank</span><span class="p">[</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="n">bins</span><span class="p">[</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">-</span> <span class="n">bins</span><span class="p">[</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">f_m</span><span class="p">,</span> <span class="n">f_m_plus</span><span class="p">):</span>
                <span class="n">fbank</span><span class="p">[</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bins</span><span class="p">[</span><span class="n">m</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">freqs</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">fbank</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">sonogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">fc1</span><span class="p">,</span> <span class="n">nofb</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the sonogram of the given data which can be windowed or not.</span>
<span class="sd">        The sonogram is determined by the power in half octave bands of the given</span>
<span class="sd">        data.</span>

<span class="sd">        If data are windowed the analytic signal and the envelope of each window</span>
<span class="sd">        is returned.</span>

<span class="sd">        :param data: Data to make envelope of.</span>
<span class="sd">        :type data: :class:`~numpy.ndarray`</span>
<span class="sd">        :param fs: Sampling frequency in Hz.</span>
<span class="sd">        :param fc1: Center frequency of lowest half octave band.</span>
<span class="sd">        :param nofb: Number of half octave bands.</span>
<span class="sd">        :param no_win: Number of data windows.</span>
<span class="sd">        :return: Central frequencies, Half octave bands.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">fc1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.5</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nofb</span><span class="p">)</span>
        <span class="n">fmin</span> <span class="o">=</span> <span class="n">fc</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">5.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">)</span>
        <span class="n">fmax</span> <span class="o">=</span> <span class="n">fc</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">5.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">)</span>
        <span class="n">z_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">nfft</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">fmin</span> <span class="o">*</span> <span class="n">nfft</span> <span class="o">/</span> <span class="n">fs</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int_</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">fmax</span> <span class="o">*</span> <span class="n">nfft</span> <span class="o">/</span> <span class="n">fs</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int_</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nofb</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nofb</span><span class="p">):</span>
            <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">end</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">:])</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">hob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">z_tot</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:])</span>
        <span class="k">return</span> <span class="n">fc</span><span class="p">,</span> <span class="n">hob</span>

    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute SSAM for the given trace.</span>

<span class="sd">        :param trace: The seismic waveform data.</span>
<span class="sd">        :type trace: :class:`obspy.Trace`</span>
<span class="sd">        :return: spectrogram, frequencies, times</span>
<span class="sd">        :rtype: tuple</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Trace is empty.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">data</span>
        <span class="n">npts</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">npts</span>
        <span class="n">Fs</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">sampling_rate</span>
        <span class="n">interval</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="o">*</span><span class="n">Fs</span><span class="p">,</span> <span class="n">npts</span><span class="p">)</span>

        <span class="n">NFFT</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nearest_pow_2</span><span class="p">(</span><span class="n">interval</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">NFFT</span> <span class="o">&gt;</span> <span class="n">npts</span><span class="p">:</span>
            <span class="n">NFFT</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nearest_pow_2</span><span class="p">(</span><span class="n">npts</span> <span class="o">/</span> <span class="mf">8.0</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_lap</span> <span class="o">&lt;</span> <span class="mf">1.</span><span class="p">:</span>
            <span class="n">noverlap</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">NFFT</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">per_lap</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">noverlap</span> <span class="o">=</span> <span class="n">NFFT</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_lap</span>

        <span class="n">scaling_factor</span> <span class="o">=</span> <span class="mf">2.</span>
        <span class="n">result</span><span class="p">,</span> <span class="n">windowVals</span> <span class="o">=</span> <span class="n">window_array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">NFFT</span><span class="p">,</span> <span class="n">noverlap</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">NFFT</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfftfreq</span><span class="p">(</span><span class="n">NFFT</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">Fs</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">*</span> <span class="n">result</span>
        <span class="c1"># Also include scaling factors for one-sided densities and dividing by</span>
        <span class="c1"># the sampling frequency, if desired. Scale everything, except the DC</span>
        <span class="c1"># component and the NFFT/2 component:</span>
        <span class="n">slc</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">result</span><span class="p">[</span><span class="n">slc</span><span class="p">]</span> <span class="o">*=</span> <span class="n">scaling_factor</span>

        <span class="c1"># MATLAB divides by the sampling frequency so that density function</span>
        <span class="c1"># has units of dB/Hz and can be integrated by the plotted frequency</span>
        <span class="c1"># values. Perform the same scaling here.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_by_freq</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">/=</span> <span class="n">Fs</span>
            <span class="c1"># Scale the spectrum by the norm of the window to compensate for</span>
            <span class="c1"># windowing loss; see Bendat &amp; Piersol Sec 11.5.2.</span>
            <span class="n">result</span> <span class="o">/=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">windowVals</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># In this case, preserve power in the segment, not amplitude</span>
            <span class="n">result</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">windowVals</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">**</span><span class="mi">2</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">real</span>
        <span class="n">steplength</span> <span class="o">=</span> <span class="n">NFFT</span> <span class="o">-</span> <span class="n">noverlap</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">steplength</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">==</span> <span class="s1">&#39;center&#39;</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">steps</span> <span class="o">+</span> <span class="n">NFFT</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">Fs</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">==</span> <span class="s1">&#39;start&#39;</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">steps</span> <span class="o">/</span> <span class="n">Fs</span>
        <span class="c1"># smooth the spectrogram using the Welch algorithm</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_average</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

        <span class="n">features</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="p">[(</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span> <span class="o">+</span> <span class="n">_t</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">t</span><span class="p">]</span>

        <span class="n">fb_freqs</span><span class="p">,</span> <span class="n">fb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filterbank</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fbfilters</span><span class="p">,</span> <span class="n">NFFT</span><span class="p">,</span> <span class="n">Fs</span><span class="p">)</span>
        <span class="n">result_fb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">fb</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="n">filterbank</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">result_fb</span><span class="p">,</span>
                                  <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">fb_freqs</span><span class="p">,</span>
                                          <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">dates</span><span class="p">)],</span>
                                  <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;fbfrequency&#39;</span><span class="p">,</span> <span class="s1">&#39;datetime&#39;</span><span class="p">])</span>
        <span class="n">features</span><span class="p">[</span><span class="s1">&#39;filterbank&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filterbank</span>

        <span class="n">sono_freq</span><span class="p">,</span> <span class="n">sono_amp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sonogram</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">Fs</span><span class="p">,</span> <span class="mf">0.68</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nhob</span><span class="p">)</span>
        <span class="n">sono</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">sono_amp</span><span class="p">,</span>
                            <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">sono_freq</span><span class="p">,</span>
                                    <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">dates</span><span class="p">)],</span>
                            <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sonofrequency&#39;</span><span class="p">,</span> <span class="s1">&#39;datetime&#39;</span><span class="p">])</span>
        <span class="n">features</span><span class="p">[</span><span class="s1">&#39;sonogram&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sono</span>

        <span class="c1"># Linear interpolation onto a new set of frequencies</span>
        <span class="k">def</span> <span class="nf">myinterp</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="n">myinterp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="n">freqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span>

        <span class="n">ssam</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span>
            <span class="n">result</span><span class="p">,</span>
            <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">freqs</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">dates</span><span class="p">)],</span>
            <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;frequency&#39;</span><span class="p">,</span> <span class="s1">&#39;datetime&#39;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">features</span><span class="p">[</span><span class="s1">&#39;ssam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ssam</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;starttime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;endtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">endtime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">station</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resample_int</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resample_int</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="zizou.ssam.SSAM.compute" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Compute SSAM for the given trace.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>trace</code></b>
                  (<code>:class:`obspy.Trace`</code>)
              –
              <div class="doc-md-description">
                <p>The seismic waveform data.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>tuple</code>
              –
              <div class="doc-md-description">
                <p>spectrogram, frequencies, times</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>src/zizou/ssam.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute SSAM for the given trace.</span>

<span class="sd">    :param trace: The seismic waveform data.</span>
<span class="sd">    :type trace: :class:`obspy.Trace`</span>
<span class="sd">    :return: spectrogram, frequencies, times</span>
<span class="sd">    :rtype: tuple</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Trace is empty.&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">tr</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">data</span>
    <span class="n">npts</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">npts</span>
    <span class="n">Fs</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">sampling_rate</span>
    <span class="n">interval</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="o">*</span><span class="n">Fs</span><span class="p">,</span> <span class="n">npts</span><span class="p">)</span>

    <span class="n">NFFT</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nearest_pow_2</span><span class="p">(</span><span class="n">interval</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">NFFT</span> <span class="o">&gt;</span> <span class="n">npts</span><span class="p">:</span>
        <span class="n">NFFT</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nearest_pow_2</span><span class="p">(</span><span class="n">npts</span> <span class="o">/</span> <span class="mf">8.0</span><span class="p">))</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_lap</span> <span class="o">&lt;</span> <span class="mf">1.</span><span class="p">:</span>
        <span class="n">noverlap</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">NFFT</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">per_lap</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">noverlap</span> <span class="o">=</span> <span class="n">NFFT</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_lap</span>

    <span class="n">scaling_factor</span> <span class="o">=</span> <span class="mf">2.</span>
    <span class="n">result</span><span class="p">,</span> <span class="n">windowVals</span> <span class="o">=</span> <span class="n">window_array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">NFFT</span><span class="p">,</span> <span class="n">noverlap</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">NFFT</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfftfreq</span><span class="p">(</span><span class="n">NFFT</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">Fs</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">*</span> <span class="n">result</span>
    <span class="c1"># Also include scaling factors for one-sided densities and dividing by</span>
    <span class="c1"># the sampling frequency, if desired. Scale everything, except the DC</span>
    <span class="c1"># component and the NFFT/2 component:</span>
    <span class="n">slc</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">result</span><span class="p">[</span><span class="n">slc</span><span class="p">]</span> <span class="o">*=</span> <span class="n">scaling_factor</span>

    <span class="c1"># MATLAB divides by the sampling frequency so that density function</span>
    <span class="c1"># has units of dB/Hz and can be integrated by the plotted frequency</span>
    <span class="c1"># values. Perform the same scaling here.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_by_freq</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">/=</span> <span class="n">Fs</span>
        <span class="c1"># Scale the spectrum by the norm of the window to compensate for</span>
        <span class="c1"># windowing loss; see Bendat &amp; Piersol Sec 11.5.2.</span>
        <span class="n">result</span> <span class="o">/=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">windowVals</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># In this case, preserve power in the segment, not amplitude</span>
        <span class="n">result</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">windowVals</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">**</span><span class="mi">2</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">real</span>
    <span class="n">steplength</span> <span class="o">=</span> <span class="n">NFFT</span> <span class="o">-</span> <span class="n">noverlap</span>
    <span class="n">steps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">steplength</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">==</span> <span class="s1">&#39;center&#39;</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">steps</span> <span class="o">+</span> <span class="n">NFFT</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">Fs</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">==</span> <span class="s1">&#39;start&#39;</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">steps</span> <span class="o">/</span> <span class="n">Fs</span>
    <span class="c1"># smooth the spectrogram using the Welch algorithm</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_average</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

    <span class="n">features</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">dates</span> <span class="o">=</span> <span class="p">[(</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span> <span class="o">+</span> <span class="n">_t</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">t</span><span class="p">]</span>

    <span class="n">fb_freqs</span><span class="p">,</span> <span class="n">fb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filterbank</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fbfilters</span><span class="p">,</span> <span class="n">NFFT</span><span class="p">,</span> <span class="n">Fs</span><span class="p">)</span>
    <span class="n">result_fb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">fb</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="n">filterbank</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">result_fb</span><span class="p">,</span>
                              <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">fb_freqs</span><span class="p">,</span>
                                      <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">dates</span><span class="p">)],</span>
                              <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;fbfrequency&#39;</span><span class="p">,</span> <span class="s1">&#39;datetime&#39;</span><span class="p">])</span>
    <span class="n">features</span><span class="p">[</span><span class="s1">&#39;filterbank&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filterbank</span>

    <span class="n">sono_freq</span><span class="p">,</span> <span class="n">sono_amp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sonogram</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">Fs</span><span class="p">,</span> <span class="mf">0.68</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nhob</span><span class="p">)</span>
    <span class="n">sono</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">sono_amp</span><span class="p">,</span>
                        <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">sono_freq</span><span class="p">,</span>
                                <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">dates</span><span class="p">)],</span>
                        <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sonofrequency&#39;</span><span class="p">,</span> <span class="s1">&#39;datetime&#39;</span><span class="p">])</span>
    <span class="n">features</span><span class="p">[</span><span class="s1">&#39;sonogram&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sono</span>

    <span class="c1"># Linear interpolation onto a new set of frequencies</span>
    <span class="k">def</span> <span class="nf">myinterp</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="n">myinterp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="n">freqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span>

    <span class="n">ssam</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span>
        <span class="n">result</span><span class="p">,</span>
        <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">freqs</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">dates</span><span class="p">)],</span>
        <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;frequency&#39;</span><span class="p">,</span> <span class="s1">&#39;datetime&#39;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">features</span><span class="p">[</span><span class="s1">&#39;ssam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ssam</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">feature</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;starttime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;endtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">endtime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">station</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resample_int</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resample_int</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zizou.ssam.SSAM.filterbank" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filterbank</span><span class="p">(</span><span class="n">nfilters</span><span class="p">,</span> <span class="n">nfft</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>Computes the integral in an array of bandpass filters that
separates the input signal into multiple components.
Each component consists of a single frequency sub-band
of the original signal.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>nfilters</code></b>
              –
              <div class="doc-md-description">
                <p>Number of filters in the filter bank.</p>
              </div>
            </li>
            <li>
              <b><code>nfft</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>Number of samples</p>
              </div>
            </li>
            <li>
              <b><code>fs</code></b>
                  (<code>float</code>)
              –
              <div class="doc-md-description">
                <p>Sampling frquency</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>src/zizou/ssam.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">filterbank</span><span class="p">(</span><span class="n">nfilters</span><span class="p">,</span> <span class="n">nfft</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the integral in an array of bandpass filters that</span>
<span class="sd">    separates the input signal into multiple components.</span>
<span class="sd">    Each component consists of a single frequency sub-band</span>
<span class="sd">    of the original signal.</span>

<span class="sd">    :param nfilters: Number of filters in the filter bank.</span>
<span class="sd">    :type nfitlers: int</span>
<span class="sd">    :param nfft: Number of samples</span>
<span class="sd">    :type nfft: int</span>
<span class="sd">    :param fs: Sampling frquency</span>
<span class="sd">    :type fs: float</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">nfft</span><span class="p">)</span>
    <span class="n">fh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">fs</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">fl</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">fh</span><span class="p">),</span> <span class="n">nfilters</span> <span class="o">+</span> <span class="mi">2</span>
    <span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">nfft</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">freqs</span> <span class="o">/</span> <span class="n">fs</span><span class="p">)</span>
    <span class="n">fbank</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nfilters</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">nfft</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))))</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nfilters</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">f_m_minus</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>   <span class="c1"># left</span>
        <span class="n">f_m</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="n">m</span><span class="p">])</span>             <span class="c1"># center</span>
        <span class="n">f_m_plus</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>    <span class="c1"># right</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">f_m_minus</span><span class="p">,</span> <span class="n">f_m</span><span class="p">):</span>
            <span class="n">fbank</span><span class="p">[</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="n">bins</span><span class="p">[</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">-</span> <span class="n">bins</span><span class="p">[</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">f_m</span><span class="p">,</span> <span class="n">f_m_plus</span><span class="p">):</span>
            <span class="n">fbank</span><span class="p">[</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bins</span><span class="p">[</span><span class="n">m</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">freqs</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">fbank</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zizou.ssam.SSAM.sonogram" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sonogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">fc1</span><span class="p">,</span> <span class="n">nofb</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>Computes the sonogram of the given data which can be windowed or not.
The sonogram is determined by the power in half octave bands of the given
data.</p>
<p>If data are windowed the analytic signal and the envelope of each window
is returned.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>data</code></b>
                  (<code>:class:`~numpy.ndarray`</code>)
              –
              <div class="doc-md-description">
                <p>Data to make envelope of.</p>
              </div>
            </li>
            <li>
              <b><code>fs</code></b>
              –
              <div class="doc-md-description">
                <p>Sampling frequency in Hz.</p>
              </div>
            </li>
            <li>
              <b><code>fc1</code></b>
              –
              <div class="doc-md-description">
                <p>Center frequency of lowest half octave band.</p>
              </div>
            </li>
            <li>
              <b><code>nofb</code></b>
              –
              <div class="doc-md-description">
                <p>Number of half octave bands.</p>
              </div>
            </li>
            <li>
              <b><code>no_win</code></b>
              –
              <div class="doc-md-description">
                <p>Number of data windows.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              –
              <div class="doc-md-description">
                <p>Central frequencies, Half octave bands.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>src/zizou/ssam.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">sonogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">fc1</span><span class="p">,</span> <span class="n">nofb</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the sonogram of the given data which can be windowed or not.</span>
<span class="sd">    The sonogram is determined by the power in half octave bands of the given</span>
<span class="sd">    data.</span>

<span class="sd">    If data are windowed the analytic signal and the envelope of each window</span>
<span class="sd">    is returned.</span>

<span class="sd">    :param data: Data to make envelope of.</span>
<span class="sd">    :type data: :class:`~numpy.ndarray`</span>
<span class="sd">    :param fs: Sampling frequency in Hz.</span>
<span class="sd">    :param fc1: Center frequency of lowest half octave band.</span>
<span class="sd">    :param nofb: Number of half octave bands.</span>
<span class="sd">    :param no_win: Number of data windows.</span>
<span class="sd">    :return: Central frequencies, Half octave bands.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">fc1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.5</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nofb</span><span class="p">)</span>
    <span class="n">fmin</span> <span class="o">=</span> <span class="n">fc</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">5.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">)</span>
    <span class="n">fmax</span> <span class="o">=</span> <span class="n">fc</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">5.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">)</span>
    <span class="n">z_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">nfft</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">fmin</span> <span class="o">*</span> <span class="n">nfft</span> <span class="o">/</span> <span class="n">fs</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int_</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">fmax</span> <span class="o">*</span> <span class="n">nfft</span> <span class="o">/</span> <span class="n">fs</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int_</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nofb</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nofb</span><span class="p">):</span>
        <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">end</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">:])</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">hob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">z_tot</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:])</span>
    <span class="k">return</span> <span class="n">fc</span><span class="p">,</span> <span class="n">hob</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="zizou.dsar"></a>
    <div class="doc doc-contents first">

      <p>Compute the displacement seismic amplitude ratio (DSAR).</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="zizou.dsar.DSAR" class="doc doc-heading">
            <code>DSAR</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="zizou.FeatureBaseClass">FeatureBaseClass</span></code></p>


      <p>DSAR is the ratio of
low frequency to high frequency amplitudes, as suggested in:
https://doi.org/10.1130/G46107.1</p>
<p>The time-domain displacement signal is bandpass filtered in two
frequency bands, 4.5 to 8 Hz and 8 to 16 Hz, and DSAR is defined
as the median ratio of the absolute signals. The quantity is
interpreted in the publication as a change in seismic attenuation
in the vicinity of the seismic station.</p>

              <details class="quote">
                <summary>Source code in <code>src/zizou/dsar.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DSAR</span><span class="p">(</span><span class="n">FeatureBaseClass</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    DSAR is the ratio of</span>
<span class="sd">    low frequency to high frequency amplitudes, as suggested in:</span>
<span class="sd">    https://doi.org/10.1130/G46107.1</span>

<span class="sd">    The time-domain displacement signal is bandpass filtered in two</span>
<span class="sd">    frequency bands, 4.5 to 8 Hz and 8 to 16 Hz, and DSAR is defined</span>
<span class="sd">    as the median ratio of the absolute signals. The quantity is</span>
<span class="sd">    interpreted in the publication as a change in seismic attenuation</span>
<span class="sd">    in the vicinity of the seismic station.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dsar&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mf">600.</span><span class="p">,</span> <span class="n">filtertype</span><span class="o">=</span><span class="s1">&#39;bandpass&#39;</span><span class="p">,</span>
                 <span class="n">lowerfreqband</span><span class="o">=</span><span class="p">(</span><span class="mf">4.5</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
                 <span class="n">higherfreqband</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>
                 <span class="n">configfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reindex</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DSAR</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filtertype</span> <span class="o">=</span> <span class="n">filtertype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lowerfreqband</span> <span class="o">=</span> <span class="n">lowerfreqband</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">higherfreqband</span> <span class="o">=</span> <span class="n">higherfreqband</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reindex</span> <span class="o">=</span> <span class="n">reindex</span>

        <span class="k">if</span> <span class="n">configfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">configfile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">configfile</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;interval&#39;</span><span class="p">,</span> <span class="n">interval</span><span class="p">)</span>
            <span class="n">cd</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dsar&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reindex</span> <span class="o">=</span> <span class="n">cd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reindex&#39;</span><span class="p">,</span> <span class="n">reindex</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filtertype</span> <span class="o">=</span> <span class="n">cd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filtertype&#39;</span><span class="p">,</span> <span class="n">filtertype</span><span class="p">)</span> 
                <span class="n">lfreq</span> <span class="o">=</span> <span class="n">cd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lowerfreqband&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">lfreq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lowerfreqband</span> <span class="o">=</span> <span class="p">(</span><span class="n">lfreq</span><span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">],</span> <span class="n">lfreq</span><span class="p">[</span><span class="s1">&#39;high&#39;</span><span class="p">])</span> 
                <span class="n">hfreq</span> <span class="o">=</span> <span class="n">cd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;higherfreqband&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">hfreq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">higherfreqband</span> <span class="o">=</span> <span class="p">(</span><span class="n">hfreq</span><span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">],</span> <span class="n">hfreq</span><span class="p">[</span><span class="s1">&#39;high&#39;</span><span class="p">])</span> 

    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the displacement seismic amplitude ratio (DSAR).</span>

<span class="sd">        # TODO:</span>
<span class="sd">        Publication is quite vague and doesn&#39;t have enough detail</span>
<span class="sd">        to understand the method. Unclear whether median is every</span>
<span class="sd">        10 minutes or every day. This affects the bootstrap calc-</span>
<span class="sd">        ulation too, but this might not be necessary..</span>

<span class="sd">        :param stream: The SLCN code for the seismic stream</span>
<span class="sd">        :type stream: str</span>
<span class="sd">        :param startdate: Datetime of the first sample.</span>
<span class="sd">        :type startdate: :class:`obspy.UTCDateTime`</span>
<span class="sd">        :param enddate: Datetime of the last sample.</span>
<span class="sd">        :type enddate: :class:`obspy.UTCDateTime`</span>
<span class="sd">        :param interval: Length of the time interval in seconds over</span>
<span class="sd">                         which to compute DSAR (default 10 mins)</span>
<span class="sd">        :type interval: int, optional</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Trace is empty.&quot;</span><span class="p">)</span>

        <span class="n">tr_lf</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># handle gaps (i.e. NaNs)</span>
        <span class="n">mdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">tr_lf</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">tr_lf</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">mdata</span>
        <span class="c1"># Get second trace for alternative filtering</span>
        <span class="n">tr_hf</span> <span class="o">=</span> <span class="n">tr_lf</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Filter settings</span>
        <span class="n">lf_f1</span><span class="p">,</span> <span class="n">lf_f2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lowerfreqband</span>
        <span class="n">hf_f1</span><span class="p">,</span> <span class="n">hf_f2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">higherfreqband</span>
        <span class="n">st_lf</span> <span class="o">=</span> <span class="n">tr_lf</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">st_hf</span> <span class="o">=</span> <span class="n">tr_hf</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="c1"># Integrate to displacement</span>
        <span class="n">st_lf</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="s1">&#39;cumtrapz&#39;</span><span class="p">)</span>
        <span class="n">st_hf</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="s1">&#39;cumtrapz&#39;</span><span class="p">)</span>

        <span class="n">st_lf</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filtertype</span><span class="p">,</span> <span class="n">freqmin</span><span class="o">=</span><span class="n">lf_f1</span><span class="p">,</span> <span class="n">freqmax</span><span class="o">=</span><span class="n">lf_f2</span><span class="p">,</span> <span class="n">corners</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                     <span class="n">zerophase</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">st_hf</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filtertype</span><span class="p">,</span> <span class="n">freqmin</span><span class="o">=</span><span class="n">hf_f1</span><span class="p">,</span> <span class="n">freqmax</span><span class="o">=</span><span class="n">hf_f2</span><span class="p">,</span> <span class="n">corners</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                     <span class="n">zerophase</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">starttime</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span>
        <span class="n">endtime</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">endtime</span>
        <span class="n">st_lf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">st_lf</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">starttime</span><span class="p">,</span> <span class="n">endtime</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">st_hf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">st_hf</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">starttime</span><span class="p">,</span> <span class="n">endtime</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">tr_lf</span> <span class="o">=</span> <span class="n">st_lf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tr_hf</span> <span class="o">=</span> <span class="n">st_hf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># DSAR calculation</span>
        <span class="n">feature_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">feature_idx</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># loop through data in interval blocks</span>
        <span class="k">for</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span> <span class="ow">in</span> <span class="n">trace_window_times</span><span class="p">(</span><span class="n">tr_lf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">,</span> <span class="n">min_len</span><span class="o">=</span><span class="mf">0.8</span><span class="p">):</span>
            <span class="n">tr_lf_int</span> <span class="o">=</span> <span class="n">tr_lf</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">)</span>
            <span class="n">tr_hf_int</span> <span class="o">=</span> <span class="n">tr_hf</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">)</span>

            <span class="n">absolute_lf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">tr_lf_int</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="n">absolute_hf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">tr_hf_int</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

            <span class="c1"># calculate ratio</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">absolute_lf</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">absolute_hf</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="n">median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">absolute_hf</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="n">ratio</span> <span class="o">=</span> <span class="n">absolute_lf</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">/</span> <span class="n">absolute_hf</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
                <span class="n">median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span>

            <span class="n">feature_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">median</span><span class="p">)</span>
            <span class="n">feature_idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t0</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S&#39;</span><span class="p">))</span>

        <span class="n">xda</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">feature_data</span><span class="p">,</span>
                           <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">feature_idx</span><span class="p">)],</span>
                           <span class="n">dims</span><span class="o">=</span><span class="s1">&#39;datetime&#39;</span><span class="p">)</span>
        <span class="n">xdf</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">({</span><span class="s1">&#39;dsar&#39;</span><span class="p">:</span> <span class="n">xda</span><span class="p">})</span>
        <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;starttime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;endtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">endtime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">station</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reindex</span><span class="p">:</span>
            <span class="n">starttime</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">xda</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">starttime</span> <span class="o">=</span> <span class="n">round_time</span><span class="p">(</span><span class="n">starttime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">)</span>
            <span class="n">endtime</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">xda</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">endtime</span> <span class="o">=</span> <span class="n">round_time</span><span class="p">(</span><span class="n">endtime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">)</span>
            <span class="n">new_index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">starttime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">endtime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
                                      <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">S&quot;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">))</span>
            <span class="n">xdf</span> <span class="o">=</span> <span class="n">xdf</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">datetime</span><span class="o">=</span><span class="n">new_index</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature</span> <span class="o">=</span> <span class="n">xdf</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="zizou.dsar.DSAR.compute" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Compute the displacement seismic amplitude ratio (DSAR).</p>
<h5 id="zizou.dsar.DSAR.compute--todo">TODO:</h5>
<p>Publication is quite vague and doesn't have enough detail
to understand the method. Unclear whether median is every
10 minutes or every day. This affects the bootstrap calc-
ulation too, but this might not be necessary..</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>stream</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The SLCN code for the seismic stream</p>
              </div>
            </li>
            <li>
              <b><code>startdate</code></b>
                  (<code>:class:`obspy.UTCDateTime`</code>)
              –
              <div class="doc-md-description">
                <p>Datetime of the first sample.</p>
              </div>
            </li>
            <li>
              <b><code>enddate</code></b>
                  (<code>:class:`obspy.UTCDateTime`</code>)
              –
              <div class="doc-md-description">
                <p>Datetime of the last sample.</p>
              </div>
            </li>
            <li>
              <b><code>interval</code></b>
                  (<code>int, optional</code>)
              –
              <div class="doc-md-description">
                <p>Length of the time interval in seconds over which to compute DSAR (default 10 mins)</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>src/zizou/dsar.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the displacement seismic amplitude ratio (DSAR).</span>

<span class="sd">    # TODO:</span>
<span class="sd">    Publication is quite vague and doesn&#39;t have enough detail</span>
<span class="sd">    to understand the method. Unclear whether median is every</span>
<span class="sd">    10 minutes or every day. This affects the bootstrap calc-</span>
<span class="sd">    ulation too, but this might not be necessary..</span>

<span class="sd">    :param stream: The SLCN code for the seismic stream</span>
<span class="sd">    :type stream: str</span>
<span class="sd">    :param startdate: Datetime of the first sample.</span>
<span class="sd">    :type startdate: :class:`obspy.UTCDateTime`</span>
<span class="sd">    :param enddate: Datetime of the last sample.</span>
<span class="sd">    :type enddate: :class:`obspy.UTCDateTime`</span>
<span class="sd">    :param interval: Length of the time interval in seconds over</span>
<span class="sd">                     which to compute DSAR (default 10 mins)</span>
<span class="sd">    :type interval: int, optional</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Trace is empty.&quot;</span><span class="p">)</span>

    <span class="n">tr_lf</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1"># handle gaps (i.e. NaNs)</span>
    <span class="n">mdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">tr_lf</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">tr_lf</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">mdata</span>
    <span class="c1"># Get second trace for alternative filtering</span>
    <span class="n">tr_hf</span> <span class="o">=</span> <span class="n">tr_lf</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># Filter settings</span>
    <span class="n">lf_f1</span><span class="p">,</span> <span class="n">lf_f2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lowerfreqband</span>
    <span class="n">hf_f1</span><span class="p">,</span> <span class="n">hf_f2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">higherfreqband</span>
    <span class="n">st_lf</span> <span class="o">=</span> <span class="n">tr_lf</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">st_hf</span> <span class="o">=</span> <span class="n">tr_hf</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="c1"># Integrate to displacement</span>
    <span class="n">st_lf</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="s1">&#39;cumtrapz&#39;</span><span class="p">)</span>
    <span class="n">st_hf</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="s1">&#39;cumtrapz&#39;</span><span class="p">)</span>

    <span class="n">st_lf</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filtertype</span><span class="p">,</span> <span class="n">freqmin</span><span class="o">=</span><span class="n">lf_f1</span><span class="p">,</span> <span class="n">freqmax</span><span class="o">=</span><span class="n">lf_f2</span><span class="p">,</span> <span class="n">corners</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                 <span class="n">zerophase</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">st_hf</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filtertype</span><span class="p">,</span> <span class="n">freqmin</span><span class="o">=</span><span class="n">hf_f1</span><span class="p">,</span> <span class="n">freqmax</span><span class="o">=</span><span class="n">hf_f2</span><span class="p">,</span> <span class="n">corners</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                 <span class="n">zerophase</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">starttime</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span>
    <span class="n">endtime</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">endtime</span>
    <span class="n">st_lf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">st_lf</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">starttime</span><span class="p">,</span> <span class="n">endtime</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">st_hf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">st_hf</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">starttime</span><span class="p">,</span> <span class="n">endtime</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">tr_lf</span> <span class="o">=</span> <span class="n">st_lf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">tr_hf</span> <span class="o">=</span> <span class="n">st_hf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># DSAR calculation</span>
    <span class="n">feature_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">feature_idx</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># loop through data in interval blocks</span>
    <span class="k">for</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span> <span class="ow">in</span> <span class="n">trace_window_times</span><span class="p">(</span><span class="n">tr_lf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">,</span> <span class="n">min_len</span><span class="o">=</span><span class="mf">0.8</span><span class="p">):</span>
        <span class="n">tr_lf_int</span> <span class="o">=</span> <span class="n">tr_lf</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">)</span>
        <span class="n">tr_hf_int</span> <span class="o">=</span> <span class="n">tr_hf</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">)</span>

        <span class="n">absolute_lf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">tr_lf_int</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">absolute_hf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">tr_hf_int</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># calculate ratio</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">absolute_lf</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">absolute_hf</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">absolute_hf</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="n">ratio</span> <span class="o">=</span> <span class="n">absolute_lf</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">/</span> <span class="n">absolute_hf</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
            <span class="n">median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span>

        <span class="n">feature_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">median</span><span class="p">)</span>
        <span class="n">feature_idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t0</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S&#39;</span><span class="p">))</span>

    <span class="n">xda</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">feature_data</span><span class="p">,</span>
                       <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">feature_idx</span><span class="p">)],</span>
                       <span class="n">dims</span><span class="o">=</span><span class="s1">&#39;datetime&#39;</span><span class="p">)</span>
    <span class="n">xdf</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">({</span><span class="s1">&#39;dsar&#39;</span><span class="p">:</span> <span class="n">xda</span><span class="p">})</span>
    <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;starttime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
    <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;endtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">endtime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
    <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">station</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reindex</span><span class="p">:</span>
        <span class="n">starttime</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">xda</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">starttime</span> <span class="o">=</span> <span class="n">round_time</span><span class="p">(</span><span class="n">starttime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">)</span>
        <span class="n">endtime</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">xda</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">endtime</span> <span class="o">=</span> <span class="n">round_time</span><span class="p">(</span><span class="n">endtime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">)</span>
        <span class="n">new_index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">starttime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">endtime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
                                  <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">S&quot;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">))</span>
        <span class="n">xdf</span> <span class="o">=</span> <span class="n">xdf</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">datetime</span><span class="o">=</span><span class="n">new_index</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">feature</span> <span class="o">=</span> <span class="n">xdf</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="zizou.spectral_features"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="zizou.spectral_features.SpectralFeatures" class="doc doc-heading">
            <code>SpectralFeatures</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="zizou.FeatureBaseClass">FeatureBaseClass</span></code></p>


              <details class="quote">
                <summary>Source code in <code>src/zizou/spectral_features.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SpectralFeatures</span><span class="p">(</span><span class="n">FeatureBaseClass</span><span class="p">):</span>

    <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;central_freq&#39;</span><span class="p">,</span> <span class="s1">&#39;bandwidth&#39;</span><span class="p">,</span> <span class="s1">&#39;predom_freq&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mf">600.</span><span class="p">,</span> <span class="n">filtertype</span><span class="o">=</span><span class="s1">&#39;highpass&#39;</span><span class="p">,</span>
                 <span class="n">filterfreq</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">ncep</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                 <span class="n">configfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SpectralFeatures</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filtertype</span> <span class="o">=</span> <span class="n">filtertype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filterfreq</span> <span class="o">=</span> <span class="n">filterfreq</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ncep</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ncep</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">configfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">configfile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">configfile</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;interval&#39;</span><span class="p">,</span> <span class="n">interval</span><span class="p">)</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;spectral_features&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filtertype</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filtertype&#39;</span><span class="p">,</span> <span class="n">filtertype</span><span class="p">)</span> 
                <span class="n">freqs</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filterfreq&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">freqs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">filterfreq</span> <span class="o">=</span> <span class="p">(</span><span class="n">freqs</span><span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">],</span> <span class="n">freqs</span><span class="p">[</span><span class="s1">&#39;high&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ncep</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;num_cepstral&#39;</span><span class="p">,</span> <span class="n">ncep</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param trace: The seismic waveform data</span>
<span class="sd">        :type trace: :class:`obspy.Trace`</span>
<span class="sd">        :return:</span>
<span class="sd">        DataFrame containing</span>
<span class="sd">        - central frequency (acceleration) in Hz</span>
<span class="sd">        - bandwidth parameter (acceleration)</span>
<span class="sd">        - predominant frequency (acceleration) in Hz</span>
<span class="sd">        - eight cepstral coefficients</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Trace is empty.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">sampling_rate</span>

        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;central_freq&#39;</span><span class="p">,</span> <span class="s1">&#39;bandwidth&#39;</span><span class="p">,</span> <span class="s1">&#39;predom_freq&#39;</span><span class="p">]</span>
        <span class="c1"># keys += [f&#39;cepstral_coef_{ind}&#39; for ind in np.arange(self.ncep)]</span>

        <span class="c1"># initialise dataframe</span>
        <span class="n">feature_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">feature_idx</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># loop through data in interval blocks</span>
        <span class="k">for</span> <span class="n">tr_int</span> <span class="ow">in</span> <span class="n">trace_window_data</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">,</span> <span class="n">min_len</span><span class="o">=</span><span class="mf">0.8</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">tr_int</span><span class="o">.</span><span class="n">data</span><span class="p">)):</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tr_int</span><span class="o">.</span><span class="n">detrend</span><span class="p">(</span><span class="s1">&#39;constant&#39;</span><span class="p">)</span>
                <span class="n">tr_int</span><span class="o">.</span><span class="n">detrend</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
                <span class="n">apply_freq_filter</span><span class="p">(</span><span class="n">tr_int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filtertype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filterfreq</span><span class="p">)</span>
                <span class="n">tr_int_diff</span> <span class="o">=</span> <span class="n">tr_int</span><span class="o">.</span><span class="n">differentiate</span><span class="p">()</span>

                <span class="c1"># Calculate psdf</span>
                <span class="n">nfft</span> <span class="o">=</span> <span class="n">obspy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">next_pow_2</span><span class="p">(</span><span class="n">tr_int_diff</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">npts</span><span class="p">)</span>
                <span class="n">frequency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">nfft</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">frequency</span> <span class="o">=</span> <span class="n">frequency</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nfft</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span>
                <span class="n">data_f</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">fftpack</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">tr_int_diff</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">nfft</span><span class="p">)</span>
                <span class="n">data_psd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data_f</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nfft</span> <span class="o">//</span> <span class="mi">2</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>

                <span class="c1"># Interpolate onto logspace frequency vector</span>
                <span class="n">f_ls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">401</span><span class="p">)</span>  <span class="c1"># These constants should be accessible</span>
                <span class="n">data_psd_raw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">f_ls</span><span class="p">,</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">data_psd</span><span class="p">)</span>
                <span class="n">data_psd_ls</span> <span class="o">=</span> <span class="n">obspy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">smooth</span><span class="p">(</span><span class="n">data_psd_raw</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

                <span class="n">central_freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centralFrequency</span><span class="p">(</span><span class="n">data_psd_ls</span><span class="p">,</span> <span class="n">f_ls</span><span class="p">)</span>
                <span class="n">bandwidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandwidth</span><span class="p">(</span><span class="n">data_psd_ls</span><span class="p">,</span> <span class="n">f_ls</span><span class="p">)</span>
                <span class="n">predom_freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predominantFrequency</span><span class="p">(</span><span class="n">data_psd_ls</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">f_ls</span><span class="p">)</span>
                <span class="c1"># cepstral_coef = self.cepstralCoefficients(</span>
                <span class="c1">#     tr_int.data, fs, self.ncep</span>
                <span class="c1"># )</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">central_freq</span><span class="p">,</span> <span class="n">bandwidth</span><span class="p">,</span> <span class="n">predom_freq</span><span class="p">]</span>
                <span class="c1">#vals = np.concatenate((vals, cepstral_coef, hob), axis=None)</span>

            <span class="n">feature_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
            <span class="n">feature_idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">tr_int</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S&#39;</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">xdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">feature_data</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">feature_idx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;datetime&quot;</span><span class="p">),</span>
            <span class="n">columns</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">()</span>
        <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;starttime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;endtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">endtime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">station</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">feature</span> <span class="o">=</span> <span class="n">xdf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="o">=</span> <span class="n">trace</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">predominantFrequency</span><span class="p">(</span><span class="n">psd</span><span class="p">,</span> <span class="n">freq</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The peak frequency of the acceleration power spectral</span>
<span class="sd">        density function, in Hz.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">predom_freq</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">psd</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">predom_freq</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">centralFrequency</span><span class="p">(</span><span class="n">psd</span><span class="p">,</span> <span class="n">freq</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The &#39;central&#39; frequency of the acceleration power</span>
<span class="sd">        spectral density function (Hz). Defined as the</span>
<span class="sd">        square root of the ratio between the second and</span>
<span class="sd">        zero-th spectral moments. The spectral moments</span>
<span class="sd">        are calculated with log-spaced frequencies.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">m0</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">simps</span><span class="p">(</span><span class="n">freq</span> <span class="o">**</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">psd</span><span class="p">)</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">simps</span><span class="p">(</span><span class="n">freq</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">psd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">m2</span> <span class="o">/</span> <span class="n">m0</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">bandwidth</span><span class="p">(</span><span class="n">psd</span><span class="p">,</span> <span class="n">freq</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The Vanmarcke (1970) bandwidth parameter, q where</span>
<span class="sd">        0 &lt;= q &lt;= 1. Calculated using the spectral moments</span>
<span class="sd">        of the acceleration power spectral density function.</span>
<span class="sd">        0 is a Dirac delta PSDF (sine wave), 1 is a flat PSDF</span>
<span class="sd">        (white signal).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">m0</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">simps</span><span class="p">(</span><span class="n">freq</span><span class="o">**</span><span class="mi">0</span> <span class="o">*</span> <span class="n">psd</span><span class="p">)</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">simps</span><span class="p">(</span><span class="n">freq</span><span class="o">**</span><span class="mi">1</span> <span class="o">*</span> <span class="n">psd</span><span class="p">)</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">simps</span><span class="p">(</span><span class="n">freq</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">psd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">m1</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">m2</span> <span class="o">/</span> <span class="n">m0</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">cepstralCoefficients</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">ncep</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">nfilters</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="s2">&quot;Hamming&quot;</span><span class="p">):</span>
        <span class="n">cep</span> <span class="o">=</span> <span class="n">obspy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">freqattributes</span><span class="o">.</span><span class="n">log_cepstrum</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span>
            <span class="n">nc</span><span class="o">=</span><span class="n">ncep</span><span class="p">,</span>
            <span class="n">p</span><span class="o">=</span><span class="n">nfilters</span><span class="p">,</span>
            <span class="n">n</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">w</span><span class="o">=</span><span class="n">window</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">cep</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="zizou.spectral_features.SpectralFeatures.bandwidth" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bandwidth</span><span class="p">(</span><span class="n">psd</span><span class="p">,</span> <span class="n">freq</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>The Vanmarcke (1970) bandwidth parameter, q where
0 &lt;= q &lt;= 1. Calculated using the spectral moments
of the acceleration power spectral density function.
0 is a Dirac delta PSDF (sine wave), 1 is a flat PSDF
(white signal).</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/spectral_features.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">bandwidth</span><span class="p">(</span><span class="n">psd</span><span class="p">,</span> <span class="n">freq</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Vanmarcke (1970) bandwidth parameter, q where</span>
<span class="sd">    0 &lt;= q &lt;= 1. Calculated using the spectral moments</span>
<span class="sd">    of the acceleration power spectral density function.</span>
<span class="sd">    0 is a Dirac delta PSDF (sine wave), 1 is a flat PSDF</span>
<span class="sd">    (white signal).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m0</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">simps</span><span class="p">(</span><span class="n">freq</span><span class="o">**</span><span class="mi">0</span> <span class="o">*</span> <span class="n">psd</span><span class="p">)</span>
    <span class="n">m1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">simps</span><span class="p">(</span><span class="n">freq</span><span class="o">**</span><span class="mi">1</span> <span class="o">*</span> <span class="n">psd</span><span class="p">)</span>
    <span class="n">m2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">simps</span><span class="p">(</span><span class="n">freq</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">psd</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">m1</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">m2</span> <span class="o">/</span> <span class="n">m0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zizou.spectral_features.SpectralFeatures.centralFrequency" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">centralFrequency</span><span class="p">(</span><span class="n">psd</span><span class="p">,</span> <span class="n">freq</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>The 'central' frequency of the acceleration power
spectral density function (Hz). Defined as the
square root of the ratio between the second and
zero-th spectral moments. The spectral moments
are calculated with log-spaced frequencies.</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/spectral_features.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">centralFrequency</span><span class="p">(</span><span class="n">psd</span><span class="p">,</span> <span class="n">freq</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The &#39;central&#39; frequency of the acceleration power</span>
<span class="sd">    spectral density function (Hz). Defined as the</span>
<span class="sd">    square root of the ratio between the second and</span>
<span class="sd">    zero-th spectral moments. The spectral moments</span>
<span class="sd">    are calculated with log-spaced frequencies.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m0</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">simps</span><span class="p">(</span><span class="n">freq</span> <span class="o">**</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">psd</span><span class="p">)</span>
    <span class="n">m2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">simps</span><span class="p">(</span><span class="n">freq</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">psd</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">m2</span> <span class="o">/</span> <span class="n">m0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zizou.spectral_features.SpectralFeatures.compute" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>trace</code></b>
                  (<code>:class:`obspy.Trace`</code>)
              –
              <div class="doc-md-description">
                <p>The seismic waveform data</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              –
              <div class="doc-md-description">
                <p>DataFrame containing - central frequency (acceleration) in Hz - bandwidth parameter (acceleration) - predominant frequency (acceleration) in Hz - eight cepstral coefficients</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>src/zizou/spectral_features.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param trace: The seismic waveform data</span>
<span class="sd">    :type trace: :class:`obspy.Trace`</span>
<span class="sd">    :return:</span>
<span class="sd">    DataFrame containing</span>
<span class="sd">    - central frequency (acceleration) in Hz</span>
<span class="sd">    - bandwidth parameter (acceleration)</span>
<span class="sd">    - predominant frequency (acceleration) in Hz</span>
<span class="sd">    - eight cepstral coefficients</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Trace is empty.&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">sampling_rate</span>

    <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;central_freq&#39;</span><span class="p">,</span> <span class="s1">&#39;bandwidth&#39;</span><span class="p">,</span> <span class="s1">&#39;predom_freq&#39;</span><span class="p">]</span>
    <span class="c1"># keys += [f&#39;cepstral_coef_{ind}&#39; for ind in np.arange(self.ncep)]</span>

    <span class="c1"># initialise dataframe</span>
    <span class="n">feature_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">feature_idx</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># loop through data in interval blocks</span>
    <span class="k">for</span> <span class="n">tr_int</span> <span class="ow">in</span> <span class="n">trace_window_data</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">,</span> <span class="n">min_len</span><span class="o">=</span><span class="mf">0.8</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">tr_int</span><span class="o">.</span><span class="n">data</span><span class="p">)):</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tr_int</span><span class="o">.</span><span class="n">detrend</span><span class="p">(</span><span class="s1">&#39;constant&#39;</span><span class="p">)</span>
            <span class="n">tr_int</span><span class="o">.</span><span class="n">detrend</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
            <span class="n">apply_freq_filter</span><span class="p">(</span><span class="n">tr_int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filtertype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filterfreq</span><span class="p">)</span>
            <span class="n">tr_int_diff</span> <span class="o">=</span> <span class="n">tr_int</span><span class="o">.</span><span class="n">differentiate</span><span class="p">()</span>

            <span class="c1"># Calculate psdf</span>
            <span class="n">nfft</span> <span class="o">=</span> <span class="n">obspy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">next_pow_2</span><span class="p">(</span><span class="n">tr_int_diff</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">npts</span><span class="p">)</span>
            <span class="n">frequency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">nfft</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">frequency</span> <span class="o">=</span> <span class="n">frequency</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nfft</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span>
            <span class="n">data_f</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">fftpack</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">tr_int_diff</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">nfft</span><span class="p">)</span>
            <span class="n">data_psd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data_f</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nfft</span> <span class="o">//</span> <span class="mi">2</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>

            <span class="c1"># Interpolate onto logspace frequency vector</span>
            <span class="n">f_ls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">401</span><span class="p">)</span>  <span class="c1"># These constants should be accessible</span>
            <span class="n">data_psd_raw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">f_ls</span><span class="p">,</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">data_psd</span><span class="p">)</span>
            <span class="n">data_psd_ls</span> <span class="o">=</span> <span class="n">obspy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">smooth</span><span class="p">(</span><span class="n">data_psd_raw</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

            <span class="n">central_freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centralFrequency</span><span class="p">(</span><span class="n">data_psd_ls</span><span class="p">,</span> <span class="n">f_ls</span><span class="p">)</span>
            <span class="n">bandwidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandwidth</span><span class="p">(</span><span class="n">data_psd_ls</span><span class="p">,</span> <span class="n">f_ls</span><span class="p">)</span>
            <span class="n">predom_freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predominantFrequency</span><span class="p">(</span><span class="n">data_psd_ls</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">f_ls</span><span class="p">)</span>
            <span class="c1"># cepstral_coef = self.cepstralCoefficients(</span>
            <span class="c1">#     tr_int.data, fs, self.ncep</span>
            <span class="c1"># )</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">central_freq</span><span class="p">,</span> <span class="n">bandwidth</span><span class="p">,</span> <span class="n">predom_freq</span><span class="p">]</span>
            <span class="c1">#vals = np.concatenate((vals, cepstral_coef, hob), axis=None)</span>

        <span class="n">feature_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
        <span class="n">feature_idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">tr_int</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S&#39;</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="n">xdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">feature_data</span><span class="p">,</span>
        <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">feature_idx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;datetime&quot;</span><span class="p">),</span>
        <span class="n">columns</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span>
        <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">()</span>
    <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;starttime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
    <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;endtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">endtime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
    <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">station</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">feature</span> <span class="o">=</span> <span class="n">xdf</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="o">=</span> <span class="n">trace</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zizou.spectral_features.SpectralFeatures.predominantFrequency" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">predominantFrequency</span><span class="p">(</span><span class="n">psd</span><span class="p">,</span> <span class="n">freq</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>The peak frequency of the acceleration power spectral
density function, in Hz.</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/spectral_features.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">predominantFrequency</span><span class="p">(</span><span class="n">psd</span><span class="p">,</span> <span class="n">freq</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The peak frequency of the acceleration power spectral</span>
<span class="sd">    density function, in Hz.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">predom_freq</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">psd</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">predom_freq</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="zizou.pca"></a>
    <div class="doc doc-contents first">

      <p>The main PCA script</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="zizou.pca.PCA" class="doc doc-heading">
            <code>PCA</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="zizou.AnomalyDetectionBaseClass" href="#zizou.anomaly_base.AnomalyDetectionBaseClass">AnomalyDetectionBaseClass</a></code></p>


              <details class="quote">
                <summary>Source code in <code>src/zizou/pca.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PCA</span><span class="p">(</span><span class="n">AnomalyDetectionBaseClass</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modelfile</span><span class="o">=</span><span class="s1">&#39;pcaModel.pkl&#39;</span><span class="p">,</span> <span class="n">pca_features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
                 <span class="n">n_components</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pca_features</span> <span class="o">=</span> <span class="n">pca_features</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelfile</span> <span class="o">=</span> <span class="n">modelfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="n">interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span> <span class="o">=</span> <span class="n">n_components</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__pca_model</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__mean</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__std</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__feature</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__training_run</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pca_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pca_model</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mean</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">std</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__std</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">feature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__feature</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelfile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_read_model_parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelfile</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pca</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">decomposition</span><span class="o">.</span><span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_features</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fq</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
            <span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__pca_model</span> <span class="o">=</span> <span class="n">pca</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__mean</span> <span class="o">=</span> <span class="n">mns</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__std</span> <span class="o">=</span> <span class="n">stds</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_model_parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelfile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__training_run</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_write_model_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modelfile</span><span class="p">):</span>
        <span class="n">dirName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">modelfile</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dirName</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dirName</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">modelfile</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">__pca_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__std</span><span class="p">],</span> <span class="n">fh</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_model_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modelfile</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">modelfile</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__pca_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__std</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">infer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fq</span><span class="p">,</span> <span class="n">savedir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :param fq: Object to request features.</span>
<span class="sd">        :type fq: :class:`FeatureRequest`</span>
<span class="sd">        :param savedir:</span>
<span class="sd">        :param overwrite:</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__training_run</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Run &#39;training&#39; first.&quot;</span>
            <span class="k">raise</span> <span class="n">ModelException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">feats</span><span class="p">,</span> <span class="n">mns</span><span class="p">,</span> <span class="n">stds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureStack</span><span class="p">(</span><span class="n">fq</span><span class="p">)</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pca_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">feats</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pc</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">)]</span>
        <span class="n">foo</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">feats</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                         <span class="n">keys</span><span class="p">],</span>
                           <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">,</span> <span class="s1">&#39;pca_component&#39;</span><span class="p">])</span>
        <span class="n">xdf</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">({</span><span class="s1">&#39;pca&#39;</span><span class="p">:</span> <span class="n">foo</span><span class="p">})</span>
        <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;starttime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fq</span><span class="o">.</span><span class="n">starttime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;endtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fq</span><span class="o">.</span><span class="n">endtime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fq</span><span class="o">.</span><span class="n">site</span>
        <span class="k">if</span> <span class="n">savedir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_model_output</span><span class="p">(</span><span class="n">xdf</span><span class="p">,</span> <span class="n">savedir</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xdf</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="zizou.pca.PCA.infer" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">infer</span><span class="p">(</span><span class="n">fq</span><span class="p">,</span> <span class="n">savedir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>fq</code></b>
                  (<code>:class:`FeatureRequest`</code>)
              –
              <div class="doc-md-description">
                <p>Object to request features.</p>
              </div>
            </li>
            <li>
              <b><code>savedir</code></b>
              –
              <div class="doc-md-description">
                
              </div>
            </li>
            <li>
              <b><code>overwrite</code></b>
              –
              <div class="doc-md-description">
                
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              –
              <div class="doc-md-description">
                
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>src/zizou/pca.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">infer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fq</span><span class="p">,</span> <span class="n">savedir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    :param fq: Object to request features.</span>
<span class="sd">    :type fq: :class:`FeatureRequest`</span>
<span class="sd">    :param savedir:</span>
<span class="sd">    :param overwrite:</span>
<span class="sd">    :return:</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__training_run</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Run &#39;training&#39; first.&quot;</span>
        <span class="k">raise</span> <span class="n">ModelException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">feats</span><span class="p">,</span> <span class="n">mns</span><span class="p">,</span> <span class="n">stds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureStack</span><span class="p">(</span><span class="n">fq</span><span class="p">)</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pca_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">feats</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pc</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">)]</span>
    <span class="n">foo</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">feats</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                     <span class="n">keys</span><span class="p">],</span>
                       <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">,</span> <span class="s1">&#39;pca_component&#39;</span><span class="p">])</span>
    <span class="n">xdf</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">({</span><span class="s1">&#39;pca&#39;</span><span class="p">:</span> <span class="n">foo</span><span class="p">})</span>
    <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;starttime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fq</span><span class="o">.</span><span class="n">starttime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
    <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;endtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fq</span><span class="o">.</span><span class="n">endtime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
    <span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fq</span><span class="o">.</span><span class="n">site</span>
    <span class="k">if</span> <span class="n">savedir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_model_output</span><span class="p">(</span><span class="n">xdf</span><span class="p">,</span> <span class="n">savedir</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">xdf</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="zizou.autoencoder"></a>
    <div class="doc doc-contents first">

      <p>Train an autoencoder to reduce dimensionality of input features.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="zizou.autoencoder.TiedAutoEncoder" class="doc doc-heading">
            <code>TiedAutoEncoder</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>


      <p>Applies an tied-weight autoencoder to the incoming data.
From https://gist.github.com/northanapon/375e17fb395391c144deff20914e51df
Parameters</p>
<hr />
<p>in_features : int
    size of each input sample.
h_features : List[int]
    a list of size of each layer for the encoder and
    the reverse for the decoder.
activation : function, optional
    an activation function to apply for each layer 
    (the default is torch.tanh).</p>

              <details class="quote">
                <summary>Source code in <code>src/zizou/autoencoder.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TiedAutoEncoder</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Applies an tied-weight autoencoder to the incoming data.</span>
<span class="sd">    From https://gist.github.com/northanapon/375e17fb395391c144deff20914e51df</span>
<span class="sd">    Parameters</span>
<span class="sd">    -------------</span>
<span class="sd">    in_features : int</span>
<span class="sd">        size of each input sample.</span>
<span class="sd">    h_features : List[int]</span>
<span class="sd">        a list of size of each layer for the encoder and</span>
<span class="sd">        the reverse for the decoder.</span>
<span class="sd">    activation : function, optional</span>
<span class="sd">        an activation function to apply for each layer </span>
<span class="sd">        (the default is torch.tanh).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">in_features</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">h_features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> 
            <span class="n">activation</span><span class="o">=</span><span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an autoencoder.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_features</span> <span class="o">=</span> <span class="n">in_features</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_features</span> <span class="o">=</span> <span class="n">h_features</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoded_features</span> <span class="o">=</span> <span class="n">h_features</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activation</span> <span class="o">=</span> <span class="n">activation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ParameterList</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enc_biases</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ParameterList</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dec_biases</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ParameterList</span><span class="p">([])</span>
        <span class="n">in_dim</span> <span class="o">=</span> <span class="n">in_features</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">h_features</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">DoubleTensor</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">in_dim</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enc_biases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">DoubleTensor</span><span class="p">(</span><span class="n">h</span><span class="p">)))</span>
            <span class="n">in_dim</span> <span class="o">=</span> <span class="n">h</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">h_features</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dec_biases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">DoubleTensor</span><span class="p">(</span><span class="n">h</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dec_biases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">DoubleTensor</span><span class="p">(</span><span class="n">in_features</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_parameters</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loss</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="n">reduction</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">DoubleTensor</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return result of encoding and decoding.&quot;&quot;&quot;</span>
        <span class="n">dec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">DoubleTensor</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return encoded data.&quot;&quot;&quot;</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">enc_biases</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">o</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">enc_biases</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">DoubleTensor</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return decoded data.&quot;&quot;&quot;</span>
        <span class="n">r_weights</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">r_weights</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dec_biases</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">o</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">w</span><span class="o">.</span><span class="n">t</span><span class="p">(),</span> <span class="n">b</span><span class="p">)</span>
            <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">r_weights</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">t</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dec_biases</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">reset_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset linear module parameters (from nn.Linear).&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">enc_biases</span><span class="p">):</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">kaiming_uniform_</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">b</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fan_in</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">_calculate_fan_in_and_fan_out</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
                <span class="n">bound</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">fan_in</span><span class="p">)</span>
                <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">bound</span><span class="p">,</span> <span class="n">bound</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dec_biases</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">b</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fan_in</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">_calculate_fan_in_and_fan_out</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">t</span><span class="p">())</span>
                <span class="n">bound</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">fan_in</span><span class="p">)</span>
                <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">bound</span><span class="p">,</span> <span class="n">bound</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="zizou.autoencoder.TiedAutoEncoder.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">in_features</span><span class="p">,</span> <span class="n">h_features</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Create an autoencoder.</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/autoencoder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">in_features</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">h_features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> 
        <span class="n">activation</span><span class="o">=</span><span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create an autoencoder.&quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">in_features</span> <span class="o">=</span> <span class="n">in_features</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">h_features</span> <span class="o">=</span> <span class="n">h_features</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">encoded_features</span> <span class="o">=</span> <span class="n">h_features</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">activation</span> <span class="o">=</span> <span class="n">activation</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ParameterList</span><span class="p">([])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">enc_biases</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ParameterList</span><span class="p">([])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dec_biases</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ParameterList</span><span class="p">([])</span>
    <span class="n">in_dim</span> <span class="o">=</span> <span class="n">in_features</span>
    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">h_features</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">DoubleTensor</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">in_dim</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enc_biases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">DoubleTensor</span><span class="p">(</span><span class="n">h</span><span class="p">)))</span>
        <span class="n">in_dim</span> <span class="o">=</span> <span class="n">h</span>
    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">h_features</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dec_biases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">DoubleTensor</span><span class="p">(</span><span class="n">h</span><span class="p">)))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dec_biases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">DoubleTensor</span><span class="p">(</span><span class="n">in_features</span><span class="p">)))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">reset_parameters</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">loss</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="n">reduction</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zizou.autoencoder.TiedAutoEncoder.decode" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">decode</span><span class="p">(</span><span class="n">o</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Return decoded data.</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/autoencoder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">DoubleTensor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return decoded data.&quot;&quot;&quot;</span>
    <span class="n">r_weights</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">r_weights</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dec_biases</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">w</span><span class="o">.</span><span class="n">t</span><span class="p">(),</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">r_weights</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">t</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dec_biases</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zizou.autoencoder.TiedAutoEncoder.encode" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">encode</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Return encoded data.</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/autoencoder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">DoubleTensor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return encoded data.&quot;&quot;&quot;</span>
    <span class="n">o</span> <span class="o">=</span> <span class="n">x</span>
    <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">enc_biases</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">enc_biases</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zizou.autoencoder.TiedAutoEncoder.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Return result of encoding and decoding.</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/autoencoder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">DoubleTensor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return result of encoding and decoding.&quot;&quot;&quot;</span>
    <span class="n">dec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zizou.autoencoder.TiedAutoEncoder.reset_parameters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reset_parameters</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Reset linear module parameters (from nn.Linear).</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/autoencoder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">reset_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reset linear module parameters (from nn.Linear).&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">enc_biases</span><span class="p">):</span>
        <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">kaiming_uniform_</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">b</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fan_in</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">_calculate_fan_in_and_fan_out</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
            <span class="n">bound</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">fan_in</span><span class="p">)</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">bound</span><span class="p">,</span> <span class="n">bound</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dec_biases</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">b</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fan_in</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">_calculate_fan_in_and_fan_out</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">t</span><span class="p">())</span>
            <span class="n">bound</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">fan_in</span><span class="p">)</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">bound</span><span class="p">,</span> <span class="n">bound</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="zizou.visualise"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="zizou.visualise.get_trace" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_trace</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">colour</span><span class="p">,</span> <span class="n">kws_ssam</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Return a plotly graphics object from a feature.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>data</code></b>
                  (<code>:class:`xarray.DataArray`</code>)
              –
              <div class="doc-md-description">
                <p>Feature data to plot.</p>
              </div>
            </li>
            <li>
              <b><code>colour</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Colour for line plots.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>:class:`plotly.graph_objs.Scatter` | :class:`plotly.graph_objs.Figure`</code>
              –
              <div class="doc-md-description">
                <p>A 1-D line plot or a 2D heatmap.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>src/zizou/visualise.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_trace</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">colour</span><span class="p">,</span> <span class="n">kws_ssam</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a plotly graphics object from a feature.</span>

<span class="sd">    :param data: Feature data to plot.</span>
<span class="sd">    :type data: :class:`xarray.DataArray`</span>
<span class="sd">    :param colour: Colour for line plots.</span>
<span class="sd">    :type colour: str </span>
<span class="sd">    :returns: A 1-D line plot or a 2D heatmap.</span>
<span class="sd">    :rtype: :class:`plotly.graph_objs.Scatter` or</span>
<span class="sd">            :class:`plotly.graph_objs.Figure`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;ssam&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">plot_ssam_plotly</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">new_fig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                <span class="n">dbscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kws_ssam</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;filterbank&#39;</span><span class="p">:</span>
         <span class="k">return</span> <span class="n">plot_ssam_plotly</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">new_fig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                 <span class="n">dbscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">canvas_dim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="o">**</span><span class="n">kws_ssam</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;sonogram&#39;</span><span class="p">:</span>
         <span class="k">return</span> <span class="n">plot_ssam_plotly</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">new_fig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                 <span class="n">dbscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">canvas_dim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="o">**</span><span class="n">kws_ssam</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># data = data.fillna(data.mean())</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">data</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span><span class="o">.</span><span class="n">to_pydatetime</span><span class="p">()</span>
        <span class="n">featureData</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()[</span><span class="n">data</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
        <span class="k">return</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span>
                          <span class="n">y</span><span class="o">=</span><span class="n">featureData</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                          <span class="n">line_color</span><span class="o">=</span><span class="n">colour</span><span class="p">,</span>
                          <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;</span><span class="si">{}</span><span class="s1">&lt;/b&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">name</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="zizou.visualise.multi_feature_plot" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">multi_feature_plot</span><span class="p">(</span><span class="n">feature1</span><span class="p">,</span> <span class="n">feature2</span><span class="p">,</span> <span class="n">equal_yrange</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rangeslider</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kws_ssam</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Return a combined time-series plot of two features.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>feature1</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>First feature to plot with y-scale on the left.</p>
              </div>
            </li>
            <li>
              <b><code>feature2</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Second feature to plot with y-scale on the right.</p>
              </div>
            </li>
            <li>
              <b><code>equal_yrange</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>If True align yscales.</p>
              </div>
            </li>
            <li>
              <b><code>rangeslider</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>If True show secondary panel for zooming.</p>
              </div>
            </li>
            <li>
              <b><code>kws_ssam</code></b>
                  (<code>dict</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Keywords to be passed to :class:<code>zizou.visualise.plot_ssam_plotly</code></p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>:class:`plotly.graph_objs.Figure`</code>
              –
              <div class="doc-md-description">
                <p>plotly figure that can be displayed in a Jupyter notebook or in a dash app.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>src/zizou/visualise.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">multi_feature_plot</span><span class="p">(</span><span class="n">feature1</span><span class="p">,</span> <span class="n">feature2</span><span class="p">,</span> <span class="n">equal_yrange</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">rangeslider</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kws_ssam</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a combined time-series plot of two features.</span>

<span class="sd">    :param feature1: First feature to plot with y-scale on</span>
<span class="sd">                     the left.</span>
<span class="sd">    :type feature1: str</span>
<span class="sd">    :param feature2: Second feature to plot with y-scale on</span>
<span class="sd">                     the right.</span>
<span class="sd">    :type feature2: str</span>
<span class="sd">    :param equal_yrange: If True align yscales.</span>
<span class="sd">    :type equal_yrange: bool</span>
<span class="sd">    :param rangeslider: If True show secondary panel for zooming.</span>
<span class="sd">    :type rangeslider: bool</span>
<span class="sd">    :param kws_ssam: Keywords to be passed to</span>
<span class="sd">                     :class:`zizou.visualise.plot_ssam_plotly`</span>
<span class="sd">    :type kws_ssam: dict</span>
<span class="sd">    :returns: plotly figure that can be displayed in a Jupyter</span>
<span class="sd">              notebook or in a dash app.</span>
<span class="sd">    :rtype: :class:`plotly.graph_objs.Figure`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">kws_ssam</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">kws_ssam</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">feature2</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ssam&#39;</span><span class="p">,</span> <span class="s1">&#39;sonogram&#39;</span><span class="p">,</span> <span class="s1">&#39;filterbank&#39;</span><span class="p">]:</span>
        <span class="c1"># Always plot 2D features first</span>
        <span class="n">feature_tmp</span> <span class="o">=</span> <span class="n">feature1</span>
        <span class="n">feature1</span> <span class="o">=</span> <span class="n">feature2</span>
        <span class="n">feature2</span> <span class="o">=</span> <span class="n">feature_tmp</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span><span class="n">specs</span><span class="o">=</span><span class="p">[[{</span><span class="s2">&quot;secondary_y&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}]])</span>

    <span class="n">trace</span> <span class="o">=</span> <span class="n">get_trace</span><span class="p">(</span><span class="n">feature1</span><span class="p">,</span> <span class="s1">&#39;deepskyblue&#39;</span><span class="p">,</span> <span class="n">kws_ssam</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">secondary_y</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">tickfont</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;deepskyblue&#39;</span><span class="p">),</span>
                     <span class="n">title_font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;deepskyblue&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">feature2</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ssam&#39;</span><span class="p">,</span> <span class="s1">&#39;sonogram&#39;</span><span class="p">,</span> <span class="s1">&#39;filterbank&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">feature1</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ssam&#39;</span><span class="p">,</span> <span class="s1">&#39;sonogram&#39;</span><span class="p">,</span> <span class="s1">&#39;filterbank&#39;</span><span class="p">]:</span>
            <span class="n">trace</span> <span class="o">=</span> <span class="n">get_trace</span><span class="p">(</span><span class="n">feature2</span><span class="p">,</span> <span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">kws_ssam</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span>
                          <span class="n">secondary_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">secondary_y</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                             <span class="n">tickfont</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">),</span>
                             <span class="n">title_font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">))</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">tickfont</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#4d4db3&#39;</span><span class="p">),</span>
                             <span class="n">title_font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#4d4db3&#39;</span><span class="p">),</span>
                             <span class="n">secondary_y</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trace</span>  <span class="o">=</span> <span class="n">get_trace</span><span class="p">(</span><span class="n">feature2</span><span class="p">,</span> <span class="s1">&#39;dimgray&#39;</span><span class="p">,</span> <span class="n">kws_ssam</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span>
                          <span class="n">secondary_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">secondary_y</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                             <span class="n">tickfont</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;dimgray&#39;</span><span class="p">),</span>
                             <span class="n">title_font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;dimgray&#39;</span><span class="p">))</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="s2">&quot;Features time series&quot;</span><span class="p">,</span>
            <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>
            <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="s1">&#39;xanchor&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span>
            <span class="s1">&#39;yanchor&#39;</span><span class="p">:</span> <span class="s1">&#39;top&#39;</span><span class="p">},</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">xaxis_rangeslider_visible</span><span class="o">=</span><span class="n">rangeslider</span><span class="p">)</span>

    <span class="c1"># Set y-axes titles</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;</span><span class="si">{}</span><span class="s1">&lt;/b&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">feature1</span><span class="o">.</span><span class="n">name</span><span class="p">)),</span> <span class="n">secondary_y</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;</span><span class="si">{}</span><span class="s1">&lt;/b&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">feature2</span><span class="o">.</span><span class="n">name</span><span class="p">)),</span> <span class="n">secondary_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">equal_yrange</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">feature1</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sonogram&#39;</span><span class="p">,</span> <span class="s1">&#39;filterbank&#39;</span><span class="p">,</span> <span class="s1">&#39;ssam&#39;</span><span class="p">]:</span>
            <span class="c1"># Smallest positive number</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">fig</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">y</span>
            <span class="n">y_min</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">y</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 
            <span class="n">y_max</span> <span class="o">=</span> <span class="n">fig</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">y_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                <span class="n">y_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">y_range</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="n">y_range</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">feature1</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span>
                        <span class="nb">float</span><span class="p">(</span><span class="n">feature2</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>
            <span class="n">y_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">feature1</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>
                        <span class="nb">float</span><span class="p">(</span><span class="n">feature2</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
            <span class="k">if</span> <span class="n">y_max</span> <span class="o">&gt;</span> <span class="n">y_min</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="zizou.visualise.plot_ssam_mpl" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_ssam_mpl</span><span class="p">(</span><span class="n">xdf</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dbscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Plot spectrogram data using matplotlib.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>xdf</code></b>
                  (<code>:class:`xarray.Dataset`</code>)
              –
              <div class="doc-md-description">
                <p>An xarray dataset as returned by :class:<code>zizou.ssam.SSAM</code></p>
              </div>
            </li>
            <li>
              <b><code>log</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>Logarithmic frequency axis if True, linear frequency axis otherwise.</p>
              </div>
            </li>
            <li>
              <b><code>axes</code></b>
                  (<code>:class:`matplotlib.axes.Axes`</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Plot into given axes.</p>
              </div>
            </li>
            <li>
              <b><code>dbscale</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>If True 10 * log10 of color values is taken, if False the sqrt is taken.</p>
              </div>
            </li>
            <li>
              <b><code>cmap</code></b>
                  (<code>:class:`matplotlib.colors.Colormap`</code>, default:
                      <code><span title="matplotlib.cm.viridis">viridis</span></code>
)
              –
              <div class="doc-md-description">
                <p>Specify a custom colormap instance.</p>
              </div>
            </li>
            <li>
              <b><code>clip</code></b>
                  (<code>[float, float]</code>, default:
                      <code>[0.0, 1.0]</code>
)
              –
              <div class="doc-md-description">
                <p>adjust colormap to clip at lower and/or upper end. The given percentages of the amplitude range (linear or logarithmic depending on option <code>dbscale</code>) are clipped.</p>
              </div>
            </li>
            <li>
              <b><code>figsize</code></b>
                  (<code>[float, float]  &gt;&gt;&gt; import numpy as np &gt;&gt;&gt; from zizou.ssam import SSAM, test_signal &gt;&gt;&gt; from zizou.visualise import plot_ssam_mpl &gt;&gt;&gt; ft = SSAM(interval=60, per_lap=.9, smooth=10,                   frequencies=np.arange(0., 25.1, .1),                   timestamp=&#39;start&#39;) &gt;&gt;&gt; _ = ft.compute(test_signal()) &gt;&gt;&gt; fig = plot_ssam_mpl(ft.feature)</code>, default:
                      <code>(12, 6)</code>
)
              –
              <div class="doc-md-description">
                <p>Horizontal and vertical dimension  of :class:<code>matplotlib.figure.Figure</code></p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>src/zizou/visualise.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_ssam_mpl</span><span class="p">(</span><span class="n">xdf</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dbscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">,</span>
                  <span class="n">clip</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot spectrogram data using matplotlib.</span>

<span class="sd">    :param xdf: An xarray dataset as returned by :class:`zizou.ssam.SSAM`</span>
<span class="sd">    :type xdf: :class:`xarray.Dataset`</span>
<span class="sd">    :param log: Logarithmic frequency axis if True, linear frequency axis</span>
<span class="sd">                otherwise.</span>
<span class="sd">    :type log: bool</span>
<span class="sd">    :param axes: Plot into given axes.</span>
<span class="sd">    :type axes: :class:`matplotlib.axes.Axes`</span>
<span class="sd">    :param dbscale: If True 10 * log10 of color values is taken, if False the</span>
<span class="sd">                    sqrt is taken.</span>
<span class="sd">    :type dbscale: bool</span>
<span class="sd">    :param cmap: Specify a custom colormap instance.</span>
<span class="sd">    :type cmap: :class:`matplotlib.colors.Colormap`</span>
<span class="sd">    :param clip: adjust colormap to clip at lower and/or upper end. The given</span>
<span class="sd">                 percentages of the amplitude range (linear or logarithmic depending</span>
<span class="sd">                 on option `dbscale`) are clipped.</span>
<span class="sd">    :type clip: [float, float]</span>
<span class="sd">    :param figsize: Horizontal and vertical dimension </span>
<span class="sd">                    of :class:`matplotlib.figure.Figure`</span>
<span class="sd">    :type figsize: [float, float]</span>

<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; from zizou.ssam import SSAM, test_signal</span>
<span class="sd">    &gt;&gt;&gt; from zizou.visualise import plot_ssam_mpl</span>
<span class="sd">    &gt;&gt;&gt; ft = SSAM(interval=60, per_lap=.9, smooth=10, \</span>
<span class="sd">                  frequencies=np.arange(0., 25.1, .1), \</span>
<span class="sd">                  timestamp=&#39;start&#39;)</span>
<span class="sd">    &gt;&gt;&gt; _ = ft.compute(test_signal())</span>
<span class="sd">    &gt;&gt;&gt; fig = plot_ssam_mpl(ft.feature)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="n">xdf</span><span class="o">.</span><span class="n">data</span>
    <span class="n">freq</span> <span class="o">=</span> <span class="n">xdf</span><span class="o">.</span><span class="n">frequency</span><span class="o">.</span><span class="n">data</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">xdf</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">data</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">to_pydatetime</span><span class="p">()</span>

    <span class="c1"># db scale and remove zero/offset for amplitude</span>
    <span class="k">if</span> <span class="n">dbscale</span><span class="p">:</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:])</span>
    <span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">clip</span>
    <span class="n">_range</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">spec</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
    <span class="n">vmin</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="n">vmin</span> <span class="o">*</span> <span class="n">_range</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="n">vmax</span> <span class="o">*</span> <span class="n">_range</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># ignore warnings due to NaNs</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">spec</span> <span class="o">&lt;</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">spec</span> <span class="o">&gt;</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">axes</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span>

    <span class="c1"># calculate half bin width</span>
    <span class="n">halfbin_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>
    <span class="n">halfbin_freq</span> <span class="o">=</span> <span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>

    <span class="c1"># argument None is not allowed for kwargs on matplotlib python 3.3</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
        <span class="c1"># pcolor expects one bin more at the right end</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">freq</span><span class="p">,</span> <span class="p">[</span><span class="n">freq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">halfbin_freq</span><span class="p">]))</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">time</span><span class="p">,</span> <span class="p">[</span><span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">halfbin_time</span><span class="p">]))</span>
        <span class="c1"># center bin</span>
        <span class="n">time</span> <span class="o">-=</span> <span class="n">halfbin_time</span>
        <span class="n">freq</span> <span class="o">-=</span> <span class="n">halfbin_freq</span>
        <span class="c1"># Log scaling for frequency values (y-axis)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="c1"># Plot times</span>
        <span class="n">ps</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># this method is much much faster!</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="c1"># center bin</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">halfbin_time</span><span class="p">,</span> <span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">halfbin_time</span><span class="p">,</span>
                  <span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">halfbin_freq</span><span class="p">,</span> <span class="n">freq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">halfbin_freq</span><span class="p">)</span>
        <span class="n">ps</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># set correct way of axis, whitespace before and after with window</span>
    <span class="c1"># length</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ax</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency [Hz]&#39;</span><span class="p">)</span>
    <span class="n">x_ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="n">xdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;starttime&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;timedelta64[s]&#39;</span><span class="p">)</span>
    <span class="n">x_tick_labels</span> <span class="o">=</span> <span class="n">x_ticks</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;datetime64[h]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">x_tick_labels</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="zizou.visualise.plot_ssam_plotly" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_ssam_plotly</span><span class="p">(</span><span class="n">xdf</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dbscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Ice_r&#39;</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">new_fig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">canvas_dim</span><span class="o">=</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Plot spectrogram data using matplotlib.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>data</code></b>
                  (<code>:class:`xarray.Dataset`</code>)
              –
              <div class="doc-md-description">
                <p>An xarray dataset as returned by :class:<code>zizou.ssam.SSAM</code></p>
              </div>
            </li>
            <li>
              <b><code>log</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>Logarithmic frequency axis if True, linear frequency axis otherwise.</p>
              </div>
            </li>
            <li>
              <b><code>dbscale</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>If True 10 * log10 of color values is taken, if False the sqrt is taken.</p>
              </div>
            </li>
            <li>
              <b><code>cmap</code></b>
                  (<code>list</code>, default:
                      <code>&#39;Ice_r&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>Specify a custom colormap instance from <code>plotly.colors.sequential</code>.</p>
              </div>
            </li>
            <li>
              <b><code>clip</code></b>
                  (<code>[float, float]</code>, default:
                      <code>[0.0, 1.0]</code>
)
              –
              <div class="doc-md-description">
                <p>adjust colormap to clip at lower and/or upper end. The given percentages of the amplitude range (linear or logarithmic depending on option <code>dbscale</code>) are clipped.</p>
              </div>
            </li>
            <li>
              <b><code>new_fig</code></b>
              –
              <div class="doc-md-description">
                <p>Whether to return a figure or just a graph object.</p>
              </div>
            </li>
            <li>
              <b><code>max_tpoints</code></b>
                  (<code>int  &gt;&gt;&gt; import numpy as np &gt;&gt;&gt; from zizou.ssam import SSAM, test_signal &gt;&gt;&gt; from zizou.visualise import plot_ssam_plotly &gt;&gt;&gt; ft = SSAM(interval=60, per_lap=.9, smooth=10,                   frequencies=np.arange(0., 25.1, .1),                   timestamp=&#39;start&#39;) &gt;&gt;&gt; _ = ft.compute(test_signal()) &gt;&gt;&gt; fig = plot_ssam_plotly(ft.feature)</code>)
              –
              <div class="doc-md-description">
                <p>Maximum number of time intervals. If the datasets exceeds that number it will be resampled to max_tpoints.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>src/zizou/visualise.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_ssam_plotly</span><span class="p">(</span><span class="n">xdf</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dbscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Ice_r&#39;</span><span class="p">,</span>
                     <span class="n">clip</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">new_fig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">canvas_dim</span><span class="o">=</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="mi">400</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot spectrogram data using matplotlib.</span>

<span class="sd">    :param data: An xarray dataset as returned by :class:`zizou.ssam.SSAM`</span>
<span class="sd">    :type data: :class:`xarray.Dataset`</span>
<span class="sd">    :param log: Logarithmic frequency axis if True, linear frequency axis</span>
<span class="sd">                otherwise.</span>
<span class="sd">    :type log: bool</span>
<span class="sd">    :param dbscale: If True 10 * log10 of color values is taken, if False the</span>
<span class="sd">                    sqrt is taken.</span>
<span class="sd">    :type dbscale: bool</span>
<span class="sd">    :param cmap: Specify a custom colormap instance from</span>
<span class="sd">                 `plotly.colors.sequential`.</span>
<span class="sd">    :type cmap: list</span>
<span class="sd">    :param clip: adjust colormap to clip at lower and/or upper end. The given</span>
<span class="sd">                 percentages of the amplitude range (linear or logarithmic</span>
<span class="sd">                 depending on option `dbscale`) are clipped.</span>
<span class="sd">    :type clip: [float, float]</span>
<span class="sd">    :param new_fig: Whether to return a figure or just a graph object.</span>
<span class="sd">    :type new_flag: boolean</span>
<span class="sd">    :param max_tpoints: Maximum number of time intervals. If the datasets</span>
<span class="sd">                        exceeds that number it will be resampled</span>
<span class="sd">                        to max_tpoints.</span>
<span class="sd">    :type max_tpoints: int</span>

<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; from zizou.ssam import SSAM, test_signal</span>
<span class="sd">    &gt;&gt;&gt; from zizou.visualise import plot_ssam_plotly</span>
<span class="sd">    &gt;&gt;&gt; ft = SSAM(interval=60, per_lap=.9, smooth=10, \</span>
<span class="sd">                  frequencies=np.arange(0., 25.1, .1), \</span>
<span class="sd">                  timestamp=&#39;start&#39;)</span>
<span class="sd">    &gt;&gt;&gt; _ = ft.compute(test_signal())</span>
<span class="sd">    &gt;&gt;&gt; fig = plot_ssam_plotly(ft.feature)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">clip</span>
    <span class="n">_range</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">xdf</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">xdf</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
    <span class="n">vmin</span> <span class="o">=</span> <span class="n">xdf</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="n">vmin</span> <span class="o">*</span> <span class="n">_range</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="n">xdf</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="n">vmax</span> <span class="o">*</span> <span class="n">_range</span>

    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
        <span class="n">xdf</span> <span class="o">=</span> <span class="n">xdf</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xdf</span> <span class="o">&gt;</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmin</span><span class="p">)</span>
        <span class="n">xdf</span> <span class="o">=</span> <span class="n">xdf</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xdf</span> <span class="o">&lt;</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dbscale</span><span class="p">:</span>
        <span class="n">xdf</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">xdf</span><span class="p">)</span>

    <span class="n">freq_dim</span> <span class="o">=</span> <span class="n">xdf</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">xdf</span><span class="p">[</span><span class="n">freq_dim</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">xdf</span><span class="p">[{</span><span class="n">freq_dim</span><span class="p">:</span><span class="mi">0</span><span class="p">}]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">xdf</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="n">freq</span> <span class="o">=</span> <span class="n">xdf</span><span class="p">[</span><span class="n">freq_dim</span><span class="p">]</span>
    <span class="n">dates</span> <span class="o">=</span> <span class="n">xdf</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">]</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="n">xdf</span><span class="o">.</span><span class="n">data</span>
    <span class="k">if</span> <span class="n">canvas_dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="n">date2num</span><span class="p">(</span><span class="n">xdf</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;datetime64[us]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">datetime</span><span class="p">),</span>
                         <span class="n">units</span><span class="o">=</span><span class="s1">&#39;hours since 1970-01-01 00:00:00.0&#39;</span><span class="p">,</span>
                         <span class="n">calendar</span><span class="o">=</span><span class="s1">&#39;gregorian&#39;</span><span class="p">)</span>
        <span class="n">xdf</span> <span class="o">=</span> <span class="n">xdf</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;datetime&#39;</span><span class="p">:</span> <span class="n">dates</span><span class="p">})</span>
        <span class="n">cvs</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">Canvas</span><span class="p">(</span><span class="n">plot_width</span><span class="o">=</span><span class="n">canvas_dim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">plot_height</span><span class="o">=</span><span class="n">canvas_dim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">agg</span> <span class="o">=</span> <span class="n">cvs</span><span class="o">.</span><span class="n">raster</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">xdf</span><span class="p">)</span>
        <span class="n">freq</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="n">agg</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">freq_dim</span><span class="p">],</span> <span class="n">agg</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">],</span> <span class="n">agg</span><span class="o">.</span><span class="n">data</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="n">num2date</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;hours since 1970-01-01 00:00:00.0&#39;</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="s1">&#39;gregorian&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">new_fig</span><span class="p">:</span> 
        <span class="k">return</span> <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span>
            <span class="n">z</span><span class="o">=</span><span class="n">spec</span><span class="p">,</span>
            <span class="n">x</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">freq</span><span class="p">,</span>
            <span class="n">colorscale</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span>
            <span class="n">z</span><span class="o">=</span><span class="n">spec</span><span class="p">,</span>
            <span class="n">x</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">freq</span><span class="p">,</span>
            <span class="n">colorscale</span><span class="o">=</span><span class="n">cmap</span><span class="p">))</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">xaxis_nticks</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
        <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;Frequency [Hz]&#39;</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="zizou.feature_base"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="zizou.anomaly_base"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="zizou.anomaly_base.AnomalyDetectionBaseClass" class="doc doc-heading">
            <code>AnomalyDetectionBaseClass</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


              <details class="quote">
                <summary>Source code in <code>src/zizou/anomaly_base.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AnomalyDetectionBaseClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">stacks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transforms</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">features</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stacks</span> <span class="o">=</span> <span class="n">stacks</span> <span class="k">if</span> <span class="n">stacks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span> <span class="o">=</span> <span class="n">transforms</span> <span class="k">if</span> <span class="n">transforms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">starttime</span><span class="p">,</span> <span class="n">endtime</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Train the model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&#39;training&#39; is not implemented yet&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">infer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">starttime</span><span class="p">,</span> <span class="n">endtime</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use the model to infer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&#39;inference&#39; is not implemented yet&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_model_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write principal components or </span>
<span class="sd">        model weights to file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&#39;write_model_parameters&#39; is not implemented yet&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read_model_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read principal components or </span>
<span class="sd">        model weights from file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&#39;read_model_parameters&#39; is not implemented yet&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_hyperparameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store things like random seed,</span>
<span class="sd">        learning rate, number of principal</span>
<span class="sd">        components etc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&#39;write_hyperparameters&#39; is not implemented yet&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">compute_anomaly_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A scalar value between 0 and 1 indicating</span>
<span class="sd">        the degree of anomaly (1=most anomaluous).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&#39;compute_anomaly_index&#39; is not implemented yet&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">featurefile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">feats</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataarray</span><span class="p">(</span><span class="n">featurefile</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">_f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading feature </span><span class="si">{</span><span class="n">_f</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span> 
                <span class="n">feat</span> <span class="o">=</span> <span class="n">data</span><span class="p">(</span><span class="n">_f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stacks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_f</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">_f</span> <span class="o">==</span> <span class="s1">&#39;sonogram&#39;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">feat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                        <span class="n">da</span> <span class="o">=</span> <span class="n">feat</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">reset_coords</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sonofrequency&#39;</span><span class="p">],</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">feat_name</span> <span class="o">=</span> <span class="s1">&#39;sonogram_</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                        <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">feat_name</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_f</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
                        <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">feat</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span>

            <span class="n">feats</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">features</span><span class="p">)</span><span class="o">.</span><span class="n">to_array</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">featurefile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">feats</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">featurefile</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">feats</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="s1">&#39;datetime&#39;</span><span class="p">,</span> <span class="s1">&#39;variable&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="zizou.anomaly_base.AnomalyDetectionBaseClass.compute_anomaly_index" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_anomaly_index</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>A scalar value between 0 and 1 indicating
the degree of anomaly (1=most anomaluous).</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/anomaly_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute_anomaly_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A scalar value between 0 and 1 indicating</span>
<span class="sd">    the degree of anomaly (1=most anomaluous).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&#39;compute_anomaly_index&#39; is not implemented yet&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zizou.anomaly_base.AnomalyDetectionBaseClass.fit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">starttime</span><span class="p">,</span> <span class="n">endtime</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Train the model.</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/anomaly_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">starttime</span><span class="p">,</span> <span class="n">endtime</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Train the model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&#39;training&#39; is not implemented yet&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zizou.anomaly_base.AnomalyDetectionBaseClass.infer" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">infer</span><span class="p">(</span><span class="n">starttime</span><span class="p">,</span> <span class="n">endtime</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Use the model to infer.</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/anomaly_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">infer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">starttime</span><span class="p">,</span> <span class="n">endtime</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use the model to infer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&#39;inference&#39; is not implemented yet&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zizou.anomaly_base.AnomalyDetectionBaseClass.read_model_parameters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_model_parameters</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Read principal components or 
model weights from file</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/anomaly_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_model_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read principal components or </span>
<span class="sd">    model weights from file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&#39;read_model_parameters&#39; is not implemented yet&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zizou.anomaly_base.AnomalyDetectionBaseClass.write_hyperparameters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_hyperparameters</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Store things like random seed,
learning rate, number of principal
components etc.</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/anomaly_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_hyperparameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Store things like random seed,</span>
<span class="sd">    learning rate, number of principal</span>
<span class="sd">    components etc.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&#39;write_hyperparameters&#39; is not implemented yet&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zizou.anomaly_base.AnomalyDetectionBaseClass.write_model_parameters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_model_parameters</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Write principal components or 
model weights to file</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/anomaly_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_model_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write principal components or </span>
<span class="sd">    model weights to file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&#39;write_model_parameters&#39; is not implemented yet&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="zizou.util"></a>
    <div class="doc doc-contents first">

      <p>Functionality common to several modules.</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="zizou.util.apply_freq_filter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_freq_filter</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">filtertype</span><span class="p">,</span> <span class="n">filterfreq</span><span class="p">,</span> <span class="n">corners</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">zerophase</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Apply frequency filter to seismic data.</p>
<p>Filter parameters are taken from instance attributes
<code>filtertype</code> and <code>filterfreq</code>.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>data</code></b>
                  (<code>:class:`obspy.core.trace.Trace` | :class:``obspy.core.stream.Stream`</code>)
              –
              <div class="doc-md-description">
                <p>The seismic data to be filtered.</p>
              </div>
            </li>
            <li>
              <b><code>corners</code></b>
                  (<code>int</code>, default:
                      <code>4</code>
)
              –
              <div class="doc-md-description">
                <p>Filter corners / order, defaults to 4.</p>
              </div>
            </li>
            <li>
              <b><code>zerophase</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>If True, apply filter once forwards and once backwards. Defaults to False.</p>
              </div>
            </li>
            <li>
              <b><code>options</code></b>
              –
              <div class="doc-md-description">
                <p>Passed to underlying obspy filter methods.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>src/zizou/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">apply_freq_filter</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">filtertype</span><span class="p">,</span> <span class="n">filterfreq</span><span class="p">,</span> <span class="n">corners</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">zerophase</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply frequency filter to seismic data.</span>

<span class="sd">    Filter parameters are taken from instance attributes</span>
<span class="sd">    `filtertype` and `filterfreq`.</span>

<span class="sd">    :param data: The seismic data to be filtered.</span>
<span class="sd">    :type data: :class:`obspy.core.trace.Trace` or</span>
<span class="sd">        :class:``obspy.core.stream.Stream`</span>
<span class="sd">    :param corners: Filter corners / order, defaults to 4.</span>
<span class="sd">    :type corners: int</span>
<span class="sd">    :param zerophase: If True, apply filter once forwards and once</span>
<span class="sd">        backwards. Defaults to False.</span>
<span class="sd">    :type zerophase: bool</span>
<span class="sd">    :param options: Passed to underlying obspy filter methods.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f_min</span><span class="p">,</span> <span class="n">f_max</span> <span class="o">=</span> <span class="n">filterfreq</span>
    <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;zerophase&quot;</span><span class="p">:</span> <span class="n">zerophase</span><span class="p">,</span> <span class="s2">&quot;corners&quot;</span><span class="p">:</span> <span class="n">corners</span><span class="p">})</span>

    <span class="k">if</span> <span class="n">filtertype</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;lp&quot;</span><span class="p">,</span> <span class="s2">&quot;lowpass&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">f_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Define upper frequency cutoff for low-pass filter.&quot;</span>
            <span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;lowpass&quot;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">f_max</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">filtertype</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;hp&quot;</span><span class="p">,</span> <span class="s2">&quot;highpass&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">f_min</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Define lower frequency cutoff for high-pass filter.&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;highpass&quot;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">f_min</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">filtertype</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;bp&quot;</span><span class="p">,</span> <span class="s2">&quot;bandpass&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">f_min</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">f_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Define upper and lower requency cutoff for band-pass filter.&quot;</span>
            <span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;bandpass&quot;</span><span class="p">,</span> <span class="n">freqmin</span><span class="o">=</span><span class="n">f_min</span><span class="p">,</span> <span class="n">freqmax</span><span class="o">=</span><span class="n">f_max</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">filtertype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unrecognised filtertype &#39;</span><span class="si">{</span><span class="n">filtertype</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="zizou.util.apply_hanning" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_hanning</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">return_window</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Apply a hanning window to the given 1D or 2D array along
the given axis.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>x</code></b>
                  (<code>:class:`numpy.ndarray`</code>)
              –
              <div class="doc-md-description">
                <p>1-D or 2-D array or sequence containing the data</p>
              </div>
            </li>
            <li>
              <b><code>return_window</code></b>
                  (<code>bool</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>If true, also return the 1D values of the window that was applied.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              –
              <div class="doc-md-description">
                <p><strong>wtr[, wvals]</strong> input multiplied with the hanning window function, hanning window function</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>src/zizou/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">apply_hanning</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">return_window</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply a hanning window to the given 1D or 2D array along</span>
<span class="sd">    the given axis.</span>

<span class="sd">    :param x: 1-D or 2-D array or sequence containing the data</span>
<span class="sd">    :type x: :class:`numpy.ndarray`</span>
<span class="sd">    :param return_window: If true, also return the 1D values of the window</span>
<span class="sd">                          that was applied.</span>
<span class="sd">    :type return_window: bool</span>
<span class="sd">    :return: **wtr[, wvals]** input multiplied with the hanning</span>
<span class="sd">             window function, hanning window function</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;only 1D or 2D arrays can be used&#39;</span><span class="p">)</span>

    <span class="n">xshapetarg</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">windowVals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hanning</span><span class="p">(</span><span class="n">xshapetarg</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">xshapetarg</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">return_window</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">windowVals</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="n">windowVals</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">windowVals</span> <span class="o">*</span> <span class="n">x</span>

    <span class="n">windowVals</span> <span class="o">=</span> <span class="n">windowVals</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">return_window</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">windowVals</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="n">windowVals</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">windowVals</span> <span class="o">*</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="zizou.util.demean" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">demean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Return x minus the mean(x).</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>x</code></b>
                  (<code>:class:`~numpy.ndarray`</code>)
              –
              <div class="doc-md-description">
                <p>array or sequence containing the data can have any dimensionality</p>
              </div>
            </li>
            <li>
              <b><code>axis</code></b>
                  (<code>int</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The axis along which to take the mean. See numpy.mean for a description of this argument.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>:class:`~numpy.ndarray`</code>
              –
              <div class="doc-md-description">
                <p>input minus the arithmetic mean along the specified axis.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>src/zizou/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">demean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return x minus the mean(x).</span>

<span class="sd">    :param x: array or sequence containing the data can</span>
<span class="sd">              have any dimensionality</span>
<span class="sd">    :type x: :class:`~numpy.ndarray`</span>
<span class="sd">    :param axis: The axis along which to take the mean. See numpy.mean</span>
<span class="sd">                 for a description of this argument.</span>
<span class="sd">    :type axis: int</span>
<span class="sd">    :return: input minus the arithmetic mean along the specified axis.</span>
<span class="sd">    :rtype: :class:`~numpy.ndarray`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">axis</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;axis(=</span><span class="si">%s</span><span class="s1">) out of bounds&#39;</span> <span class="o">%</span> <span class="n">axis</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="zizou.util.generate_test_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_test_data</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ndays</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">nfreqs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">tstart</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">(),</span> <span class="n">feature_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">freq_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Generate a 1D or 2D feature for testing.</p>

            <details class="quote">
              <summary>Source code in <code>src/zizou/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_test_data</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ndays</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">nfreqs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                       <span class="n">tstart</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">(),</span>
                       <span class="n">feature_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">freq_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a 1D or 2D feature for testing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">dim</span> <span class="o">&lt;</span> <span class="mi">3</span>
    <span class="k">assert</span> <span class="n">dim</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="n">nints</span> <span class="o">=</span> <span class="n">ndays</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">*</span> <span class="mi">24</span>
    <span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">tstart</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;10min&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">nints</span><span class="p">)</span>
    <span class="n">rs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
    <span class="c1"># Random walk as test signal</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">8.</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">))))</span>
    <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">nfreqs</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="c1"># Add 10% NaNs</span>
    <span class="n">idx_nan</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nints</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.1</span><span class="o">*</span><span class="n">nints</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="n">idx_nan</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">if</span> <span class="n">feature_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">feature_name</span> <span class="o">=</span> <span class="s1">&#39;rsam&#39;</span>
        <span class="n">xrd</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">({</span><span class="n">feature_name</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">dates</span><span class="p">],</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">])})</span>
    <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[:,</span> <span class="n">idx_nan</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nfreqs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">feature_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">feature_name</span> <span class="o">=</span> <span class="s1">&#39;ssam&#39;</span>
        <span class="k">if</span> <span class="n">freq_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">freq_name</span> <span class="o">=</span> <span class="s1">&#39;frequency&#39;</span>
        <span class="n">xrd</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">({</span><span class="n">feature_name</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">freqs</span><span class="p">,</span> <span class="n">dates</span><span class="p">],</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="n">freq_name</span><span class="p">,</span> <span class="s1">&#39;datetime&#39;</span><span class="p">])})</span>
    <span class="n">xrd</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;starttime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
    <span class="n">xrd</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;endtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
    <span class="n">xrd</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;MDR&#39;</span>
    <span class="k">return</span> <span class="n">xrd</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="zizou.util.round_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">round_time</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">interval</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Find closest multiple of interval to time.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>time</code></b>
                  (<code>:class:`obspy.UTCDateTime`</code>)
              –
              <div class="doc-md-description">
                <p>Time to round</p>
              </div>
            </li>
            <li>
              <b><code>interval</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>Interval length in seconds</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>:class:`obspy.UtCDateTime`</code>
              –
              <div class="doc-md-description">
                <p>The new time that is a multiple of interval</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>src/zizou/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">round_time</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">interval</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find closest multiple of interval to time.</span>

<span class="sd">    :param time: Time to round</span>
<span class="sd">    :type time: :class:`obspy.UTCDateTime`</span>
<span class="sd">    :param interval: Interval length in seconds</span>
<span class="sd">    :type interval: int</span>
<span class="sd">    :returns: The new time that is a multiple of interval</span>
<span class="sd">    :rtype: :class:`obspy.UtCDateTime`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">interval</span><span class="p">)</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">%</span> <span class="n">interval</span>
    <span class="n">ntime</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">interval</span><span class="p">)</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">-</span> <span class="n">tmp</span>
    <span class="k">return</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="n">ntime</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="zizou.util.stride_windows" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">stride_windows</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">noverlap</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Get all windows of x with length n as a single array,
using strides to avoid data duplication.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>x</code></b>
                  (<code>:class:`~numpy.ndarray`</code>)
              –
              <div class="doc-md-description">
                <p>1D array or sequence containing the data.</p>
              </div>
            </li>
            <li>
              <b><code>n</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>The number of data points in each window.</p>
              </div>
            </li>
            <li>
              <b><code>noverlap</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>The overlap between adjacent windows. Default is 0 (no overlap)</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>:class:`~numpy.ndarray`</code>
              –
              <div class="doc-md-description">
                <p>Array with the windowed data in columns.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>src/zizou/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">stride_windows</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">noverlap</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all windows of x with length n as a single array,</span>
<span class="sd">    using strides to avoid data duplication.</span>

<span class="sd">    :param x: 1D array or sequence containing the data.</span>
<span class="sd">    :type x: :class:`~numpy.ndarray`</span>
<span class="sd">    :param n: The number of data points in each window.</span>
<span class="sd">    :type n: int</span>
<span class="sd">    :param noverlap: The overlap between adjacent windows.</span>
<span class="sd">                     Default is 0 (no overlap)</span>
<span class="sd">    :type noverlap: int</span>
<span class="sd">    :return: Array with the windowed data in columns.</span>
<span class="sd">    :rtype: :class:`~numpy.ndarray`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">noverlap</span> <span class="o">&gt;=</span> <span class="n">n</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;noverlap must be less than n&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;n cannot be less than 1&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">noverlap</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;n cannot be greater than the length of x&#39;</span><span class="p">)</span>

    <span class="c1"># np.lib.stride_tricks.as_strided easily leads to memory corruption for</span>
    <span class="c1"># non integer shape and strides, i.e. noverlap or n. See #3845.</span>
    <span class="n">noverlap</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">noverlap</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    <span class="n">step</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">noverlap</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">noverlap</span><span class="p">)</span> <span class="o">//</span> <span class="n">step</span><span class="p">)</span>
    <span class="n">strides</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">strides</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">step</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">strides</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">stride_tricks</span><span class="o">.</span><span class="n">as_strided</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="n">strides</span><span class="p">,</span>
                                           <span class="n">writeable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="zizou.util.test_signal" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_signal</span><span class="p">(</span><span class="n">nsec</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span> <span class="n">sampling_rate</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">frequencies</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="n">amplitudes</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">],</span> <span class="n">phases</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">],</span> <span class="n">offsets</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">starttime</span><span class="o">=</span><span class="n">UTCDateTime</span><span class="p">(</span><span class="mi">1970</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">gaps</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">noise_std</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">sinusoid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">addchirp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">network</span><span class="o">=</span><span class="s1">&#39;NZ&#39;</span><span class="p">,</span> <span class="n">station</span><span class="o">=</span><span class="s1">&#39;BLUB&#39;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="s1">&#39;HHZ&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Produce a test signal for which we know where the peaks
are in the spectrogram.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>nsec</code></b>
                  (<code>int</code>, default:
                      <code>3600</code>
)
              –
              <div class="doc-md-description">
                <p>Length of the trace in seconds.</p>
              </div>
            </li>
            <li>
              <b><code>sampling_rate</code></b>
                  (<code>float</code>, default:
                      <code>100.0</code>
)
              –
              <div class="doc-md-description">
                <p>Sampling rate of the signal in Hz.</p>
              </div>
            </li>
            <li>
              <b><code>starttime</code></b>
                  (<code>:class:`~obspy.UTCDateTime`</code>, default:
                      <code><span title="obspy.UTCDateTime">UTCDateTime</span>(1970, 1, 1)</code>
)
              –
              <div class="doc-md-description">
                <p>Starttime of the trace.</p>
              </div>
            </li>
            <li>
              <b><code>gaps</code></b>
                  (<code>boolean</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>If 'True' add gaps to the test signal.</p>
              </div>
            </li>
            <li>
              <b><code>noise_std</code></b>
                  (<code>float</code>, default:
                      <code>0.5</code>
)
              –
              <div class="doc-md-description">
                <p>Standard deviation of the noise.</p>
              </div>
            </li>
            <li>
              <b><code>sinusoid</code></b>
                  (<code>bool</code>, default:
                      <code>True</code>
)
              –
              <div class="doc-md-description">
                <p>Add a signal with a sinusoidal frequency change.</p>
              </div>
            </li>
            <li>
              <b><code>station</code></b>
                  (<code>str</code>, default:
                      <code>&#39;BLUB&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>Station name of the returned trace.</p>
              </div>
            </li>
            <li>
              <b><code>location</code></b>
                  (<code>str</code>, default:
                      <code>&#39;&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>Location of the returned trace.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>:class:`~obspy.Trace`</code>
              –
              <div class="doc-md-description">
                <p>Time series of test data</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>src/zizou/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">test_signal</span><span class="p">(</span><span class="n">nsec</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span> <span class="n">sampling_rate</span><span class="o">=</span><span class="mf">100.</span><span class="p">,</span>
                <span class="n">frequencies</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span>
                <span class="n">amplitudes</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">],</span>
                <span class="n">phases</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">],</span>
                <span class="n">offsets</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                <span class="n">starttime</span><span class="o">=</span><span class="n">UTCDateTime</span><span class="p">(</span><span class="mi">1970</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">gaps</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="n">noise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">noise_std</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span>
                <span class="n">sinusoid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">addchirp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">network</span><span class="o">=</span><span class="s1">&#39;NZ&#39;</span><span class="p">,</span> <span class="n">station</span><span class="o">=</span><span class="s1">&#39;BLUB&#39;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="n">channel</span><span class="o">=</span><span class="s1">&#39;HHZ&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Produce a test signal for which we know where the peaks</span>
<span class="sd">    are in the spectrogram.</span>

<span class="sd">    :param nsec: Length of the trace in seconds.</span>
<span class="sd">    :type nsec: int</span>
<span class="sd">    :param sampling_rate: Sampling rate of the signal in Hz.</span>
<span class="sd">    :type sampling_rate: float</span>
<span class="sd">    :param starttime: Starttime of the trace.</span>
<span class="sd">    :type starttime: :class:`~obspy.UTCDateTime`</span>
<span class="sd">    :param gaps: If &#39;True&#39; add gaps to the test signal.</span>
<span class="sd">    :type gaps: boolean</span>
<span class="sd">    :param noise_std: Standard deviation of the noise.</span>
<span class="sd">    :type noise_std: float</span>
<span class="sd">    :param sinusoid: Add a signal with a sinusoidal frequency change.</span>
<span class="sd">    :type sinusoid: bool</span>
<span class="sd">    :param station: Station name of the returned trace.</span>
<span class="sd">    :type station: str</span>
<span class="sd">    :param location: Location of the returned trace.</span>
<span class="sd">    :type location: str</span>
<span class="sd">    :return: Time series of test data</span>
<span class="sd">    :rtype: :class:`~obspy.Trace`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nsec</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">sampling_rate</span><span class="p">)</span>
    <span class="n">signals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Some constant signals with different phases</span>
    <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">ph</span><span class="p">,</span> <span class="n">dt</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">amplitudes</span><span class="p">,</span> <span class="n">phases</span><span class="p">,</span> <span class="n">offsets</span><span class="p">):</span>
        <span class="n">_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">dt_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="n">sampling_rate</span><span class="p">)</span>
        <span class="n">_s</span><span class="p">[</span><span class="n">dt_idx</span><span class="p">:]</span><span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">f</span> <span class="o">*</span> <span class="n">t</span><span class="p">[</span><span class="n">dt_idx</span><span class="p">:]</span> <span class="o">+</span> <span class="n">ph</span><span class="p">)</span>
        <span class="n">signals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_s</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">addchirp</span><span class="p">:</span>
        <span class="c1"># Frequency-swept signals</span>
        <span class="c1"># Chirp</span>
        <span class="n">s4</span> <span class="o">=</span> <span class="mf">0.8</span> <span class="o">*</span> <span class="n">chirp</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">15</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;quadratic&#39;</span><span class="p">)</span>
        <span class="n">signals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s4</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sinusoid</span><span class="p">:</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span>
            <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">k</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">nsec</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">M</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vals</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">s5</span> <span class="o">=</span> <span class="n">sweep_poly</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="n">signals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s5</span><span class="p">)</span>

    <span class="c1"># add some noise</span>
    <span class="k">if</span> <span class="n">noise</span><span class="p">:</span>
        <span class="n">rs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
        <span class="n">noise</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">noise_std</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">signals</span><span class="p">:</span>
            <span class="n">noise</span> <span class="o">+=</span> <span class="n">s</span>
        <span class="n">signal</span> <span class="o">=</span> <span class="n">noise</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">signal</span> <span class="o">=</span> <span class="n">signals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">signals</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">signal</span> <span class="o">+=</span> <span class="n">s</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;network&#39;</span><span class="p">:</span> <span class="n">network</span><span class="p">,</span> <span class="s1">&#39;station&#39;</span><span class="p">:</span> <span class="n">station</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span>
             <span class="s1">&#39;channel&#39;</span><span class="p">:</span> <span class="n">channel</span><span class="p">,</span> <span class="s1">&#39;npts&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">signal</span><span class="p">),</span>
             <span class="s1">&#39;sampling_rate&#39;</span><span class="p">:</span> <span class="n">sampling_rate</span><span class="p">,</span>
             <span class="s1">&#39;mseed&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;dataquality&#39;</span><span class="p">:</span> <span class="s1">&#39;D&#39;</span><span class="p">}}</span>
    <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;starttime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">starttime</span>
    <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;endtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;starttime&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">nsec</span>
    <span class="k">if</span> <span class="n">gaps</span><span class="p">:</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.27</span><span class="p">,</span> <span class="mf">0.33</span><span class="p">)</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.69</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">)</span>
        <span class="n">p3</span> <span class="o">=</span> <span class="p">(</span><span class="mf">.95</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pmin</span><span class="p">,</span> <span class="n">pmax</span> <span class="ow">in</span> <span class="p">[</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">]:</span>
            <span class="n">idx0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pmin</span> <span class="o">*</span> <span class="n">nsec</span> <span class="o">*</span> <span class="n">sampling_rate</span><span class="p">)</span>
            <span class="n">idx1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pmax</span> <span class="o">*</span> <span class="n">nsec</span> <span class="o">*</span> <span class="n">sampling_rate</span><span class="p">)</span>
            <span class="n">signal</span><span class="p">[</span><span class="n">idx0</span><span class="p">:</span><span class="n">idx1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">return</span> <span class="n">Trace</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">signal</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">stats</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="zizou.util.trace_window_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">trace_window_data</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">window_len</span><span class="p">,</span> <span class="n">min_len</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Subdivide an <code>obspy.core.trace.Trace</code> into windows of <code>interval</code>
length and iterate over windows.</p>
<p>:yield: A trace data windowNone</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>trace</code></b>
                  (<code>:class:`obspy.core.trace.Trace`</code>)
              –
              <div class="doc-md-description">
                <p>The data to be windowed.</p>
              </div>
            </li>
            <li>
              <b><code>window_len</code></b>
                  (<code>float</code>)
              –
              <div class="doc-md-description">
                <p>The window length in seconds.</p>
              </div>
            </li>
            <li>
              <b><code>min_len</code></b>
                  (<code>float, optional</code>, default:
                      <code>0.8</code>
)
              –
              <div class="doc-md-description">
                <p>Windows with length &lt; <code>min_length * window_len</code> are skipped, defaults to 0.8</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>src/zizou/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">trace_window_data</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">window_len</span><span class="p">,</span> <span class="n">min_len</span><span class="o">=</span><span class="mf">0.8</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Subdivide an `obspy.core.trace.Trace` into windows of `interval`</span>
<span class="sd">    length and iterate over windows.</span>

<span class="sd">    :param trace: The data to be windowed.</span>
<span class="sd">    :type trace: :class:`obspy.core.trace.Trace`</span>
<span class="sd">    :param window_len: The window length in seconds.</span>
<span class="sd">    :type window_len: float</span>
<span class="sd">    :param min_len: Windows with length &lt; `min_length * window_len` are</span>
<span class="sd">        skipped, defaults to 0.8</span>
<span class="sd">    :type min_len: float, optional</span>
<span class="sd">    :yield: A trace data windowNone</span>
<span class="sd">    :rtype: `obspy.core.trace.Trace`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span> <span class="ow">in</span> <span class="n">trace_window_times</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">window_len</span><span class="p">,</span> <span class="n">min_len</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">trace</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">nearest_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="zizou.util.trace_window_times" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">trace_window_times</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">window_len</span><span class="p">,</span> <span class="n">min_len</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Subdivide an <code>obspy.core.trace.Trace</code> into windows of <code>window_len</code>
length and iterate over window start &amp; end times.</p>
<p>:yield: The window start &amp; end times</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>trace</code></b>
                  (<code>:class:`obspy.core.trace.Trace`</code>)
              –
              <div class="doc-md-description">
                <p>The data to be windowed.</p>
              </div>
            </li>
            <li>
              <b><code>window_len</code></b>
                  (<code>float</code>)
              –
              <div class="doc-md-description">
                <p>The window length in seconds.</p>
              </div>
            </li>
            <li>
              <b><code>min_len</code></b>
                  (<code>float, optional</code>, default:
                      <code>0.8</code>
)
              –
              <div class="doc-md-description">
                <p>Windows with length &lt; <code>min_len * window_len</code> are skipped, defaults to 0.8</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>src/zizou/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">trace_window_times</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">window_len</span><span class="p">,</span> <span class="n">min_len</span><span class="o">=</span><span class="mf">0.8</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Subdivide an `obspy.core.trace.Trace` into windows of `window_len`</span>
<span class="sd">    length and iterate over window start &amp; end times.</span>

<span class="sd">    :param trace: The data to be windowed.</span>
<span class="sd">    :type trace: :class:`obspy.core.trace.Trace`</span>
<span class="sd">    :param window_len: The window length in seconds.</span>
<span class="sd">    :type window_len: float</span>
<span class="sd">    :param min_len: Windows with length &lt; `min_len * window_len` are</span>
<span class="sd">        skipped, defaults to 0.8</span>
<span class="sd">    :type min_len: float, optional</span>
<span class="sd">    :yield: The window start &amp; end times</span>
<span class="sd">    :rtype: :class:`obspy.core.utcdatetime.UTCDateTime`,</span>
<span class="sd">        :class:`obspy.core.utcdatetime.UTCDateTime`,</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">min_len</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">min_len</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">min_len</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;min_len &lt;= 0 or &gt; 1.&quot;</span><span class="p">)</span>
    <span class="n">min_len</span> <span class="o">=</span> <span class="n">min_len</span> <span class="o">*</span> <span class="n">window_len</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">endtime</span> <span class="o">-</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_len</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;window length &gt; total trace data.&quot;</span><span class="p">)</span>

    <span class="n">t0</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span>
    <span class="k">while</span> <span class="n">t0</span> <span class="o">&lt;</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">endtime</span><span class="p">:</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="n">window_len</span><span class="p">,</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">endtime</span><span class="p">)</span>
        <span class="n">this_window_len</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span>
        <span class="k">if</span> <span class="n">this_window_len</span> <span class="o">&gt;=</span> <span class="n">min_len</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">this_window_len</span> <span class="o">&lt;</span> <span class="n">window_len</span><span class="p">:</span>
                <span class="n">t0</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">-</span> <span class="n">window_len</span>
            <span class="k">yield</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span>

        <span class="n">t0</span> <span class="o">+=</span> <span class="n">window_len</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="zizou.util.window_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">window_array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">nwin</span><span class="p">,</span> <span class="n">noverlap</span><span class="p">,</span> <span class="n">remove_mean</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">taper</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">padval</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_window</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Take a 1-D numpy array and devide it into (overlapping)
windows.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>x</code></b>
                  (<code>:class:`~numpy.ndarray`</code>)
              –
              <div class="doc-md-description">
                <p>1D array containing the data.</p>
              </div>
            </li>
            <li>
              <b><code>n</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>The number of data points in each window. If this is not a power of 2, the length of each window will be the nearest power of 2.</p>
              </div>
            </li>
            <li>
              <b><code>noverlap</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>The number of overlapping points between adjacent windows.</p>
              </div>
            </li>
            <li>
              <b><code>remove_mean</code></b>
                  (<code>bool</code>, default:
                      <code>True</code>
)
              –
              <div class="doc-md-description">
                <p>Remove the individual mean from each window.</p>
              </div>
            </li>
            <li>
              <b><code>taper</code></b>
                  (<code>bool</code>, default:
                      <code>True</code>
)
              –
              <div class="doc-md-description">
                <p>Apply a hanning taper to each window.</p>
              </div>
            </li>
            <li>
              <b><code>return_window</code></b>
                  (<code>bool</code>, default:
                      <code>True</code>
)
              –
              <div class="doc-md-description">
                <p>If taper is 'True', return the values of the hanning taper.</p>
              </div>
            </li>
            <li>
              <b><code>padval</code></b>
                  (<code>float, class:`numpy.nan`, | None</code>, default:
                      <code>0</code>
)
              –
              <div class="doc-md-description">
                <p>If this is not 'None', padval will be used to pad the input array such that its length is a multiple of the window length.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>:class:`~numpy.ndarray`</code>
              –
              <div class="doc-md-description">
                <p>Array with the windowed data in columns.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>src/zizou/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">window_array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">nwin</span><span class="p">,</span> <span class="n">noverlap</span><span class="p">,</span>
                 <span class="n">remove_mean</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">taper</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">padval</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_window</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Take a 1-D numpy array and devide it into (overlapping)</span>
<span class="sd">    windows.</span>

<span class="sd">    :param x: 1D array containing the data.</span>
<span class="sd">    :type x: :class:`~numpy.ndarray`</span>
<span class="sd">    :param n: The number of data points in each window. If this</span>
<span class="sd">              is not a power of 2, the length of each window will be</span>
<span class="sd">              the nearest power of 2.</span>
<span class="sd">    :type n: int</span>
<span class="sd">    :param noverlap: The number of overlapping points between</span>
<span class="sd">                     adjacent windows.</span>
<span class="sd">    :type noverlap: int</span>
<span class="sd">    :param remove_mean: Remove the individual mean from each</span>
<span class="sd">                        window.</span>
<span class="sd">    :type remove_mean: bool</span>
<span class="sd">    :param taper: Apply a hanning taper to each window.</span>
<span class="sd">    :type taper: bool</span>
<span class="sd">    :param return_window: If taper is &#39;True&#39;, return the values</span>
<span class="sd">                          of the hanning taper.</span>
<span class="sd">    :type return_window: bool</span>
<span class="sd">    :param padval: If this is not &#39;None&#39;, padval will be used to</span>
<span class="sd">                   pad the input array such that its length is</span>
<span class="sd">                   a multiple of the window length.</span>
<span class="sd">    :type padval: float, class:`numpy.nan`, or None</span>
<span class="sd">    :return: Array with the windowed data in columns.</span>
<span class="sd">    :rtype: :class:`~numpy.ndarray`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
    <span class="n">npts</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span>
    <span class="k">if</span> <span class="n">nwin</span> <span class="o">&gt;</span> <span class="n">npts</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;window length can&#39;t be greater than array length&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># step length that the window is advanced by</span>
    <span class="n">step</span> <span class="o">=</span> <span class="n">nwin</span> <span class="o">-</span> <span class="n">noverlap</span>
    <span class="c1"># compute the remainder of the trace after dividing it</span>
    <span class="c1"># into windows</span>
    <span class="n">rest</span> <span class="o">=</span> <span class="p">(</span><span class="n">npts</span> <span class="o">-</span> <span class="n">nwin</span><span class="p">)</span> <span class="o">%</span> <span class="n">step</span>

    <span class="c1"># if the remainder is &gt;0 pad with zeros</span>
    <span class="k">if</span> <span class="n">rest</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">npts_pad</span> <span class="o">=</span> <span class="n">npts</span> <span class="o">+</span> <span class="p">(</span><span class="n">step</span> <span class="o">-</span> <span class="n">rest</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">npts_pad</span><span class="p">))</span>
        <span class="n">x</span><span class="p">[</span><span class="n">npts</span><span class="p">:]</span> <span class="o">=</span> <span class="n">padval</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">stride_windows</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">nwin</span><span class="p">,</span> <span class="n">noverlap</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">remove_mean</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">demean</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">taper</span><span class="p">:</span>
        <span class="n">result</span><span class="p">,</span> <span class="n">windowVals</span> <span class="o">=</span> <span class="n">apply_hanning</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">return_window</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_window</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">windowVals</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="zizou.util.xarray2hdf5" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">xarray2hdf5</span><span class="p">(</span><span class="n">xArray</span><span class="p">,</span> <span class="n">fdir</span><span class="p">,</span> <span class="n">rootGroupName</span><span class="o">=</span><span class="s1">&#39;original&#39;</span><span class="p">,</span> <span class="n">timedim</span><span class="o">=</span><span class="s1">&#39;datetime&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Store an xarray dataset as an HDF5 file.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>xArray</code></b>
                  (<code>:class:`xarray.Dataset`</code>)
              –
              <div class="doc-md-description">
                <p>Data to store.</p>
              </div>
            </li>
            <li>
              <b><code>fdir</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Directory to store data under.</p>
              </div>
            </li>
            <li>
              <b><code>rootGroupName</code></b>
                  (<code>str</code>, default:
                      <code>&#39;original&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>Hdf5 group name.</p>
              </div>
            </li>
            <li>
              <b><code>timedim</code></b>
                  (<code>str</code>, default:
                      <code>&#39;datetime&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>Name of time dimension.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>src/zizou/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">xarray2hdf5</span><span class="p">(</span><span class="n">xArray</span><span class="p">,</span> <span class="n">fdir</span><span class="p">,</span> <span class="n">rootGroupName</span><span class="o">=</span><span class="s2">&quot;original&quot;</span><span class="p">,</span> <span class="n">timedim</span><span class="o">=</span><span class="s2">&quot;datetime&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Store an xarray dataset as an HDF5 file.</span>

<span class="sd">    :param xArray: Data to store. </span>
<span class="sd">    :type xArray: :class:`xarray.Dataset`</span>
<span class="sd">    :param fdir: Directory to store data under.</span>
<span class="sd">    :type fdir: str</span>
<span class="sd">    :param rootGroupName: Hdf5 group name.</span>
<span class="sd">    :type rootGroupName: str</span>
<span class="sd">    :param timedim: Name of time dimension.</span>
<span class="sd">    :type timedim: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filterwarnings</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">,</span>
               <span class="n">message</span><span class="o">=</span><span class="s1">&#39;`np.bool` is a deprecated alias&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">featureName</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">xArray</span><span class="o">.</span><span class="n">data_vars</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">h5file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fdir</span><span class="p">,</span> <span class="n">featureName</span> <span class="o">+</span><span class="s1">&#39;.nc&#39;</span><span class="p">)</span>

        <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">h5file</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;w&#39;</span>

        <span class="k">with</span> <span class="n">h5netcdf</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">h5file</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5f</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">rootGrp</span> <span class="o">=</span> <span class="n">_create_h5_Structure</span><span class="p">(</span><span class="n">rootGroupName</span><span class="p">,</span> <span class="n">featureName</span><span class="p">,</span> <span class="n">h5f</span><span class="p">,</span> <span class="n">xArray</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span> <span class="c1"># group already exists, append</span>
                <span class="n">rootGrp</span> <span class="o">=</span> <span class="n">h5f</span><span class="p">[</span><span class="n">rootGroupName</span><span class="p">]</span>

            <span class="c1"># determine indices</span>
            <span class="n">new_time</span> <span class="o">=</span> <span class="n">date2num</span><span class="p">(</span><span class="n">xArray</span><span class="p">[</span><span class="n">timedim</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;datetime64[us]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">datetime</span><span class="p">),</span>
                                <span class="n">units</span><span class="o">=</span><span class="n">rootGrp</span><span class="p">[</span><span class="n">timedim</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">],</span>
                                <span class="n">calendar</span><span class="o">=</span><span class="n">rootGrp</span><span class="p">[</span><span class="n">timedim</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;calendar&#39;</span><span class="p">])</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">xArray</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">t0</span> <span class="o">=</span> <span class="n">date2num</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="n">rootGrp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;starttime&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;datetime64[us]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">datetime</span><span class="p">),</span>
                          <span class="n">units</span><span class="o">=</span><span class="n">rootGrp</span><span class="p">[</span><span class="n">timedim</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">],</span>
                          <span class="n">calendar</span><span class="o">=</span><span class="n">rootGrp</span><span class="p">[</span><span class="n">timedim</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;calendar&#39;</span><span class="p">])</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">((</span><span class="n">new_time</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">indices</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">times</span> <span class="o">=</span> <span class="n">rootGrp</span><span class="p">[</span><span class="n">timedim</span><span class="p">]</span>
            <span class="n">newsize</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">newsize</span> <span class="o">&gt;</span> <span class="n">times</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">rootGrp</span><span class="o">.</span><span class="n">resize_dimension</span><span class="p">(</span><span class="n">timedim</span><span class="p">,</span> <span class="n">newsize</span><span class="p">)</span>
            <span class="n">times</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">t0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">times</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">dt</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">rootGrp</span><span class="p">[</span><span class="n">featureName</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[:,</span> <span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">xArray</span><span class="p">[</span><span class="n">featureName</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">xArray</span><span class="p">[</span><span class="n">featureName</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">rootGrp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;endtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">num2date</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="n">rootGrp</span><span class="p">[</span><span class="n">timedim</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">],</span>
                                                    <span class="n">calendar</span><span class="o">=</span><span class="n">rootGrp</span><span class="p">[</span><span class="n">timedim</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;calendar&#39;</span><span class="p">]))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_setMetaInfo</span><span class="p">(</span><span class="n">featureName</span><span class="p">,</span> <span class="n">h5f</span><span class="p">,</span> <span class="n">xArray</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not set all meta info for </span><span class="si">{</span><span class="n">featureName</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../user_guide/" class="btn btn-neutral float-left" title="User Guide"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../about/" class="btn btn-neutral float-right" title="About">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../user_guide/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../about/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
